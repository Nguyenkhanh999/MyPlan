(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[40],{"9STC":function(e,n,r){"use strict";var o=r("wXtC"),a=r.n(o),i=r("nKUr"),c=r("pWf2"),s=r.n(c),d=r("LB4q"),u=r.n(d),l=r("ATwu"),p=r.n(l),m=r("aOJk"),h=r.n(m),v=r("4IMT"),f=r.n(v),_=r("j7zX"),b=r.n(_),g=r("rR1Q"),O=r.n(g),j=r("9xET"),y=r.n(j),P=r("ZPTe"),C=r.n(P),x=r("g4D/"),I=r.n(x),S=r("ZvzK"),A=r.n(S),w=r("Pbn2"),N=r.n(w),k=r("d1El"),D=r.n(k),B=r("iJl9"),T=r.n(B),q=r("EQeY"),E=r.n(q),M=r("QpBz"),W=r.n(M),R=r("9Hym"),F=r.n(R),V=r("o0o1"),L=r.n(V),K=r("KQm4"),Q=r("Ff2n"),H=r("HaE+"),U=r("1OyB"),Y=r("vuIU"),G=r("JX7q"),z=r("Ji7U"),X=r("md7G"),J=r("foSv"),Z=r("rePB"),$=r("rByZ"),ee=r.n($),te=r("Jv8k"),ne=r.n(te),re=r("qPIi"),oe=r.n(re),ae=r("CC+v"),ie=r.n(ae),ce=r("FAat"),se=r.n(ce),de=r("0XPj"),ue=r.n(de),le=r("gPaA"),pe=r.n(le),me=r("7tbW"),he=r.n(me),ve=r("xaJk"),fe=r.n(ve),_e=r("7GkX"),be=r.n(_e),ge=r("xweI"),Oe=r.n(ge),je=r("JZM8"),ye=r.n(je),Pe=r("qPyV"),Ce=r.n(Pe),xe=r("YO3V"),Ie=r.n(xe),Se=r("TYy9"),Ae=r.n(Se),we=r("P/G1"),Ne=r.n(we),ke=r("Y+p1"),De=r.n(ke),Be=r("BkRI"),Te=r.n(Be),qe=r("q1tI"),Ee=r.n(qe),Me=r("vDqi"),We=r.n(Me),Re=r("7VIw"),Fe=r.n(Re),Ve=r("DhVD"),Le=r.n(Ve),Ke=(r("8Fln"),r("wd/R")),Qe=r.n(Ke),He=r("/MKj"),Ue=r("Qi1R"),Ye=r("U7zN"),Ge=r("MtNe"),ze=r("aKL0"),Xe=r("ALrz"),Je=r("8mWp"),Ze=r("7Vf0"),$e=r("9E6z"),et=r("8jhM"),tt=r("kjOc"),nt=r("peQx"),rt=r.n(nt),ot=r("wpJF"),at=r("/X7u"),it=r("PcgX"),ct=r("DEL+"),st=r("te7g"),dt=r("XKnm"),ut=r("h6Bn"),lt=r("A3xh"),pt=r("Ve2W"),mt=r("Ap0Z"),ht=r("3J1t"),vt=r("DKl3"),ft=r("SZpE"),_t=r("npyh"),bt=r("2UhQ"),gt=r("pfc7");function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(n),!0).forEach((function(t){Object(Z.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function yt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(J.a)(e);if(t){var o=Object(J.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(X.a)(this,n)}}var Pt=se.a.Option,Ct=(ie.a.confirm,oe.a.Group),xt=oe.a.Button,It=(ne.a.SubMenu,ee.a.toContentState),St=ee.a.Nav,At=Qe()("2022-05-10T05:00:00").unix(),wt=["customerName","selectedPhone","selectedAddress","province","district","commune","noteOrder","notePrintOrder","discountAmount","orderDiscountPercent","shippingFee","cart","transferMoney","chargedByCard","cash","prepaid","prepaidPoint","prepaidMoney","surcharge","referralAmountDiscount"],Nt=["transfer_money","cash","charged_by_card"],kt={displayId:null,customId:null,recentOrderId:"",noteOrder:It(""),notePrintOrder:It(""),noteImages:[],orderCustomerName:"",countryId:"",provinceId:"",districtId:"",districts:[],communeId:"",communes:[],postcode:"",postcodes:[],selectedPhone:"",selectedEmail:"",selectedAddress:"",serviceName:"",serviceNameVi:"",services:[],statusOrder:0,totalPrice:0,totalWeight:0,isReceiverPay:!1,isAllowTryOut:!1,isAllowCheckingGood:!1,isUsingCod:!0,shippingCost:0,codCost:0,shippingFee:0,discountAmount:0,orderDiscountPercent:0,transferMoney:0,chargedByCard:0,cash:0,payment_from_customers_exchange_order:0,prepaid:0,prepaidPoint:0,prepaidMoney:0,surcharge:0,cart:[],activatedComboProducts:[],comboProductsCanBeActive:[],promotionProductsCanBeActive:[],activatedPromotionProducts:[],promotionAdvanceCanbeActive:[],activatedPromotionAdvance:[],tags:[],tableIds:[],fbLink:null,partner:{},isCustomerLevel:!1,payments:{},order_sources:null,account:null,couponValue:"",estimateDeliveryDate:null,addDate:0,isFirstOrderInMonth:!1,referralAmountDiscount:0,customerReferralCode:null,tabsProductDetail:"edit_order_item"},Dt=function(e){Object(z.a)(r,e);var n=yt(r);function r(e){var o;Object(U.a)(this,r),o=n.call(this,e),Object(Z.a)(Object(G.a)(o),"isLegalToUseRecentOrder",(function(){var e=o.props,t=e.conversationId,n=e.recentOrdersRequest,r=e.recentOrders;return!(null!==n&&void 0!==n&&n.isLoading)&&(null===n||void 0===n?void 0:n.success)&&(null===n||void 0===n?void 0:n.loadForConvId)===t&&!!r})),Object(Z.a)(Object(G.a)(o),"getCurrentShop",(function(){var e=o.props,t=e.shopId;return e.currentShops.find((function(e){return e.id==t}))})),Object(Z.a)(Object(G.a)(o),"getInfoCountry",(function(e){var t=o.state.countries;1==t.length?o.loadProvinces(t[0]):o.loadProvinces(e)})),Object(Z.a)(Object(G.a)(o),"componentWillUnmount",(function(){document.removeEventListener("click",o.handleClickOutSide)})),Object(Z.a)(Object(G.a)(o),"handleClickOutSide",(function(e){var t=Te()(o.state.editProductKey);if(null!==e&&void 0!==e&&e.target&&null!=t&&(e.stopPropagation(),!["icon-edit-product","icon-delete-actual"].includes(e.target.id))){var n=document.getElementsByClassName("product-detail-custom-".concat(t))[0];if(null===n||void 0===n||!n.contains(e.target)){var r=document.getElementsByClassName("dropdown-search-actual-variation-".concat(t))[0];null!==r&&void 0!==r&&r.contains(e.target)||o.setState({editProductKey:null})}}})),Object(Z.a)(Object(G.a)(o),"orderShortcuts",(function(){var e=o.props.auth,t=e.settings.isMac?"Ctrl":"Alt";st.a.add("".concat(t,"+O"),(function(){return o.handleChangeTab(1,!0)})),st.a.add("".concat(t,"+I"),(function(){return o.handleChangeTab(0,!0)})),st.a.add("".concat(t,"+S"),(function(){var t=o.state,n=t.tab,r=t.type,a=t.savingOrder,i=t.warehouseId,c=t.reservationDateTime,s=t.statusOrder,d=t.orderIdViewing,u=o.props.messages.recentOrders,l=a||!i||(1==r?6==s:!c);switch(n){case 1:l||o.onOrderSubmit("create");break;case 2:var p=o.getCurrentShop(),m=!(!d||!u)&&(-1!=u.findIndex((function(e){return e.id==d}))&&u.find((function(e){return e.id==d})).viewing);m=!!o.isLegalToUseRecentOrder()&&m;var h=Object(Ue.K)(e.fbId,!!p&&p.show_employee_viewing_orders,m,!0);(l=l||1!=r||h)||o.onOrderSubmit("edit")}}))})),Object(Z.a)(Object(G.a)(o),"removeQuicklyShortcut",(function(){var e,t=o.props.auth,n=null!==t&&void 0!==t&&null!==(e=t.settings)&&void 0!==e&&e.isMac?"Ctrl":"Alt";st.a.remove("".concat(n,"+A"))})),Object(Z.a)(Object(G.a)(o),"quicklyShortcut",(function(){var e,t=o.props.auth,n=null!==t&&void 0!==t&&null!==(e=t.settings)&&void 0!==e&&e.isMac?"Ctrl":"Alt";st.a.add("".concat(n,"+A"),(function(){return o.onAddProductToCart()}))})),Object(Z.a)(Object(G.a)(o),"checkDisabledOrderDiscount",(function(){var e,t=o.getCurrentShop(),n=null!==t&&void 0!==t&&t.user_shop?Object(Ue.bd)(t.user_shop.role):null,r=!!n&&(n.for_control_orders&&n.ql_dongtien);return!!(!!t&&(0==t.on_add_order_discount||(null===(e=t.condition_order_discount)||void 0===e?void 0:e.length)>0&&(!t.condition_order_discount.includes("all")&&!t.condition_order_discount.includes("online"))))&&!r})),Object(Z.a)(Object(G.a)(o),"removeOrderShortcuts",(function(){var e=o.props.auth&&o.props.auth.settings&&o.props.auth.settings.isMac?"Ctrl":"Alt";st.a.remove("".concat(e,"+O")),st.a.remove("".concat(e,"+I")),st.a.remove("".concat(e,"+S")),st.a.remove("".concat(e,"+A"))})),Object(Z.a)(Object(G.a)(o),"initWarehouse",(function(){var e=o.state.userWarehousesPermissions,t=o.props,n=t.pageWarehouses,r=t.pageId,a="".concat(r,"_warehouse"),i=localStorage.getItem(a),c=null,s=Object(Ue.cc)(e,n,"tao_don");if(s&&s.length>0){var d=s.findIndex((function(e){return(e.page_ids||[]).includes(r)}));if(d>-1)c=s[d].id;else{var u=s.find((function(e){return e.id==i}));c=u?u.id:s[0].id}}o.setState({warehouseId:c})})),Object(Z.a)(Object(G.a)(o),"componentDidUpdate",function(){var e=Object(H.a)(L.a.mark((function e(t,n){var r,a,i,c,s,d,u,l,p,m,h,v,f,_,b,g,O,j,y,P,C,x,I,S,A,w,N,k,D,B,T,q,E,M,W,R,F,V,H,U,Y,z,X,J,Z,$,ee,te,ne,re,oe,ae,ie,ce,se,de;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v=o.state,v.noteOrder,v.notePrintOrder,f=Object(Q.a)(v,["noteOrder","notePrintOrder"]),n.noteOrder,n.notePrintOrder,_=Object(Q.a)(n,["noteOrder","notePrintOrder"]),De()(_,f)||(b=o.getCurrentShop())&&b.combo_availability&&((g=Object(K.a)(o.state.cart)).map((function(e){var t=[],n=[];b.combo_availability.map((function(r){var o=r.combo_product_variations.findIndex((function(t){return!t.variation_id&&t.product_id==e.productId})),a=r.combo_product_variations.findIndex((function(t){return t.variation_id&&t.variation_id==e.variationId}));o>-1?t.push(r):a>-1&&n.push(r)})),e.comboProducts=t,e.comboVariations=n})),o.setState({cart:g})),o.state.onActiveCombos&&!De()(o.state.onActiveCombos,n.onActiveCombos)&&((n.onActiveCombos&&n.onActiveCombos.active||!n.onActiveCombos)&&o.state.onActiveCombos.active&&!o.state.onActiveCombos.onActive?o.updateItemWhenHasComboActivated(o.state.onActiveCombos.prevData,!1,(function(){return o.updateItemWhenHasComboActivated(o.state.onActiveCombos.data,o.state.onActiveCombos.active)})):o.updateItemWhenHasComboActivated(o.state.onActiveCombos.data,o.state.onActiveCombos.active)),o.state.onActivePromotions&&!De()(o.state.onActivePromotions,n.onActivePromotions)&&((n.onActivePromotions&&n.onActivePromotions.active||!n.onActivePromotions)&&o.state.onActivePromotions.active&&!o.state.onActivePromotions.onActive?o.updateItemWhenHasPromotionActivated(o.state.onActivePromotions.prevData,!1,(function(){return o.updateItemWhenHasPromotionActivated(o.state.onActivePromotions.data,o.state.onActivePromotions.active)})):o.updateItemWhenHasPromotionActivated(o.state.onActivePromotions.data,o.state.onActivePromotions.active)),(t.shopId!=o.props.shopId||o.state.getCustomerLevel)&&o.props.shopId&&o.getCustomerLevels(),(t.shopId!=o.props.shopId||o.state.fetchWarehousesPermissions)&&o.fetchUserWarehousesPermissions(),(t.shopId!=o.props.shopId||o.state.isFetchCategories)&&o.fetchCategories(),t.shopId!=o.props.shopId&&o.state.searchResult.length>0&&o.setState({searchResult:[]}),O=o.props.conversations.selectedCustomers,j=O.filter((function(e){return e.fb_id!=o.props.pageId})),y=1==O.length?O[0]:j.length>0?j[0]:O[0],P=t.conversations.selectedCustomers.filter((function(e){return e.fb_id!=o.props.pageId})),C=1==t.conversations.selectedCustomers.length?t.conversations.selectedCustomers[0]:P.length>0?P[0]:t.conversations.selectedCustomers[0],De()(O,t.conversations.selectedCustomers)||(x=o.props.messages.recentOrders,I={selectedCustomer:y},o.isLegalToUseRecentOrder()&&x&&x[0]&&x[0].full_name&&(I=jt(jt({},I),{},{orderCustomerName:x[0].full_name})),(S=o.getCurrentShop())&&(S.active_module||[]).includes(11)&&y&&y.shop_customer_addresses&&y.shop_customer_addresses.length>0&&(A=o.props.messages.matchedWaFbCustomers,w=y.shop_customer_addresses[0].full_name,A&&A.length>0&&(w="".concat(w," [").concat(A[0].name,"]")),I=jt(jt({},I),{},{customerName:w})),o.setState(I)),N=(null===(r=o.props)||void 0===r?void 0:r.messages)||{},k=N.recentOrders,D=(null===t||void 0===t?void 0:t.messages)||{},B=D.recentOrders,o.isLegalToUseRecentOrder()&&!De()(null===k||void 0===k||null===(a=k[0])||void 0===a?void 0:a.full_name,null===B||void 0===B||null===(i=B[0])||void 0===i?void 0:i.full_name)&&o.setState({orderCustomerName:(null===k||void 0===k||null===(T=k[0])||void 0===T?void 0:T.full_name)||(null===y||void 0===y?void 0:y.name)}),o.props.selectedId&&y&&C&&y.id!==C.id&&(o.newSelectablePhone=null,o.newSelectableAddress=null,(q=document.getElementById("customerName"))&&(q.value=y.name)),E=o.getCurrentShop(),o.state.isCustomerLevel&&t.shopCustomer&&E&&(M=t.shopCustomer.tags&&t.shopCustomer.tags.length>0?t.shopCustomer.tags.filter((function(e){return(E.tags_exclusion_customer_level||[]).includes(e)})):[],W=o.checkDisabledDiscountLevelCustomer(),R=W.isActivatedLevel,F=W.isActivatedCustomerLevel,!(M.length>0||0==R||0==F)||o.state.displayId&&null!=o.state.discountByCustomerLevel||o.setState({isCustomerLevel:!1})),o.props.currentShops.length!=t.currentShops.length&&o.handleGetInfoShop.call(Object(G.a)(o),o.props.shopId),o.props.pageId!=t.pageId&&o.initWarehouse(),o.state.isUseWholeSale&&o.setWhosaleForItemInCart(),(o.state.isChangeFreeShip||o.state.isChangeFreeShipPromotion)&&E&&3!=E.type&&(V=o.props.cacheDb,H=o.state.isFreeShip,U=o.state.comboProductsCanBeActive.length&&o.state.activatedComboProducts.find((function(e){return e.combo_product_info&&e.combo_product_info.is_free_shipping}))||o.state.promotionProductsCanBeActive.length&&o.state.activatedPromotionProducts.find((function(e){return e.promotion_product_info&&e.promotion_product_info.is_free_shipping})),Y=o.handleFreeShipFromPromotionAdvance(),U||Y?H=!0:H&&(H=!1),H?(!o.state.editingOrderId&&V.put({conv_id:o.cacheDbKey,field_name:"order.shippingFee",value:0}),o.setState({shippingFee:0})):(z=o.state,X=z.provinceId,J=z.districtId,o.setState({disableShipOrder:!1},(function(){return o.checkShippingFee(X,J)}))),o.setState({isChangeFreeShip:!1,isFreeShip:H,isChangeFreeShipPromotion:!1})),De()(o.calcTotalPrice(Object(K.a)(n.cart)),o.calcTotalPrice(Object(K.a)(o.state.cart)))||(Z=o.calcTotalPrice(Object(K.a)(o.state.cart)),$=Te()(o.state.activatedPromotionAdvance),ee=($||[]).filter((function(e){var t,n,r,o,a,i,c,s,d,u,l,p,m,h,v,f;return["coupon_id_multiple_times","discount_by_coupon_id"].includes(e.promotion_advance_info.type)&&(!(null!==(t=e.promotion_advance_info)&&void 0!==t&&null!==(n=t.promo_code_info)&&void 0!==n&&n.order_price_min)&&!(null!==(r=e.promotion_advance_info)&&void 0!==r&&null!==(o=r.promo_code_info)&&void 0!==o&&o.order_price_max)||!(null!==(a=e.promotion_advance_info)&&void 0!==a&&null!==(i=a.promo_code_info)&&void 0!==i&&i.order_price_max)&&Z>=(null===(c=e.promotion_advance_info)||void 0===c||null===(s=c.promo_code_info)||void 0===s?void 0:s.order_price_min)||!(null!==(d=e.promotion_advance_info)&&void 0!==d&&null!==(u=d.promo_code_info)&&void 0!==u&&u.order_price_min)&&Z<=(null===(l=e.promotion_advance_info)||void 0===l||null===(p=l.promo_code_info)||void 0===p?void 0:p.order_price_max)||Z>=(null===(m=e.promotion_advance_info)||void 0===m||null===(h=m.promo_code_info)||void 0===h?void 0:h.order_price_min)&&Z<=(null===(v=e.promotion_advance_info)||void 0===v||null===(f=v.promo_code_info)||void 0===f?void 0:f.order_price_max))})),o.updateActivatedPromotionAdvanceCoupon(ee)),te=o.reBundledProducts(n.cart).map((function(e){return{quantity:e.quantity,productId:e.productId,variationId:e.variationId,retailPrice:e.retailPrice,weight:e.weight}})),ne=o.reBundledProducts().map((function(e){return{quantity:e.quantity,productId:e.productId,variationId:e.variationId,retailPrice:e.retailPrice,weight:e.weight}})),De()(te,ne)&&n.countryId==o.state.countryId&&n.provinceId==o.state.provinceId&&n.districtId==o.state.districtId&&n.communeId==o.state.communeId||o.checkShippingFee(o.state.provinceId,o.state.districtId),E&&E.inner_fee==E.suburban_fee&&E.suburban_fee==E.outer_fee&&E.inner_fee>0&&0==o.state.shippingFee&&!o.state.isFreeShip&&!o.state.isChangeShippingFee&&!o.state.displayId&&(re=o.state.isFreeShip,o.state.comboProductsCanBeActive.length&&o.state.activatedComboProducts.find((function(e){return e.combo_product_info&&e.combo_product_info.is_free_shipping}))||o.state.promotionProductsCanBeActive.length&&o.state.activatedPromotionProducts.find((function(e){return e.promotion_product_info&&e.promotion_product_info.is_free_shipping}))?re=!0:re&&(re=!1),o.props.cacheDb.put({conv_id:o.cacheDbKey,field_name:"order.shippingFee",value:re?0:E.inner_fee}),o.setState({shippingFee:re?0:E.inner_fee,isFreeShip:re})),oe=o.getCurrentShop(),ae=t.currentShops.find((function(e){return e.id==o.props.shopId})),!oe||!ae||De()(null===C||void 0===C?void 0:C.tags,null===y||void 0===y?void 0:y.tags)&&De()(null===(c=ae.wholesale)||void 0===c||null===(s=c.discount_to_wholesale)||void 0===s?void 0:s.on,null===(d=oe.wholesale)||void 0===d||null===(u=d.discount_to_wholesale)||void 0===u?void 0:u.on)&&De()(null===(l=ae.wholesale)||void 0===l||null===(p=l.tags_customer_to_wholesale)||void 0===p?void 0:p.value,null===(m=oe.wholesale)||void 0===m||null===(h=m.tags_customer_to_wholesale)||void 0===h?void 0:h.value)&&(!o.state.recentOrderId||De()(n.noDiscountWholesale,o.state.noDiscountWholesale))||o.dontUpdateLatestRetailPrice()||o.handleChangeDiscountWholesale(),De()(window.innerWidth,o.state.currentWidth)||o.setState({currentWidth:window.innerWidth}),De()(t.messages.birthday,o.props.messages.birthday)||o.findPromotionAdvanceCanbeActive(),o.props.selectedQuickOrderMsgId&&!De()(t.selectedQuickOrderMsgId,o.props.selectedQuickOrderMsgId)&&((se=null===(ie=o.props.messages.data.find((function(e){return e.id==o.props.selectedQuickOrderMsgId})))||void 0===ie||null===(ce=ie.attachments)||void 0===ce?void 0:ce[0])?(o.onChangeCountry(se.country_code,!1),o.onProvinceSelected({value:se.province_id},!1),o.onDistrictSelected({value:se.district_id},!1),o.onCommuneSelected({value:se.commune_id},!1),o.setState({tab:1,selectedAddress:se.full_address,customerName:se.name,selectedPhone:se.phone,noteOrder:It(se.shipping_notes||"")},(function(){return o.createOrderSearch.current&&o.createOrderSearch.current.focus()}))):o.props.dispatch(Object(Ge.a)(Object(Ue.P)(o.props.t(130)))),o.props.dispatch(Object(Xe.H)(null))),De()(n.customerReferralCode,o.state.customerReferralCode)||o.setState({visibleReferralCode:o.state.customerReferralCode&&!0,referralCodeValue:null===(de=o.state.customerReferralCode)||void 0===de?void 0:de.referral_code}),De()(C,y)&&De()(o.state.recentOrderId,n.recentOrderId)||o.setupMaxReferralAmount(),n.editProductKey!=o.state.editProductKey&&document.addEventListener("click",o.handleClickOutSide),o.updateActualItemWhenChangeItem(n);case 40:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),Object(Z.a)(Object(G.a)(o),"setupMaxReferralAmount",(function(){var e=o.state,t=e.selectedCustomer,n=e.referralAmountDiscount,r=e.recentOrderId;if(t){var a=r?(t.total_amount_referred||0)+(n||0):t.total_amount_referred,i=r?parseInt(t.total_amount_referred||0)+parseInt(n||0):parseInt(t.total_amount_referred||0);o.setState({showReferralAmount:a>0,maxReferralAmount:i})}})),Object(Z.a)(Object(G.a)(o),"reBundledProducts",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Te()(e||o.state.cart);return t.filter((function(e){return!e.isBonusProduct&&!e.isIncludedAccessory}))})),Object(Z.a)(Object(G.a)(o),"handleChangeDiscountWholesale",Object(H.a)(L.a.mark((function e(){var t;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.checkDiscountToWholesale()?(t=o.reBundledProducts(),(o.state.activatedPromotionAdvance||[]).map((function(e){"fixed_prices"==e.type&&(t=t.map((function(t){return e.items.find((function(e){return e.variation_id==t.variationId||e.product_id==t.productId}))&&(t.retailPrice=Te()(null==t.retailPriceOriginal?t.retailPrice:t.retailPriceOriginal),t.isFixedPrices=!1,delete t.retailPriceOriginal),t})))})),o.setState({activatedPromotionProducts:[],promotionProductsCanBeActive:[],onActivePromotions:null,activatedPromotionAdvance:[],promotionAdvanceCanbeActive:[],comboProductsCanBeActive:[],activatedComboProducts:[],onActiveCombos:null,noDiscountWholesale:!0,disabledComboVariation:!0,disabledComboProduct:!0,disabledComboCategory:!0,cart:t})):o.state.isEditOrder||o.setState({noDiscountWholesale:!1},(function(){o.findComboCanBeActive(null,o.state.activatedComboProducts),o.findPromotionProductsCanBeActive(),o.findPromotionAdvanceCanbeActive()}));case 2:case"end":return e.stop()}}),e)})))),Object(Z.a)(Object(G.a)(o),"updateActualItemWhenChangeItem",(function(e){var t=function(e){return e.filter((function(e){return e.actualVariationInfo})).map((function(e){return{discountEachProduct:e.discountEachProduct,isDiscountPercent:e.isDiscountPercent,quantity:e.quantity,retailPrice:e.retailPrice,note:e.note}}))},n=t(e.cart),r=t(o.state.cart);if(!De()(n,r)){var a=Te()(o.state.cart);a=a.reduce((function(e,t){return t.actualVariationInfo&&(t=jt(jt({},t),{},{actualVariationInfo:jt(jt({},t.actualVariationInfo),{},{quantity:t.quantity,discountEachProduct:t.discountEachProduct,isDiscountPercent:t.isDiscountPercent,retailPrice:t.retailPrice})})),e.push(t),e}),[]),o.setState({cart:a})}})),Object(Z.a)(Object(G.a)(o),"handleFreeShipFromPromotionAdvance",(function(){var e=o.state.activatedPromotionAdvance;if(!e.length)return!1;var t=!1;return e.map((function(e){var n,r,a,i;if("coupon"==(null===(n=e.promotion_advance_info)||void 0===n?void 0:n.type)&&null!==(r=e.promotion_advance_info)&&void 0!==r&&null!==(a=r.coupon_info)&&void 0!==a&&a.is_freeship){var c,s,d=o.reBundledProducts().reduce((function(e,t){return e+t.quantity}),0);null!==(c=e.promotion_advance_info)&&void 0!==c&&null!==(s=c.coupon_info)&&void 0!==s&&s.quantity_to_freeship&&d>=e.promotion_advance_info.coupon_info.quantity_to_freeship&&(t=!0)}null!==(i=e.promotion_advance_info)&&void 0!==i&&i.is_free_shipping&&(t=!0)})),t})),Object(Z.a)(Object(G.a)(o),"updateItemWhenHasComboActivated",(function(e,t,n){var r=[];(e||[]).map((function(e){e.combo_product_info.bonus_products&&e.combo_product_info.bonus_products.length>0&&e.combo_product_info.bonus_products.map((function(t){var n;r.push(jt(jt({},t),{},{is_bonus_product:!0,quantity:t.quantity*(e.quantity_combo_activated||(null===(n=e.combo_product_info)||void 0===n?void 0:n.quantity_combo_activated)||1)}))}))})),o.addItemToItemsBonusProduct(r,t,n)})),Object(Z.a)(Object(G.a)(o),"updateItemWhenHasPromotionActivated",(function(e,t,n){var r=[];(e||[]).map((function(e){e.promotion_product_info.arr_promotion_products&&e.promotion_product_info.arr_promotion_products.length>0&&e.promotion_product_info.arr_promotion_products.map((function(e){r.push(jt(jt({},e),{},{is_bonus_product:!0}))}))})),o.addItemToItemsBonusProduct(r,t,n)})),Object(Z.a)(Object(G.a)(o),"addItemToItemsBonusProduct",(function(e,t,n){var r=Te()(o.state.cart),a=r.filter((function(e){return!e.isBonusProduct||e.isBonusEachProduct})),i=o.reFormatItems(r.filter((function(e){return e.isBonusProduct&&!e.isBonusEachProduct}))),c=o.reFormatItems(e,!0);return 0==r.filter((function(e){return!e.isBonusProduct})).length||0==c.length?o.setState({cart:a},(function(){n&&n()})):(t?c.map((function(e){var t=i.findIndex((function(t){return t.variationId==e.variation_id}));t>-1?i[t].quantity=i[t].quantity+e.quantity:i.push(o.convertItemToPushIntoCart(e))})):c.map((function(e){var t=i.findIndex((function(t){return t.variationId==e.variation_id}));t>-1&&(i[t].quantity=i[t].quantity-e.quantity)})),i=i.filter((function(e){return e.quantity>0})),r=a.concat(i),o.setState({cart:r},(function(){n&&n()})))})),Object(Z.a)(Object(G.a)(o),"setWhosaleForItemInCart",(function(){var e=Te()(o.state.cart);e.forEach((function(e){var t=o.onWholesalePrice(e),n=t.wholesalePrice,r=t.isWholesaleForAllVariations,a=n>0,i=a?n:o.getRetailPriceByCurrency(jt(jt({},e),{},{isWholesale:a}),o.state.currency);e.oneTime||e.isBonusProduct||e.isFixedPrices||e.isIncludedAccessory||!((0==n||i!=e.retailPrice)&&e.isWholesale||!e.isWholesale&&n>0&&n!=e.retailPrice)||(e.isWholesale=a,e.retailPrice=o.parseRetailPriceToRate(i,e,o.state.currency),!Object.keys(e).includes("isWholesaleForAllVariations")&&!r||(e.isWholesaleForAllVariations=r))})),o.setState({cart:e,isUseWholeSale:!1,isEditOrder:!1})})),Object(Z.a)(Object(G.a)(o),"getCustomerLevels",(function(){var e=o.props,t=e.accessToken,n=e.shopId,r="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(n,"/customer_levels?access_token=").concat(t);We.a.get(r).then((function(e){if(e.data.success){var t=e.data.data;o.setState({customerLevels:t})}})).catch((function(e){console.log(e)})),o.setState({getCustomerLevel:!1})})),Object(Z.a)(Object(G.a)(o),"sendCustomerAddressRequest",(function(){var e=o.props,t=e.pages.currentPageId,n=e.accessToken,r=e.conversations,a=r.selectedFrom,i=r.selectedId,c=e.dispatch,s=e.t,d="".concat(Object(Ue.Mb)(),"/v1/pages/").concat(t,"/conversations/").concat(encodeURIComponent(i),"/messages/send_customer_address_request?access_token=").concat(n);o.setState({isSendingAdress:!0}),We.a.post(d,{psid:a.psid}).then((function(e){e.data.success||c(Object(Ge.a)(Object(Ue.P)(s(130))))})).finally((function(){return o.setState({isSendingAdress:!1})}))})),Object(Z.a)(Object(G.a)(o),"convertItemToPushIntoCart",(function(e){return{id:null,variationId:e.variation_id,productId:e.product_id,isBonusProduct:!0,isBonusEachProduct:e.bonus_each_product,oneTime:e.one_time_product||!1,remain:0,productName:e.variation_info.name,quantity:parseInt(e.quantity||0),weight:e.variation_info.weight||0,retailPrice:0,wholesalePrice:e.variation_info.wholesale_price,wholesalePriceOriginal:e.variation_info.wholesale_price_original,oneTimePrice:null,categoryIds:e.variation_info.category_ids,variationText:o.getVariationInfo(e.variation_info.fields),visibleProductDetal:!1,productTags:e.variation_info.product_tags,lastImportedPrice:e.one_time_product?e.variation_info&&e.variation_info.last_imported_price?e.variation_info.last_imported_price:0:null,variationsWarehouses:Array.isArray(e.variations_warehouses)?e.variations_warehouses:[],images:e.images||[],note:e.note}})),Object(Z.a)(Object(G.a)(o),"handleAutoFillTransport",(function(e,t,n){var r=n||o.state.warehouseId,a=void 0,i="",c=o.getCurrentShop();if(c){var s=c.shop_geo_partner;e&&r&&s&&s.length>0&&(t?((a=s.find((function(n){return n.province_id==e&&n.district_id==t&&n.warehouse_id==r})))||(a=s.find((function(t){return t.warehouse_id==r&&t.province_id==e&&null==t.district_id}))))&&(/^\d+$/.test(a.partner_id),i=a.partner_id,o.setState({partnerId:i}),0==i&&null!=i||o.setState({isSendToSnappy:!1,dontSyncWithSnappy:!0})):(a=s.find((function(t){return t.warehouse_id==r&&t.province_id==e&&!t.district_id})))&&(/^\d+$/.test(a.partner_id),i=a.partner_id,o.setState({partnerId:i}),0==i&&null!=i||o.setState({isSendToSnappy:!1,dontSyncWithSnappy:!0})))}})),Object(Z.a)(Object(G.a)(o),"onChangeCountry",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?o.state.countryId!=e?(t&&o.selectProvince&&o.selectProvince.current&&o.selectProvince.current.focus(),o.checkedChangeCurrency(e),o.setState({countryId:e,provinceId:"",provinceName:"",communeId:"",districtId:"",provinces:[],communes:[],services:[],postcode:"",postcodes:[]},(function(){return o.getInfoCountry(o.state.countryId)}))):o.loadProvinces(e):o.setState({countryId:"",provinces:[],provinceId:"",provinceName:"",districtId:"",districtName:"",districts:[],communeId:"",communeName:"",communes:[],services:[],postcode:"",postcodes:[]})})),Object(Z.a)(Object(G.a)(o),"onChangeProvince",(function(e){var t=o.state,n=t.provinces,r=t.partner;o.setState({disableShipOrder:!1});var a=n.find((function(t){return t.value==e}));return r&&r.extend_code||o.handleAutoFillTransport(e,null),o.onProvinceSelected(a)})),Object(Z.a)(Object(G.a)(o),"onProvinceSelected",(function(e){var t,n,r,a,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=o.props,s=(c.conversationId,c.cacheDb),d=o.getCountryId(o.state.countryId);if(!o.state.editingOrderId&&s.put({conv_id:o.cacheDbKey,field_name:"order.province",value:e}),e)return i&&"1"!=d&&(null===(t=o.selectDistrict)||void 0===t||null===(n=t.current)||void 0===n||n.focus()),i&&"1"==d&&(null===(r=o.selectCommune)||void 0===r||null===(a=r.current)||void 0===a||a.focus()),o.checkedChangeCurrency(e.value),o.setState({provinceId:e.value,provinceName:e.label,communeId:"",districtId:"",communes:[],services:[],postcode:"",postcodes:[]}),o.loadDistricts(e.value);o.setState({provinceId:"",provinceName:"",districtId:"",districtName:"",districts:[],communeId:"",communeName:"",communes:[],services:[],postcode:"",postcodes:[]})})),Object(Z.a)(Object(G.a)(o),"onChangeDistrict",(function(e){var t=o.state,n=t.districts,r=t.partner,a=t.provinceId;o.setState({disableShipOrder:!1});var i=n.find((function(t){return t.value==e}));return r&&r.extend_code||o.handleAutoFillTransport(a,e),o.onDistrictSelected(i)})),Object(Z.a)(Object(G.a)(o),"checkPostcodes",(function(e,t){var n=e.postcode||[],r=[];n.map((function(e){return r.push({value:e,label:e,en:e})})),t?o.setState({postcodes:Oe()(r,"value")}):o.setState({communes:Oe()(r,"value")})})),Object(Z.a)(Object(G.a)(o),"onDistrictSelected",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=o.props.cacheDb;if(!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.district",value:e}),e){t&&o.selectCommune&&o.selectCommune.current&&o.selectCommune.current.focus(),o.setState({districtId:e.value,districtName:e.label});var r=o.checkCountryCode("66"),a=o.checkCountryCode("60"),i=o.checkCountryCode("82"),c=o.checkCountryCode("966");r&&o.checkPostcodes(e,r),a||c||i?o.checkPostcodes(e,r):o.loadCommunes(e.value)}else o.setState({districtId:"",districtName:"",communeId:"",communeName:"",communes:[],postcode:"",postcodes:[]})})),Object(Z.a)(Object(G.a)(o),"handleChooseFee",(function(e,t,n,r){var o=e.filter((function(e){return t.includes(e.key)}));return(o=o.sort((function(e,t){return(t.weight||0)-(e.weight||0)||e.price_ship-t.price_ship}))).find((function(e){return e.selected_warehouse==r&&e.additional_partner==n}))||o.find((function(e){return e.selected_warehouse==r&&("all"==e.additional_partner||!e.additional_partner)}))||o.find((function(e){return("all"==e.selected_warehouse||!e.additional_partner)&&e.additional_partner==n}))||o.find((function(e){return("all"==e.selected_warehouse||!e.additional_partner)&&("all"==e.additional_partner||!e.additional_partner)}))})),Object(Z.a)(Object(G.a)(o),"checkShippingFee",(function(e,t,n,r){var a,i=o.state,c=i.cart,s=i.disableShipOrder,d=i.isFreeShip,u=n||o.state.warehouseId,l=r||o.state.partnerId,p=o.getCurrentShop();if(!d&&p){var m=p?p.price_ship_by_orders:[],h=o.calcTotalProductPrice(c),v=c.reduce((function(e,t){return e+t.quantity}),0),f=c.reduce((function(e,t){return e+(t.weight||0)*t.quantity}),0),_=m.filter((function(e){return e.price_order<=h&&(e.quantity_products||0)<=v&&(e.weight||0)<=f&&(4!=e.key||o.checkAddress(e.address))})),b=o.handleChooseFee(_,[0,4],l,u),g=o.handleChooseFee(_,[1,4],l,u),O=o.handleChooseFee(_,[2,4],l,u),j=o.handleChooseFee(_,[4],l,u),y=o.state.countryId?o.state.countryId:(null===p||void 0===p||null===(a=p.country_code)||void 0===a?void 0:a.length)<2?p.country_code[0]||"84":null,P=Object(Ue.Kb)(y,e,t,p,u,o.props.pageWarehouses);if(1==o.state.tab||2==o.state.tab&&!s)switch(P){case 3:(0!=p.inner_fee||p.price_ship_advance)&&o.setState({shippingFee:b&&p.price_ship_advance?b.price_ship:p.inner_fee});break;case 2:(0!=p.suburban_fee||p.price_ship_advance)&&o.setState({shippingFee:g&&p.price_ship_advance?g.price_ship:p.suburban_fee});break;case 1:(0!=p.outer_fee||p.price_ship_advance)&&o.setState({shippingFee:O&&p.price_ship_advance?O.price_ship:p.outer_fee});break;case 4:p.price_ship_advance&&null!==j&&void 0!==j&&j.price_ship&&o.setState({shippingFee:j.price_ship})}}})),Object(Z.a)(Object(G.a)(o),"checkAddress",(function(e){var t,n=o.getCurrentShop();if((null===e||void 0===e||!e.length)&&(null===n||void 0===n||null===(t=n.country_code)||void 0===t?void 0:t.length)>1)return!1;var r=(o.state.provinceId||"").split("_"),a=o.state.countryId?o.state.countryId||r.length>1&&r[0]||"84":n.country_code[0]||"84";return e.find((function(e){return e.country_code==a&&(!e.province_id||e.province_id==o.state.provinceId)&&(!e.district_id||e.district_id==o.state.districtId)&&(!e.commune_id||e.commune_id==o.state.communeId)}))})),Object(Z.a)(Object(G.a)(o),"onChangeCommune",(function(e){var t=o.state.communes.find((function(t){return t.value==e}));o.onCommuneSelected(t)})),Object(Z.a)(Object(G.a)(o),"onCommuneSelected",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=o.props.cacheDb;if(!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.commune",value:e}),e){var r,a,i=o.checkCountryCode("62")||o.checkCountryCode("1")||o.checkCountryCode("66");if(t&&i&&o.selectPostcode.current&&o.selectPostcode.current.focus(),t&&!i)if(o.state.warehouseId)null===(r=o.inputProductSearch)||void 0===r||null===(a=r.current)||void 0===a||a.focus();else o.setState({visibleWarehouse:!0});if(i&&!o.checkCountryCode("66")){var c=e.postcode||[],s=[];c.map((function(e){return s.push({value:e,label:e,en:e})})),o.setState({postcodes:Oe()(s,"value"),communeId:e.value,communeName:e.label})}else o.setState({communeId:e.value,communeName:e.label})}else o.setState({communeId:"",communeName:"",postcode:""})})),Object(Z.a)(Object(G.a)(o),"onChangeWarehouse",(function(e){var t=o.props.pageWarehouses,n=o.state.activatedPromotionAdvance,r=Object.keys(t).map((function(e){return{value:t[e].id,label:t[e].name,isEditOrder:!1}})),a=n.filter((function(t){var n;return["coupon_id_multiple_times","discount_by_coupon_id"].includes(t.promotion_advance_info.type)&&(!(null!==(n=t.promotion_advance_info.warehouse_ids)&&void 0!==n&&n.length)||t.promotion_advance_info.warehouse_ids.includes(e))}));o.updateActivatedPromotionAdvanceCoupon(a);var i=r.find((function(t){return t.value==e}));o.setState({visibleWarehouse:!1}),o.onWarehouseChanged(i)})),Object(Z.a)(Object(G.a)(o),"onWarehouseChanged",(function(e){var t=o.props.pageId,n=o.state,r=n.districtId,a=n.saveWarehouses,i=n.provinceId,c="".concat(t,"_warehouse");e?(a&&localStorage.setItem(c,e.value),o.setState({warehouseId:e.value}),o.inputProductSearch&&o.inputProductSearch.current&&setTimeout((function(){o.setState({searchResult:[]}),o.inputProductSearch.current.focus()}),300),o.handleAutoFillTransport(i,r,e.value),i&&r&&o.checkShippingFee(i,r,e.value)):(localStorage[c]&&localStorage.removeItem(c),o.setState({warehouseId:null})),setTimeout((function(){o.findPromotionAdvanceCanbeActive()}),200)})),Object(Z.a)(Object(G.a)(o),"handleChangeSaveWarehouses",(function(e){var t=o.props.pageId;localStorage["".concat(t,"_warehouse")]&&localStorage.removeItem("".concat(t,"_warehouse")),localStorage.setItem("is_save_warehouses_".concat(t),e.target.checked),o.setState({saveWarehouses:e.target.checked})})),Object(Z.a)(Object(G.a)(o),"checkDiff",(function(e,t){e=e||{},t=t||{};var n=[],r=[].concat(Object(K.a)(Object.keys(e)),Object(K.a)(Object.keys(t)));return(r=Ce()(r)).forEach((function(r){if(e.hasOwnProperty(r))t.hasOwnProperty(r)&&De()(e[r],t[r])||n.push(r);else{if(!t.hasOwnProperty(r))return;n.push(r)}})),n})),Object(Z.a)(Object(G.a)(o),"getPaymentMethods",(function(e,t){var n=o.getCurrentShop();if(t=t||[],e&&null!==e&&void 0!==e&&e.id){var r=e.charged_by_card,a=e.charged_by_vnpay,i=e.charged_by_momo,c=e.charged_by_kredivo,s=e.charged_by_qrpay,d=e.charged_by_fundiin,u=e.bank_payments,l=e.cash,p=e.payment_purchase_histories||[];l&&t.push("cash"),i&&t.push("charged_by_momo"),(a||p.find((function(e){return"vnpay"==e.type})))&&t.push("charged_by_vnpay"),(c||p.find((function(e){return"kredivo"==e.type})))&&t.push("charged_by_kredivo"),(d||p.find((function(e){return"fundiin"==e.type})))&&t.push("charged_by_fundiin"),s&&t.push("charged_by_qrpay"),r&&t.push("charged_by_card"),t=t.concat(be()(u))}return t=["transfer_money"].concat(Object(K.a)(t)),t=he()(t.concat((null===n||void 0===n?void 0:n.payments_default)||[]))})),Object(Z.a)(Object(G.a)(o),"renderItemToCart",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{index:t,id:e.id,variationId:e.variation_id,productId:e.product_id,isBonusProduct:e.is_bonus_product,oneTime:e.one_time_product,remain:0,productName:e.variation_info.name,quantity:e.quantity,weight:e.variation_info.weight,retailPrice:e.variation_info.retail_price,retailPriceCurrencyOriginal:e.variation_info.retail_price_currency_original,retailPriceOriginal:e.variation_info.retail_price_original,wholesalePrice:e.variation_info.wholesale_price2,isWholesale:e.is_wholesale,isFixedPrices:e.is_fixed_prices,wholesalePriceOriginal:e.variation_info.wholesale_price_original,oneTimePrice:e.one_time_product?Math.round(e.variation_info.retail_price*e.quantity):null,comboProducts:e.combo_products,comboVariations:e.combo_variations,categoryIds:e.variation_info.category_ids,variationText:e.variation_info.detail||o.getVariationInfo(e.variation_info.fields),isDiscountPercent:e.is_discount_percent,discountEachProduct:e.discount_each_product,visibleProductDetal:!1,brandId:e.variation_info.brand_id,displayProductId:e.variation_info.product_id,displayVariationId:e.variation_info.id,displayVariationCustomId:e.variation_info.custom_id,manipulationWarehouses:e.manipulation_warehouses||[],addedToCartQuantity:e.added_to_cart_quantity,hasChangeQuantity:!1,variationsWarehouses:e.variations_warehouses,bonusEachProduct:e.bonus_products||[],isBonusEachProduct:e.bonus_each_product,productTags:e.variation_info.product_tags,bonusEachVariation:e.bonus_variations||[],lastImportedPrice:e.one_time_product?e.variation_info&&e.variation_info.last_imported_price?e.variation_info.last_imported_price:0:null,retailPriceByCurrency:e.variation_info.retail_price_by_currency,measureGroupId:e.measure_group_id,measureInfo:e.variation_info.measure_info,retailPriceWholesaleOriginal:e.variation_info.retail_price_wholesale_original,quantityByComboProducts:e.quantity_by_combo_products||[],images:e.variation_info.images||[],additionPrice:e.variation_info.addition_price||0,isPriceByWeight:e.is_price_by_weight||!1,retailPriceByWeight:e.variation_info.retail_price_by_weight,returnedCount:e.returned_count,note:e.note,isIncludedAccessory:e.variation_info.is_accessory,assigningSellerId:e.assigning_seller_id,isActualVariation:n}})),Object(Z.a)(Object(G.a)(o),"editOrder",(function(e){o.onChangeEmployeeViewingOrder(e,!0);var t=o.props,n=t.accessToken,r=t.shopId,a=t.dispatch,i=t.t,c=o.state.type;if(o.setState({editingOrderId:e,orderIdViewing:e}),1!=c)return o.setState({savingOrder:!1,editingOrderId:null}),void o.renderErrorMessage({message:i("textOnly.noShopInfo")});var s="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(r,"/orders/").concat(e,"?access_token=").concat(n);Object(Ue.lc)(s).then((function(e){if(e.success){var t,n=e.data,r=Te()(n.items);2==c&&(null!=r[0].variation_info.name&&"adult"==r[0].variation_info.name||(r=r.reverse()));var a=r.map((function(e,t){var n=e.actual_variation_info&&o.renderItemToCart(e.actual_variation_info,0,!0);return jt(jt({},o.renderItemToCart(e,t)),{},{actualVariationInfo:n})}));if(2==c&&o.setState({tableIds:n.tables,bookingTotalAdults:a[0]?a[0].quantity:0,reservationDateTime:Qe()(e.data.reservation_datetime)}),n.activated_combo_products.length>0){var s,d=n.activated_combo_products[0].is_variation?"variation":n.activated_combo_products[0].combo_product_info.is_categories?"category":null!==(s=n.activated_combo_products[0].combo_product_info.combo_product_variations[0])&&void 0!==s&&s.variation_id?"variation":"product";o.setState({comboBy:d})}var u=o.calcTotalProductPrice(a),l=0!=u?Math.round(100*n.discount/u):0,p=jt(jt({},o.state.payments),n.bank_payments);n.charged_by_momo&&(p.charged_by_momo=n.charged_by_momo),n.charged_by_qrpay&&(p.charged_by_qrpay=n.charged_by_qrpay),n.charged_by_vnpay&&(p.charged_by_vnpay=n.charged_by_vnpay),n.charged_by_kredivo&&(p.charged_by_kredivo=n.charged_by_kredivo),n.charged_by_fundiin&&(p.charged_by_fundiin=n.charged_by_fundiin),o.firstPayments=jt({},p),o.setState({cart:a,oldCart:a,orderCustomerName:n.bill_full_name,selectedPhone:n.bill_phone_number,selectedEmail:n.bill_email,noteOrder:It(n.note||""),notePrintOrder:It(n.note_print||""),shippingFee:n.shipping_fee,discountAmount:n.discount,orderDiscountPercent:l,prepaidPoint:n.prepaid_by_point.point,prepaidMoney:n.prepaid_by_point.money,transferMoney:n.transfer_money,chargedByCard:n.charged_by_card,paymentMethods:o.getPaymentMethods(n),bank_payments:n.bank_payments,payments:p,cash:n.cash,payment_from_customers_exchange_order:n.payment_from_customers_exchange_order,prepaid:n.prepaid,surcharge:n.surcharge,recentOrderId:n.id,warehouseId:n.warehouse_id,displayId:n.display_id,customId:n.custom_id,isEmptyCart:n.is_empty_cart,isUsingCod:!n.shipments[0]||!n.shipments[0].tracking||n.shipments[0].tracking.services.cod_service.use_cod,isReceiverPay:!(!n.shipments[0]||!n.shipments[0].tracking)&&n.shipments[0].tracking.services.is_receiver_pay,isAllowCheckingGood:!!(n.shipments[0]&&n.shipments[0].tracking&&n.shipments[0].tracking.services&&n.shipments[0].tracking.services.is_allow_checking_good)&&n.shipments[0].tracking.services.is_allow_checking_good,isAllowTryOut:!!(n.shipments[0]&&n.shipments[0].tracking&&n.shipments[0].tracking.services&&n.shipments[0].tracking.services.is_allow_try_out)&&n.shipments[0].tracking.services.is_allow_try_out,editingOrderId:null,activatedComboProducts:n.activated_combo_products,activatedPromotionProducts:n.activated_promotion_products,activatedPromotionAdvance:n.activated_promotion_advances,tags:n.tags,fbLink:n.customer.fb_link,partner:n.partner,statusOrder:n.status,duplicatedPhone:n.duplicated_phone,duplicatedCustomer:n.duplicated_customer,dontSyncWithSnappy:n.dont_sync_with_snappy,isSendToSnappy:!n.dont_sync_with_snappy,disabled:!!(n.shipments&&n.shipments[0]&&n.shipments[0].tracking),countryId:n.shipping_address.country_code,partnerId:n.partner&&void 0!=n.partner.partner_id?"".concat(n.partner.partner_id):void 0,cod:n.partner&&n.partner.cod?n.partner.cod:0,totalFee:n.partner&&n.partner.total_fee?n.partner.total_fee:0,isEditOrder:!0,isFreeShip:n.is_free_shipping,discountByCustomerLevel:n.discount_by_customer_level,isCustomerLevel:n.is_customer_level,returnFree:n.return_fee,oldWarehouse:n.warehouse_id,isCalculationTax:n.is_calculation_tax,assigningSellerId:n.assigning_seller_id,assigningCareId:n.assigning_care_id,marketerId:n.pke_mkter,insertedAt:n.inserted_at,noDiscountWholesale:n.no_discount_to_wholesale,codServiceCharge:n.cod_service_charge,orderSources:n.order_sources,account:n.account,currency:n.order_currency||o.state.currency,estimateDeliveryDate:n.estimate_delivery_date,levelCustomer:null===(t=n.discount_by_customer_level)||void 0===t?void 0:t.level,isFirstOrderInMonth:n.is_first_order_in_month||!1,leveraPoint:n.levera_point,thirdPartyInfomation:n.third_party_infomation,noteImages:n.note_image,transferProofs:n.transfer_proofs||[],customerReferralCode:n.customer_referral_code,referralAmountDiscount:n.referral_amount_discount,isRewardPoint:null==n.is_reward_point||n.is_reward_point,paymentHistory:n.payment_status||n.payment_purchase_histories[0]});n.shipping_address.country_code,n.shipping_address.commune_id,n.shipping_address.district_id,n.shipping_address.full_address,n.shipping_address.province_id,n.shipping_address.address;o.handleChangeTab(2,!0),o.onAddressSelected(n.shipping_address),o.findComboCanBeActive(!0,n.activated_combo_products),o.findPromotionProductsCanBeActive(!0),o.findPromotionAdvanceCanbeActive(!0),o.findPromotionAdvanceCoupon(!0)}else o.setState({savingOrder:!1,editingOrderId:null}),o.renderErrorMessage(e,i(150))})).catch((function(e){console.log(e),o.setState({savingOrder:!1,editingOrderId:null}),a(Object(Ge.a)({message:i(150),title:i("failedText"),level:"error",position:"tr",autoDismiss:3}))}))})),Object(Z.a)(Object(G.a)(o),"clearOrderInfo",(function(){var e=o.props.cacheDb;o.setState(jt({},kt)),wt.map((function(t){e.put({conv_id:o.cacheDbKey,field_name:"order."+t,value:null})}))})),Object(Z.a)(Object(G.a)(o),"handleChangeTab",(function(e,t){var n=o.props,r=n.conversations,a=n.pageId,i=n.pageWarehouses,c=n.shopCustomer,s=n.pages,d=o.state,u=d.selectedCustomer,l=d.userWarehousesPermissions,p=d.countries,m=d.countryId,h=o.getCurrentShop();if(0==e&&o.state.orderIdViewing&&(clearInterval(o.intervalHandle),o.onChangeEmployeeViewingOrder(o.state.orderIdViewing,!1),o.setState({orderIdViewing:null,seconds:"00",minutes:h&&h.show_employee_viewing_orders?h.show_employee_viewing_orders.time_range:1})),o.setState({tab:e,orderSources:2==e?o.state.orderSources:null,account:2==e?o.state.account:null}),3==o.state.type&&o.props.dispatch(Object(ct.c)(null)),i.map((function(e){localStorage.removeItem("warehouse_cart_".concat(e.id))})),0==e){o.status=0,o.setState({duplicatedPhone:!1,duplicatedCustomer:!1,visiblePhone:!1,returnedPhone:!1,visibleReturnedPhone:!1,retunedPhoneDate:null,returnedDisplayIdPhone:null,visibleCustomer:!1,duplicatedCustomerDate:null,duplicatedPhoneDate:null,duplicateDisplayId:null,duplicateDisplayIdPhone:null,assigningSellerId:null,assigningCareId:null,marketerId:null,insertedAt:null,discountByCustomerLevel:null,estimateDeliveryDate:null,levelCustomer:null,isSaveQuickProduct:!1,isCustomerLevel:!1,referralCodeValue:null,visibleReferralCode:!1,moreInfoCustomer:!1,isRewardPoint:null,isBriefCustomerInfo:!0,orderByPhone:null,referralAmountDiscount:0,editProductKey:null}),null!=o.state.displayId&&o.clearOrderInfo(),1==(null===p||void 0===p?void 0:p.length)&&m&&p[0]!=m&&o.onChangeCountry(p[0],!1),o.state.saveWarehouses||o.setState({warehouseId:null}),o.removeQuicklyShortcut();var v=h&&h.currency;o.setState({currency:v})}else{if(1==e){var f,_="true"==localStorage.getItem("".concat(a,"_isReceiverPay")),b="true"==localStorage.getItem("".concat(a,"_isUsingCod"))||o.state.isUsingCod,g="true"==localStorage.getItem("".concat(a,"_isAllowCheckingGood")),O="true"==localStorage.getItem("".concat(a,"_isAllowTryOut")),j="true"==localStorage.getItem("is_return_free_".concat(a)),y="true"==localStorage.getItem("is_free_shipping_".concat(a)),P=!!(null==o.state.editingOrderId&&"true"==localStorage.getItem("is_calculation_tax_".concat(a))&&h&&h.invoice_tax>0);if(o.setState({isReceiverPay:_,isUsingCod:b,isAllowCheckingGood:g,isAllowTryOut:O}),o.state.savePartnerId){var C=localStorage.getItem("shipping_partner_id")&&!["NaN","undefined"].includes(localStorage.getItem("shipping_partner_id"))?localStorage.getItem("shipping_partner_id"):o.state.isSendToSnappy?"0":void 0;o.setState({partnerId:C})}else 1==o.state.isSendToSnappy?o.setState({partnerId:"0"}):o.setState({partnerId:void 0});var x=localStorage.getItem("default_currrency_".concat(o.props.pageId));x&&o.checkedChangeCurrency(x,!0);var I=Math.floor(parseInt(c.reward_point||0)+parseInt(o.state.prepaidPoint||0));if(u&&o.getRecentAddressOptions(u).length>0){var S=o.getRecentAddressOptions(u);o.onAddressSelected(S[0])}var A=o.props.messages,w=A.recentOrders,N=A.recentPhoneNumbers,k=A.customers,D=A.convPhoneNumbers,B=A.data,T=A.fetching,q=o.state,E=q.selectedPhone,M=q.customerName,W="",R=M;if(o.isLegalToUseRecentOrder()&&(null===w||void 0===w?void 0:w.length)>0&&w[0].full_name&&(R=w[0].full_name),!E&&D&&D.length>0&&(E="".concat(D[0])),!E&&N&&N.length>0&&(E="".concat(N[0])),o.isLegalToUseRecentOrder()&&!E&&w&&w.length>0){var F=-1,V=-1;w.forEach((function(e){e.phone_number&&e.id>F&&(F=e.id,E="".concat(e.phone_number)),e.email&&e.id>V&&(V=e.id,W="".concat(e.email))}))}if(!T&&!E&&B&&B.length>0){var L,K=B.filter((function(e){return e.has_phone}))||[];if(K.length>0)E=null===(L=K[K.length-1].phone_info[0])||void 0===L?void 0:L.phone_number}if(s&&"whatsapp"==s.currentPlatform&&k&&1==k.length&&(E=k[0].fb_id.replace("wa_c.us@","+")),"COMMENT"!=r.selectedType){var Q=o.getListPostFromAttachment(),H=Q&&Q.length>0?Q[0].post_id:null;o.setState({selectedPostId:H})}var U=(Object(Ue.cc)(l,i,"tao_don")||[]).find((function(e){return(e.page_ids||[]).includes(a)}));U&&o.setState({warehouseId:U.id}),null!==u&&void 0!==u&&u.level_id&&o.setState({isCustomerLevel:!0}),h&&null!==(f=h.settings)&&void 0!==f&&f.default_surcharge&&o.setState({surcharge:h.settings.default_surcharge}),o.setState({selectedPhone:E,selectedEmail:W,isUseWholeSale:!0,returnFree:j,isCalculationTax:P,maxPrepaidByPoint:I,isFreeShip:y,noDiscountWholesale:o.checkDiscountToWholesale(),customerName:R}),o.setupMaxReferralAmount(),o.genLevelCustomer(),o.onCustomerDuplicated(),o.findComboCanBeActive(null,o.state.activatedComboProducts),o.findPromotionProductsCanBeActive(),o.findPromotionAdvanceCanbeActive(),o.findPromotionAdvanceCoupon(),o.calcDiscountPercent()}else o.setState({disableShipOrder:!0});o.onPhoneSelected(),o.removeQuicklyShortcut(),o.quicklyShortcut(),o.setState({orderListChange:null,isEmptyCart:o.state.displayId&&o.state.isEmptyCart})}})),Object(Z.a)(Object(G.a)(o),"genLevelCustomer",(function(){var e=o.props,t=e.accessToken,n=e.shopId,r=e.pageId,a=o.state.selectedCustomer;if(a){var i="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(n,"/customers/").concat(a.id,"/gen_level_customer?page_id=").concat(r,"&access_token=").concat(t);Object(Ue.lc)(i).then((function(e){var t=e.level;o.setState({levelCustomer:t})}))}})),Object(Z.a)(Object(G.a)(o),"fetchUserWarehousesPermissions",(function(){var e=o.props,t=e.accessToken,n=e.shopId;if(n){var r="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(n,"/users/get_warehouses_permissions?access_token=").concat(t);Object(Ue.lc)(r).then((function(e){e.success?o.setState({userWarehousesPermissions:e.data},(function(){return o.initWarehouse()})):o.initWarehouse()})).catch((function(e){console.log(e)})),o.setState({fetchWarehousesPermissions:!1})}})),Object(Z.a)(Object(G.a)(o),"fetchCategories",(function(){var e=o.props,t=e.accessToken,n=e.shopId;if(n){var r=o.getCurrentShop();if(r){var a="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(n,"/categories?isShopee=").concat(r.shopee,"&access_token=").concat(t);Object(Ue.lc)(a).then((function(e){o.setState({categories:e.data})})).catch((function(e){console.log(e)})),o.setState({isFetchCategories:!1})}}})),Object(Z.a)(Object(G.a)(o),"calcTotalPrice",(function(e){var t=0;return e.map((function(e){e.oneTime?t+=e.oneTimePrice:t+=e.quantity*e.retailPrice+(e.additionPrice||0)})),t})),Object(Z.a)(Object(G.a)(o),"calcDiscountByComboProducts",(function(){var e=o.state,t=e.cart,n=e.activatedComboProducts;if(!t||!n||0==n.length)return 0;var r=o.reFormatItems(),a=[];return n.map((function(e){var n,i,c,s=o.oldCodeComboByProduct(),d=(null===(n=e.combo_product_info)||void 0===n?void 0:n.combo_product_variations)||e.combo_product_variations||[],u=d.find((function(e){return e.variation_id}));r=u||s?r:t;var l=0,p=0;if(null!==(i=e.combo_product_info)&&void 0!==i&&i.is_categories?e.combo_product_info.categories.map((function(t,n){var a=e.id?Object.values(e.categories||{})[n]:o.getAllChildCategories(t.id);a=a||[];var i=r.filter((function(e){return o.compare2Array(e.categoryIds,a)})),c=(e.combo_product_info.quantity_combo_activated||e.quantity_combo_activated||1)*t.quantity;i.map((function(e){if(c>0){var t=c>=e.quantity?e.quantity:c;p+=t*e.retailPrice,c-=t}}))})):d.map((function(t){var n=t.count;r.map((function(r){if(null!=t.variation_id&&r.variationId==t.variation_id&&(p+=t.count*r.retailPrice),null==t.variation_id&&r.productId==t.product_id)if(s)n>r.quantity?(n-=r.quantity,p+=r.quantity*r.retailPrice):n>0&&(p+=n*r.retailPrice,n-=r.quantity);else{var o=(r.quantityByComboProducts||[]).find((function(t){return t.combo_id==e.combo_product_id}));o&&(p+=o.count*r.retailPrice)}}))})),0==e.combo_product_info.is_use_percent)e.combo_product_info.is_value_combo?l=p-e.combo_product_info.value_combo:l+=e.combo_product_info.discount_amount;else{var m=e.combo_product_info.max_discount_by_percent,h=Math.floor(p*e.combo_product_info.discount_by_percent/100);l+=h>m&&0!=m?m:h}(s||!s&&0==e.combo_product_info.is_use_percent&&!e.combo_product_info.is_value_combo||u||null!==(c=e.combo_product_info)&&void 0!==c&&c.is_categories)&&(e.quantity_combo_activated&&0!=e.quantity_combo_activated?l*=e.quantity_combo_activated:e.combo_product_info.quantity_combo_activated&&0!=e.combo_product_info.quantity_combo_activated&&(l*=e.combo_product_info.quantity_combo_activated)),a.push(l)})),a.reduce((function(e,t){return e+t}),0)})),Object(Z.a)(Object(G.a)(o),"calcDiscountByPromotionProduct",(function(){var e=o.state,t=e.cart,n=e.activatedPromotionProducts;if(!t||!n||0==n.length)return 0;var r=0,a=o.calcTotalPrice(t),i=0,c=0;return n.map((function(e){0==e.promotion_product_info.is_use_percent?r+=e.promotion_product_info.discount_amount:(i=e.promotion_product_info.max_promotion_by_percent,c=Math.floor(a*e.promotion_product_info.promotion_percent/100),r+=c>i&&0!=i?i:c)})),r})),Object(Z.a)(Object(G.a)(o),"calcDiscountByPromotionProduct2",(function(){var e=o.state,t=e.cart,n=e.activatedPromotionProducts,r=0;return t&&n&&0!=n.length?(n.map((function(e){e.promotion_product_info.arr_level_promotion&&e.promotion_product_info.arr_level_promotion.length>0&&(r+=o.calcLevelPromotion(e.promotion_product_info.arr_level_promotion,t))})),r):0})),Object(Z.a)(Object(G.a)(o),"calcLevelPromotion",(function(e,t){var n={},r=0;e.forEach((function(e){var t=e.categories?"key_".concat(e.categories):"key_0";n[t]?n[t].push(e):n[t]=[e]})),n=Object.values(n);var a=o.reBundledProducts(t);return n.map((function(e){if(e&&e.length>0){e=e.sort((function(e,t){return Number.parseInt(t.productQuantity)-Number.parseInt(e.productQuantity)}));var t=!1;e.map((function(e){if(!t){var n=!1,o=[];if(""!=e.discountPerOneProduct&&""!=e.productQuantity&&"0"!=e.productQuantity||(n=!0),!n){a.length>0&&a.map((function(t){e.categories&&""!=e.categories?t.categoryIds&&t.categoryIds.map((function(n){n==Number.parseInt(e.categories)&&o.push({retailPrice:t.retailPrice,quantity:t.quantity})})):o.push({retailPrice:t.retailPrice,quantity:t.quantity})}));var i=o.reduce((function(e,t){return e+t.quantity}),0);if(i>=Number.parseInt(e.productQuantity))e.isPercent||!1?o.map((function(t){var n=Number.parseInt(t.retailPrice)*Number.parseInt(t.quantity);r+=Math.round(n*(Number.parseInt(e.discountPerOneProduct)/100))})):r+=Number.parseInt(e.discountPerOneProduct)*Number.parseInt(i),t=!0}}}))}})),r})),Object(Z.a)(Object(G.a)(o),"discountByEachPromotionAdvance",(function(e){var t={id:e.activated_promotion_advances_id||null,promotion_advance_id:e.id,promotion_advance_info:e};return o.calcDiscountByPromotionAdvance([t])})),Object(Z.a)(Object(G.a)(o),"calcDiscountWhenLeveled",(function(e,t){var n,r=o.state.isCustomerLevel,a=o.props.shopCustomer,i=o.checkDisabledDiscountLevelCustomer(),c=i.isActivatedLevel,s=i.isActivatedCustomerLevel,d=(null===a||void 0===a?void 0:a.level_id)||(null===a||void 0===a||null===(n=a.level)||void 0===n?void 0:n.id);if(!r||!d||0==c||0==s)return 0;if(!["discount_by_coupon_id","coupon_id_multiple_times"].includes(e.type)){var u=((null===e||void 0===e?void 0:e.discount_by_customer_levels)||[]).find((function(e){return e.level_ids.includes(d)}));return null!==u&&void 0!==u&&u.discount?u.is_percent?Math.round(t*u.discount/100):u.discount:0}return 0})),Object(Z.a)(Object(G.a)(o),"calcDiscountByPromotionAdvance",(function(e){var t=e||Te()(o.state.activatedPromotionAdvance),n=o.state.cart;if(!t||0==t.length)return 0;var r=0,a=o.calcTotalPrice(n),i=o.reFormatItems(n);return i=o.reBundledProducts(i),t.map((function(e){switch(r+=parseInt(o.calcDiscountWhenLeveled(e.promotion_advance_info,a)),e.promotion_advance_info.type){case"discount_by_order_price":var t=!0;e.promotion_advance_info.level_order_prices.sort((function(e,t){return t.order_price_min-e.order_price_min})).map((function(e){if(t&&e.order_price_min<=a&&(!e.order_price_max||e.order_price_max>=a)){if(1==e.is_percent||"true"==e.is_percent){var n=Math.round(a*e.discount/100),o=e.max_discount_by_percent||0;r+=n>o&&0!=o?o:n}else r+=parseInt(e.discount)||0;t=!1}}));case"discount_by_product":e.promotion_advance_info.items.map((function(t){var n=i.find((function(n){return 1==e.promotion_advance_info.is_variation||"true"==e.promotion_advance_info.is_variation?n.variationId==t.variation_id:n.productId==t.product_id}));if(n){var o=n.quantity,a=n.retailPrice*o;0!=e.promotion_advance_info.is_variation&&"false"!=e.promotion_advance_info.is_variation||(a=i.filter((function(e){return e.productId==t.product_id})).reduce((function(e,t){return e+t.quantity*t.retailPrice}),0),o=i.filter((function(e){return e.productId==t.product_id})).reduce((function(e,t){return e+t.quantity}),0));var c=t.level_info.find((function(e){return e.from_quantity<=o&&e.to_quantity>=o}));if(c){var s=1==c.is_percent||"true"==c.is_percent?Math.round(a*c.discount/100):parseInt(c.discount)||0;c.max_discount_by_percent&&parseInt(c.max_discount_by_percent)&&s>parseInt(c.max_discount_by_percent)&&(s=parseInt(c.max_discount_by_percent)),r+=s}}}));break;case"coupon":r+=o.calcDiscountByPromotionCoupon(e,i);break;case"discount_by_coupon_id":case"coupon_id_multiple_times":r+=o.calcDiscountPromotionId(e.promotion_advance_info);break;case"discount_by_attachment_products":r+=o.calcDiscountByAttachmentProduct(i,e)}})),r})),Object(Z.a)(Object(G.a)(o),"calcPrice",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=o.state,a=r.surcharge,i=r.shippingFee,c=r.returnFree,s=r.isFreeShip,d=o.calcTotalPrice(e);return s||t||c||(d+=parseInt(i||0)),a&&!n&&(d+=a),d})),Object(Z.a)(Object(G.a)(o),"calcDiscountPromotionId",(function(e){var t,n,r=o.state.insertedAt;if(!["discount_by_coupon_id","coupon_id_multiple_times"].includes(e.type))return 0;var a=o.reFormatItems();a=o.reBundledProducts(a);var i=o.calcPrice(a,!0)-o.calcDiscountEachProduct(),c=o.calcTotalPriceItemsIncludedPromotions(a),s=0,d=null===(t=e.promo_code_info)||void 0===t?void 0:t.no_applied_products_in_other_promotions;i=d?i-c:i;var u=a.find((function(e){return e.isFixedPrices}))&&(!r||Qe()(r).unix()>Qe()("2023-04-13T07:00:00").unix());if(d&&(i<=0||u))return 0;if(null!==(n=e.promo_code_info)&&void 0!==n&&n.is_percent){var l=Math.round(i*e.promo_code_info.discount/100),p=e.promo_code_info.max_discount_by_percent||0;s+=l>p&&0!=p?p:l}else{var m;s+=parseInt(null===(m=e.promo_code_info)||void 0===m?void 0:m.discount)||0}return s})),Object(Z.a)(Object(G.a)(o),"calcTotalPriceItemsIncludedPromotions",(function(e){var t=Te()(o.state.activatedPromotionAdvance),n=[];return t.map((function(t){var r=t.promotion_advance_info;Object(K.a)(r.items).forEach((function(t){var o=e.find((function(e){return r.is_variation?t.variation_id==e.variationId:t.product_id==e.productId}));o&&(n.find((function(e){return(null===e||void 0===e?void 0:e.variationId)==o.variationId&&(null===e||void 0===e?void 0:e.productId)==o.product_id}))||n.push(o))}))})),n.reduce((function(e,t){return e+=t.quantity*t.retailPrice}),0)})),Object(Z.a)(Object(G.a)(o),"calcDiscountByReferralCode",(function(){var e=o.state.customerReferralCode;if(!e)return 0;var t=o.reFormatItems();t=o.reBundledProducts(t);var n=o.calcPrice(t,!0,!0)-o.calcDiscountEachProduct(),r=!e||("boolean"==typeof e.is_percent?e.is_percent:"true"==e.is_percent),a=null!==e&&void 0!==e&&e.discount?parseInt(e.discount):0;return a>0?r?Math.round(a/100*n):a:0})),Object(Z.a)(Object(G.a)(o),"calcDiscountEachProduct",(function(){var e=0;return Te()(o.state.cart).forEach((function(t){t.isDiscountPercent?e+=((t.quantity-(t.returnedCount||0))*t.retailPrice*(t.discountEachProduct||0)+(t.additionPrice||0))/100:e+=(t.discountEachProduct||0)*(t.quantity-(t.returnedCount||0))})),e})),Object(Z.a)(Object(G.a)(o),"calcDiscountByPromotionCoupon",(function(e,t){var n=e.promotion_advance_info.coupon_info,r=e.promotion_advance_info.items||[],a=n.discount?n.discount:0,i=0;if(n){var c=t.filter((function(t){var a,i;return(!r.length||r.length&&r.find((function(n){return e.promotion_advance_info.is_variation?t.variationId==n.variation_id:t.productId==n.product_id})))&&o.checkPromotionCouponByCategories(n,t)&&(!n.is_use_price_product||n.is_use_price_product&&(n.start_price_product||0)<=t.retailPrice&&(n.end_price_product||0)>=t.retailPrice)&&(!n.is_brand||n.is_brand&&(null===(a=n.brand_ids)||void 0===a?void 0:a.length)&&n.brand_ids.includes(t.brandId))&&(!n.is_product_tag||n.is_product_tag&&(null===(i=t.productTags)||void 0===i?void 0:i.length)&&t.productTags.find((function(e){var t;return(null===(t=n.product_tags)||void 0===t?void 0:t.length)&&n.product_tags.find((function(t){return t==e.id||e}))})))&&(!n.is_quantity_same_product||n.is_quantity_same_product&&n.quantity_same_product&&t.quantity>=n.quantity_same_product)&&(!n.is_pair_product||n.is_pair_product&&null!=n.pair_product_discount)&&(!n.is_upper_quantity||n.is_upper_quantity&&n.upper_product_discount>0)}));if(n.is_percent){var s=n.max_promotion_by_percent||0,d=c.reduce((function(e,t){return e+Math.round(t.quantity*t.retailPrice*a/100)}),0);i+=d>s&&0!=s?s:d}else i+=a;if(r.length&&r.map((function(t){var r=c.find((function(n){return e.promotion_advance_info.is_variation?n.variationId==t.variation_id:n.productId==t.product_id}));if(r){var a=r.quantity;r.retailPrice;e.promotion_advance_info.is_variation||(c.filter((function(e){return e.productId==t.product_id})).reduce((function(e,t){return e+t.quantity*t.retailPrice}),0),a=c.filter((function(e){return e.productId==t.product_id})).reduce((function(e,t){return e+t.quantity}),0)),i+=o.calcDiscountEachPromotionItem(t,r.retailPrice,a,n.is_discount_each_product)}})),e.promotion_advance_info.arr_level_promotion&&e.promotion_advance_info.arr_level_promotion.length&&(i+=o.calcLevelPromotion(e.promotion_advance_info.arr_level_promotion,c)),n.is_pair_product&&n.pair_product_discount){var u=Number.parseInt(t.length/2);t.sort((function(e,t){return e.retailPrice-t.retailPrice})).forEach((function(e,t){t<u&&(i+=e.retailPrice*n.pair_product_discount/100*e.quantity)}))}if(n.is_upper_quantity&&n.upper_product_discount>0){var l=0,p=!0;t.forEach((function(e){(l+=e.quantity)>=(n.upper_product_index||1)&&(p?(i=n.upper_product_is_cash?i+n.upper_product_discount*(l-(n.upper_product_index||1)+1):i+e.retailPrice*n.upper_product_discount/100*(l-(n.upper_product_index||1)+1),p=!1):i=n.upper_product_is_cash?i+n.upper_product_discount*e.quantity:i+e.retailPrice*n.upper_product_discount/100*e.quantity)}))}}return i+=o.calcDiscountByFreeProducts(e.promotion_advance_info.free_products,t)})),Object(Z.a)(Object(G.a)(o),"calcDiscountEachPromotionItem",(function(e,t,n,r){if(!e.coupon_item_info)return 0;if(e.coupon_item_info.is_percent){var o=e.coupon_item_info.discount*t/100;o=r?o:o*n;var a=parseInt(e.coupon_item_info.max_discount_by_percent||0);return o=a>0&&o>a?a:o,o=r?o*n:o,Math.round(o)}var i=parseInt(e.coupon_item_info.discount||0);return r&&(i*=n),i})),Object(Z.a)(Object(G.a)(o),"calcDiscountByFreeProducts",(function(e,t){var n=t.reduce((function(e,t){return e+t.quantity}),0);if(null!==e&&void 0!==e&&e.is_active&&"false"!=e.is_active&&n>=((null===e||void 0===e?void 0:e.products_count)||1)){var r=Math.floor(n/e.products_count)*(e.count_free_products||1);return(t="min"==e.type?t.sort((function(e,t){return Number.parseInt(e.retailPrice)-Number.parseInt(t.retailPrice)})):t.sort((function(e,t){return Number.parseInt(t.retailPrice)-Number.parseInt(e.retailPrice)}))).reduce((function(e,t){if(r>0){var n=r>=t.quantity?t.quantity:r;e+=t.retailPrice*n,r-=t.quantity}return e}),0)}return 0})),Object(Z.a)(Object(G.a)(o),"calcDiscountByAttachmentProduct",(function(e,t){if("discount_by_attachment_products"==t.promotion_advance_info.type){var n=t.promotion_advance_info.items||[],r=0;return n.map((function(t){var n=e.filter((function(e){return e.productId==t.product_id})),o=t.discount_info_by_attachment_product.quantity||1,a=t.attachment_product_info||[];if(e.findIndex((function(e){return a.find((function(t){return t.product_id==e.productId}))}))>-1){var i=t.discount_info_by_attachment_product.is_percent,c=t.discount_info_by_attachment_product.discount,s=n.reduce((function(e,t){return e+t.quantity}),0),d=Math.floor(s/o);if(i){var u=[];if(d*o<s){var l=Object(K.a)(n);l.reverse();var p=s-d*o;l.map((function(e){p>=e.quantity?(p=p-e.quantity>0?p-e.quantity:0,e.quantity=0):(e.quantity=e.quantity-p,p=0),u.push(e)}))}else u=Object(K.a)(n);var m=0;u.map((function(e){m+=e.retailPrice*e.quantity})),r+=m*(c/100)}else r+=c*d}})),r}})),Object(Z.a)(Object(G.a)(o),"calcDiscountByDiscountEachProduct",(function(e){var t=0;return e.isDiscountPercent?t+=(e.quantity*e.retailPrice+(e.additionPrice||0))*(e.discountEachProduct||0)/100:t+=e.quantity*(e.discountEachProduct||0),t})),Object(Z.a)(Object(G.a)(o),"calcDiscountLevel",(function(e){var t=o.state,n=t.levelCustomer,r=t.activatedPromotionAdvance,a=t.activatedComboProducts,i=t.cart;if(t.discountAmount)return 0;var c=0,s=r.filter((function(e){var t,n;return(null===(t=e.promotion_advance_info)||void 0===t||null===(n=t.items)||void 0===n?void 0:n.length)>0})),d=a.filter((function(e){var t,n;return(null===(t=e.combo_product_info)||void 0===t||null===(n=t.combo_product_variations)||void 0===n?void 0:n.length)>0}));return i.map((function(e){var t=s.findIndex((function(t){return t.promotion_advance_info.items.find((function(t){return t.variation_id&&t.variation_id==e.variationId||t.product_id&&t.product_id==e.productId}))}));t<0&&(t=d.findIndex((function(t){return t.combo_product_info.combo_product_variations.find((function(t){return t.variation_id&&t.variation_id==e.variationId||t.product_id==e.productId}))}))),e.discount_each_product>0||t>-1?c+=0:e.oneTime?c+=e.oneTimePrice:c+=e.quantity*e.retailPrice})),1==n.discount_type||3==n.discount_type?Math.round(c/100*n.discount):Math.round(c/e*n.discount)})),Object(Z.a)(Object(G.a)(o),"checkDisabledDiscountLevelCustomer",(function(){var e=o.state.discountByCustomerLevel,t=o.props.shopCustomer;return{isActivatedLevel:null!==e&&void 0!==e&&e.level?0!=e.level.is_activated:!!t&&t.is_activated,isActivatedCustomerLevel:e?0!=e.is_actived_level_by_customer:!!t&&t.is_discount_by_level}})),Object(Z.a)(Object(G.a)(o),"checkDiscountToWholesale",(function(){var e,t,n,r,a,i=o.state,c=i.recentOrderId,s=i.noDiscountWholesale,d=o.props.shopCustomer,u=o.getCurrentShop();return!!(c&&s||!c&&null!==u&&void 0!==u&&u.wholesale&&null!==(e=u.wholesale.tags_customer_to_wholesale)&&void 0!==e&&e.on&&null!==(t=u.wholesale.tags_customer_to_wholesale)&&void 0!==t&&null!==(n=t.value)&&void 0!==n&&n.length&&null!==(r=u.wholesale.discount_to_wholesale)&&void 0!==r&&r.on&&null!==d&&void 0!==d&&null!==(a=d.tags)&&void 0!==a&&a.length&&d.tags.find((function(e){return u.wholesale.tags_customer_to_wholesale.value.includes(e)})))})),Object(Z.a)(Object(G.a)(o),"calcDiscountByCustomerLevel",(function(e){if(o.checkDiscountToWholesale())return 0;var t=o.checkDisabledDiscountLevelCustomer(),n=t.isActivatedLevel,r=t.isActivatedCustomerLevel;if(0==n||0==r)return 0;var a=o.state,i=a.levelCustomer,c=a.cart,s=a.isCustomerLevel,d=a.discountByCustomerLevel,u=a.recentOrderId,l=o.props.shopCustomer,p=o.getCurrentShop(),m=l&&l.tags&&l.tags.length>0?l.tags.filter((function(e){return(p&&p.tags_exclusion_customer_level||[]).includes(e)})):[];if(!d&&m.length>0)return 0;if(!s)return 0;var h=o.calcTotalProductPrice(c);return h-=e||0,c&&i?h<=0?0:u&&null!==d&&void 0!==d&&d.is_level_discount||p&&p.is_level_discount_to_discounted_products&&!u?o.calcDiscountLevel(h):1==i.discount_type||3==i.discount_type?Math.round(h/100*i.discount):2==i.discount_type?i.discount:0:0})),Object(Z.a)(Object(G.a)(o),"compare2Array",(function(e,t){e=e||[];var n=!1;return(t=t||[]).map((function(t){e.map((function(e){e==t&&(n=!0)}))})),n})),Object(Z.a)(Object(G.a)(o),"findPromotionProductsCanBeActive",(function(e){if(!o.state.noDiscountWholesale){var t=o.state,n=t.promotion,r=t.cart,a=t.activatedPromotionProducts,i=t.isChangeFreeShip,c=[],s=Te()(o.state.activatedPromotionProducts);r&&r.length>0?n&&n.map((function(e){var t=!1;if(0!=e.start_price_product&&0!=e.end_price_product&&r.map((function(n){(e.start_price_product>n.retailPrice||e.end_price_product<n.retailPrice)&&(t=!0)})),!t&&e.char_name_product&&""!=e.char_name_product&&r.map((function(n){Object(Ue.fb)(e.char_name_product,n.productName)&&(t=!0)})),!t&&e.categories&&e.categories.length>0&&r.map((function(n){o.compare2Array(e.categories,n.categoryIds)&&(t=!0)})),!t&&e.discount_categories&&e.discount_categories.length>0){var n=0;r.map((function(t){var r=t.categoryIds||[];r.length&&r.map((function(t){e.discount_categories.includes(t)&&n++}))})),0==n&&(t=!0)}if(0==e.total_orders||e.total_orders<=o.calcTotalPrice(r)||(t=!0),e.quantity_product>0){var a=0;r.map((function(e){a+=e.quantity})),a<e.quantity_product&&(t=!0)}if(!t&&e.brands&&e.brands.length>0&&r.map((function(n){e.brands.includes(n.brandId)||(t=!0)})),!t&&e.quantity_same_product>0){var i=Te()(r);o.countMaxQuantityEachProduct(i)<e.quantity_same_product&&(t=!0)}if(!t&&e.product_tags&&e.product_tags.length>0){var s=[];r.map((function(e){(e.productTags||[]).map((function(e){return s.push(e.id)}))})),s=Ce()(s),o.compare2Array(e.product_tags,s)||(t=!0)}t||c.push(e)})):r&&0==r.length&&o.setState({activatedPromotionProducts:[]}),e&&(c=Ce()(c.concat(a.map((function(e){return jt(jt({},e.promotion_product_info),{},{id:e.promotion_product_id})}))),"id"));var d=a||[];d=d.filter((function(e){return c.find((function(t){return t.id==e.promotion_product_id}))})),c.sort((function(e,t){return(t.quantity_product||0)-(e.quantity_product||0)})),c.length>0&&!e&&(d=c.map((function(e){return{promotion_product_id:e.id,promotion_product_info:e}})));var u=null;u=De()(s,d)?o.state.onActivePromotions:{active:!0,data:d,prevData:s},o.setState({promotionProductsCanBeActive:c,activatedPromotionProducts:d,isChangeFreeShip:d&&d.length>0?!e:i,onActivePromotions:u})}})),Object(Z.a)(Object(G.a)(o),"reFormatItems",(function(e,t){var n=Te()(e||o.state.cart),r={},a=[];return n.filter((function(e){return t?!e.is_bonus_product:!e.isBonusProduct})).map((function(e){t?r["".concat(e.variation_id,"_").concat(e.variation_info.retail_price)]?r["".concat(e.variation_id,"_").concat(e.variation_info.retail_price)].quantity+=e.quantity:r["".concat(e.variation_id,"_").concat(e.variation_info.retail_price)]=Te()(e):r["".concat(e.variationId,"_").concat(e.retailPrice)]?r["".concat(e.variationId,"_").concat(e.retailPrice)].quantity+=e.quantity:r["".concat(e.variationId,"_").concat(e.retailPrice)]=Te()(e)})),Object.keys(r).map((function(e){a.push(r[e])})),a.concat(n.filter((function(e){return t?e.is_bonus_product:e.isBonusProduct})))})),Object(Z.a)(Object(G.a)(o),"checkDiscountByBirthday",(function(e){var t,n=o.props.messages,r=o.state,a=r.selectedCustomer,i=r.recentOrderId,c=r.isFirstOrderInMonth,s=r.insertedAt;if(!a)return!1;var d=!1,u=(null===(t=n.birthday)||void 0===t?void 0:t.month)||null,l=i?s.split("-")[1]:(new Date).getMonth()+1;return u&&parseInt(u)==parseInt(l)&&(a.is_first_order_in_month||i&&c)&&(d=!0),!(e.is_discount_in_birthday_customer&&!d)})),Object(Z.a)(Object(G.a)(o),"checkDiscountByOrderCount",(function(e){var t=o.state,n=t.selectedCustomer,r=t.recentOrderId,a=!0,i=(null===n||void 0===n?void 0:n.order_count)||0;if((r&&i>1||!r&&i)&&(a=!1),e.coupon_info.is_apply_for_number_times){var c=e.coupon_info.apply_number_times||1,s=e.coupon_info.range_apply_for_number_times||"equal";if(a&&(1==c||"smallerOrEqual"==s))return!0;if(!a)switch(i=r?i:i+1,s){case"greaterOrEqual":return i>=c;case"smallerOrEqual":return i<=c;default:return i==c}return!1}return!0})),Object(Z.a)(Object(G.a)(o),"checkPromotionByCoupon",(function(e){return"coupon"!=e.type||!!o.checkDiscountByBirthday(e)&&(!!o.checkDiscountByOrderCount(e)&&o.getItemInCoupon(e).length>0)})),Object(Z.a)(Object(G.a)(o),"getItemInCoupon",(function(e){var t=e.coupon_info,n=o.reBundledProducts();return n=n.filter((function(e){var n,r;return o.checkPromotionCouponByCategories(t,e)&&(!t.is_use_price_product||t.is_use_price_product&&(t.start_price_product||0)<=e.retailPrice&&(t.end_price_product||0)>=e.retailPrice)&&(!t.is_brand||t.is_brand&&(null===(n=t.brand_ids)||void 0===n?void 0:n.length)&&t.brand_ids.includes(e.brandId))&&(!t.is_product_tag||t.is_product_tag&&(null===(r=e.productTags)||void 0===r?void 0:r.length)&&e.productTags.find((function(e){var n;return(null===(n=t.product_tags)||void 0===n?void 0:n.length)&&t.product_tags.find((function(t){return t==e.id||t==e}))})))&&(!t.is_quantity_same_product||t.is_quantity_same_product&&t.quantity_same_product&&e.quantity>=t.quantity_same_product)&&(!t.is_pair_product||t.is_pair_product&&null!=t.pair_product_discount)&&(!t.is_upper_quantity||t.is_upper_quantity&&t.upper_product_discount>0)}))})),Object(Z.a)(Object(G.a)(o),"checkPromotionCouponByCategories",(function(e,t){var n,r;if(!e.is_categories)return!0;var a=null!==(n=t.categoryIds)&&void 0!==n&&n.length?t.categoryIds:[],i=null!==(r=e.category_ids)&&void 0!==r&&r.length?e.category_ids:[];if(i==[]&&a==[])return!0;if(a!=[]&&i!=[]){if(o.state.id)return!!a.find((function(e){return i.includes(e)}));var c=[];return i.map((function(e){o.state.categories.map((function(t){var n,r,a=[];if(t.id==e)a=null!==(r=t.nodes)&&void 0!==r&&r.length?o.loopChildren(t.nodes,[t.id]):[t.id];else if(null!==(n=t.nodes)&&void 0!==n&&n.length){var i,s=o.foundCategory(t.nodes,e);a=s?null!==(i=s.nodes)&&void 0!==i&&i.length?o.loopChildren(s.nodes,[s.id]):[s.id]:[]}a=a.filter((function(e){return!c.find((function(t){return t==e}))})),c=Ce()(c.concat(a))}))})),!!a.find((function(e){return c.includes(e)}))}return!1})),Object(Z.a)(Object(G.a)(o),"loopChildren",(function(e,t){var n=[];return e.map((function(e){var r;t.push(e.id),null!==(r=e.nodes)&&void 0!==r&&r.length&&e.nodes.map((function(e){n.push(e)}))})),n.length>0?o.loopChildren(n,t):t})),Object(Z.a)(Object(G.a)(o),"foundCategory",(function(e,t){var n=e.findIndex((function(e){return e.id==t}));if(n>-1)return e[n];var r=[];return e.map((function(e){var t;null!==(t=e.nodes)&&void 0!==t&&t.length&&(r=r.concat(e.nodes))})),r.length?o.foundCategory(r,t):void 0})),Object(Z.a)(Object(G.a)(o),"checkPromotionByOrderSources",(function(e){var t,n=o.props.pageId,r=o.state,a=r.account,i=r.orderSources;if(!e.order_sources||0==(null===(t=e.order_sources)||void 0===t?void 0:t.length))return!0;var c=e.order_sources.map((function(e){return{account:e.account,id:e.id||e.key,page_id:e.page_id}}));if(!i&&!a){if(n){var s=o.getOrderSource()||"-1";return c.find((function(e){return!e.page_id&&e.id==s||e.page_id&&e.page_id==n}))}return!1}return a?c.find((function(e){return!e.account&&e.id==i||e.account&&e.id==i&&e.account==a})):c.find((function(e){return!e.account&&e.id==i}))})),Object(Z.a)(Object(G.a)(o),"checkPromotionByCustomerTags",(function(e){var t,n=o.state.selectedCustomer;if(!e.customer_tags||0==(null===(t=e.customer_tags)||void 0===t?void 0:t.length))return!0;if(!n)return!1;var r=!1;return((null===n||void 0===n?void 0:n.tags)||[]).map((function(t){e.customer_tags.find((function(e){return e==t}))&&(r=!0)})),r})),Object(Z.a)(Object(G.a)(o),"conditionByQuantity",(function(e,t){var n;if(!e.discount_by_quantity)return!0;if(!!["fixed_prices","discount_by_product","coupon"].includes(e.type)&&(null===(n=e.coupon_info)||void 0===n?void 0:n.discount_by_count_variations)){var r;if(null===(r=e.items)||void 0===r||!r.length)return!1;var a=o.getItemIsApplying(e).reduce((function(e,t){return e+t.quantity}),0);return e.discount_by_quantity<=a}return e.discount_by_quantity<=t})),Object(Z.a)(Object(G.a)(o),"getPromotionAdvanceAvailable",(function(e,t){var n=o.props,r=n.timeZone,a=n.pageWarehouses,i=(n.auth,n.messages),c=o.state,s=c.promotion_advances,d=c.warehouseId,u=(c.warehouses_permissions,c.cart),l=c.activatedPromotionAdvance,p=c.insertedAt,m=c.currency,h=o.reBundledProducts().reduce((function(e,t){return e+t.quantity}),0),v=Qe()().unix(),f=o.calcTotalPrice(u),_=o.getListPostFromAttachment(),b=s.filter((function(e){var t;if((null===(t=e.post_ids)||void 0===t?void 0:t.length)>0){var n,c=i.post?[i.post.id]:[];if(null===(n=c=c.concat(_))||void 0===n||!n.length)return!1;if(e.post_ids.findIndex((function(e){return c.includes(e)}))<0)return!1}var s=(e.warehouse_ids?Object.values(e.warehouse_ids):[]).filter((function(e){return a.find((function(t){return t.id==e}))})),u=o.getCurrentShop();return(!e.start_time||Qe()(e.start_time).add(r,"hours").unix()<=(p?Qe()(p).add(r,"hours").unix():v))&&(!e.end_time||Qe()(e.end_time).add(r,"hours").unix()>=(p?Qe()(p).add(r,"hours").unix():v))&&(!e.currency&&u&&u.currency==(m||u.currency)||e.currency==(m||(null===u||void 0===u?void 0:u.currency)))&&(0==s.length||s.includes(d))&&(!e.type_employee||"all"==e.type_employee||"offline"!=e.type_employee)&&function(e){if(!["discount_by_order_price","fixed_prices","coupon"].includes(e.type))return!0;var t;if("discount_by_order_price"==e.type)return null===(t=e.level_order_prices)||void 0===t?void 0:t.find((function(e){return e.order_price_min<=f&&(!e.order_price_max||e.order_price_max>=f)}));if(e.start_price>0||e.end_price>0){var n=!(e.start_price>0)||(e.start_price||0)<=f;return e.end_price>0?n&&(e.end_price||0)>=f:n}return!0}(e)&&o.checkPromotionByCoupon(e)&&o.checkPromotionByOrderSources(e)&&o.checkPromotionByCustomerTags(e)&&!["coupon_id_multiple_times","discount_by_coupon_id"].includes(e.type)&&function(e,t){var n;return"coupon"!=e.type||null===(n=e.free_products)||void 0===n||!n.is_active||"false"==e.free_products.is_active||t>=(e.free_products.products_count||1)}(e,h)&&o.conditionByQuantity(e,h)}));return t&&(b=b.map((function(e){var t=l.find((function(t){return t.promotion_advance_id==e.id}));return t?jt(jt({id:t.promotion_advance_id},t.promotion_advance_info),{},{activated_promotion_advances_id:t.id}):e}))),b.map((function(t){var n;if(["discount_by_product","fixed_prices"].includes(t.type)||["coupon","discount_by_attachment_products"].includes(t.type)&&null!==(n=t.items)&&void 0!==n&&n.length){var r=!1;return t.items.map((function(n){if("discount_by_attachment_products"==t.type){var o=e.filter((function(e){return e.productId==n.product_id})),a=e.find((function(e){return n.attachment_product_info.find((function(t){return t.product_id==e.productId}))}));if(o.length>0&&a){var i=o.reduce((function(e,t){return e+t.quantity}),0);Math.floor(i/n.discount_info_by_attachment_product.quantity)>0&&(r=!0)}}else{var c=e.find((function(e){return t.is_variation?e.variationId==n.variation_id:e.productId==n.product_id}));if(c){if("discount_by_product"==t.type){var s=1==t.is_variation||"true"==t.is_variation?c.quantity:e.reduce((function(e,t){return e+(t.productId==c.productId?t.quantity:0)}),0);n.level_info.find((function(e){return e.from_quantity<=s&&e.to_quantity>=s}))&&(r=!0)}["fixed_prices","coupon"].includes(t.type)&&(r=!0)}}})),r?t:null}return t})).filter((function(e){return e}))})),Object(Z.a)(Object(G.a)(o),"findPromotionAdvanceCanbeActive",(function(e,t){if(!o.state.noDiscountWholesale){var n=Te()(o.state.activatedPromotionAdvance),r=o.reFormatItems(),a=o.getPromotionAdvanceAvailable(r,e),i=[];if(a.map((function(e){if("discount_by_product"==e.type||"fixed_prices"==e.type){var t=!1;e.items.map((function(n){t||(1!=e.is_variation&&"true"!=e.is_variation||!r.find((function(e){return e.variationId==n.variation_id})))&&(0!=e.is_variation&&"false"!=e.is_variation||!r.find((function(e){return e.productId==n.product_id})))||(t=!0)})),t&&i.push(e)}else i.push(e)})),0==r.length&&(i=[]),(e||o.dontUpdateLatestRetailPrice())&&(e||(n=n.filter((function(e){return"fixed_prices"==e.promotion_advance_info.type}))),i=Ce()(i.concat(n.filter((function(e){return!["coupon_id_multiple_times","discount_by_coupon_id"].includes(e.promotion_advance_info.type)})).map((function(e){return jt(jt({},e.promotion_advance_info),{},{id:e.promotion_advance_id,activated_promotion_advances_id:e.id})}))),"id")),0==i.length&&(n=[]),i.length>0&&!e){var c,s=o.getCurrentShop(),d=[];if((d=i.filter((function(e){return!o.state.listPromotionDeactive.includes(e.id)||n.find((function(t){return t.promotion_advance_info.id==e.id}))}))).filter((function(e){return(e.bonus_items||[]).length>0})).length&&o.handleBonusItemsWhenDeactivatePromotionAdvance(t),d=d.filter((function(e){return 0==(e.bonus_items||[]).length})).sort((function(e,t){return(t.priority_level||0)-(e.priority_level||0)})),s&&s.no_activate_duplicate_promotions){var u=[];d=d.map((function(e){var t=o.getItemIsApplying(e),n=t.map((function(e){return e.variationId}));return u.find((function(e){return n.includes(e.variationId)}))?null:(u=u.concat(t),e)})).filter((function(e){return e}))}s&&s.settings.only_active_one_promotion&&(null===(c=d)||void 0===c?void 0:c.length)>0&&(d=[d[0]]),n=d.filter((function(e){return!(o.state.displayId&&!o.state.isEmptyCart)||n.map((function(e){return e.promotion_advance_id})).includes(e.id)})).map((function(e){return{id:e.activated_promotion_advances_id||null,promotion_advance_id:e.id,promotion_advance_info:e}})).filter((function(e){return e}));var l=[],p=[];n.filter((function(e){return"fixed_prices"==e.promotion_advance_info.type})).map((function(e){var t,n;1==e.promotion_advance_info.is_variation||"true"==e.promotion_advance_info.is_variation?null===(t=e.promotion_advance_info.items)||void 0===t||t.map((function(e){return l.push(e.variation_id)})):null===(n=e.promotion_advance_info.items)||void 0===n||n.map((function(e){return p.push(e.product_id)}))})),o.state.cart.find((function(e){return l.includes(e.variationId)&&p.includes(e.productId)}))&&(n=n.filter((function(e){return"fixed_prices"!=e.promotion_advance_info.type})))}n=n.filter((function(e){return!["coupon_id_multiple_times","discount_by_coupon_id"].includes(e.promotion_advance_info.type)}));var m=(o.state.selectBonusItem||[]).filter((function(e){return(i||[]).find((function(t){return t.id!=e.promotionAdvanceId}))}));o.setState({promotionAdvanceCanbeActive:i,selectBonusItem:m,activatedPromotionAdvance:n.concat(o.state.activatedPromotionAdvance.filter((function(e){return["coupon_id_multiple_times","discount_by_coupon_id"].includes(e.promotion_advance_info.type)}))),isChangeFreeShipPromotion:n&&n.length>0?!e:o.state.isChangeFreeShipPromotion}),setTimeout((function(){e||o.handleItemsWhenActivePromotionAdvance()}),200)}})),Object(Z.a)(Object(G.a)(o),"getItemIsApplying",(function(e){switch(e.type){case"fixed_prices":case"discount_by_product":return o.reFormatItems().filter((function(t){return e.items.find((function(n){return e.is_variation?n.variation_id==t.variationId:n.product_id==t.productId}))&&!0}));case"coupon":var t,n=o.getItemInCoupon(e),r=o.reFormatItems();return(null===(t=e.items)||void 0===t?void 0:t.length)>0&&(n=r.filter((function(t){return e.items.find((function(n){return e.is_variation?n.variation_id==t.variationId:n.product_id==t.productId}))&&!0}))),n;default:return[]}})),Object(Z.a)(Object(G.a)(o),"handleBonusItemsWhenDeactivatePromotionAdvance",(function(e){var t=o.state.activatedPromotionAdvance,n=Te()(o.state.cart);t.filter((function(e){return(e.promotion_advance_info.bonus_items||[]).length>0})).map((function(t){t.promotion_advance_info.bonus_items.map((function(t){var r=n.findIndex((function(e){return!e.isBonusProduct&&e.bonusEachProduct&&e.bonusEachProduct.length&&-1!=e.bonusEachProduct.findIndex((function(e){return e.variation_id==t.variation_id}))||!e.isBonusProduct&&e.bonusEachVariation&&e.bonusEachVariation.length&&-1!=e.bonusEachVariation.findIndex((function(e){return e.variation_id==t.variation_id}))})),o=n.findIndex((function(e){return e.isBonusProduct&&e.variationId==t.variation_id}));o>-1&&(!e||e&&r<0)&&(n[o].quantity-=t.quantity)}))})),n=n.filter((function(e){return e.quantity>0})),o.setState({cart:n})})),Object(Z.a)(Object(G.a)(o),"findPromotionAdvanceCoupon",(function(e){var t=o.state,n=t.activatedPromotionAdvance,r=t.cart,a=o.getCurrentShop(),i=Te()(o.state.hasPromotionByCouponId),c=Te()(o.state.couponValue);if(e){var s=n.filter((function(e){return["coupon_id_multiple_times","discount_by_coupon_id"].includes(e.promotion_advance_info.type)}));s.length>0&&(i=!0,c=s[0].promotion_advance_info.name||"")}0==(null===r||void 0===r?void 0:r.length)?i=!1:e||(i=a&&a.has_promotion_by_coupon_id),o.setState({hasPromotionByCouponId:i,couponValue:c})})),Object(Z.a)(Object(G.a)(o),"dontUpdateLatestRetailPrice",(function(){var e,t=o.getCurrentShop();return t&&0==(null===(e=t.settings)||void 0===e?void 0:e.update_latest_retail_price)&&!o.state.displayId})),Object(Z.a)(Object(G.a)(o),"handleItemsWhenActivePromotionAdvance",(function(){if(!o.dontUpdateLatestRetailPrice()){var e=o.state.activatedPromotionAdvance,t=Te()(o.state.cart),n=[];e.filter((function(e){return"fixed_prices"==e.promotion_advance_info.type})).map((function(e){n=n.concat(e.promotion_advance_info.items)})),t=0==n.length?t.map((function(e){return e.retailPrice=Te()(null==e.retailPriceOriginal?e.retailPrice:e.retailPriceOriginal),e.isFixedPrices=!1,delete e.retailPriceOriginal,e})):t.map((function(e){var t=n.find((function(t){return t.variation_id==e.variationId||t.product_id==e.productId}));return e.oneTime||e.isBonusProduct||!t||e.isIncludedAccessory||(e.retailPriceOriginal=Te()(null==e.retailPriceOriginal?e.retailPrice:e.retailPriceOriginal),e.retailPrice=t.fixed_prices,e.isFixedPrices=!0),e})),o.setState({cart:t})}})),Object(Z.a)(Object(G.a)(o),"countMaxQuantityEachProduct",(function(e){for(var t={},n=0;n<e.length;n++)e[n].oneTime||e[n].isBonusProduct||e[n].isIncludedAccessory||(t.hasOwnProperty(e[n].productId)?t[e[n].productId]+=e[n].quantity:t[e[n].productId]=e[n].quantity);var r=0;for(var o in t)r<t[o]&&(r=t[o]);return r})),Object(Z.a)(Object(G.a)(o),"activePromotionProduct",(function(e,t,n){var r=o.state,a=r.activatedPromotionProducts,i=r.isChangeFreeShip,c=Te()(o.state.promotionAdvanceCanbeActive),s=o.getCurrentShop(),d=Te()(a||[]);if(t){var u=!1,l=Te()(o.state.cart),p=Te()(o.state.activatedPromotionAdvance);if(null!==s&&void 0!==s&&s.no_activate_duplicate_promotions&&n){var m=[];p.map((function(e){var t=e.promotion_advance_info.is_variation,n=l.find((function(n){return e.promotion_advance_info.items.find((function(e){return t&&e.variation_id==n.variationId||!t&&e.product_id==n.productId}))}));n&&m.push(n)})),e.items.findIndex((function(t){return m.find((function(n){return e.is_variation&&t.variation_id==n.variationId||!e.is_variation&&t.product_id==n.productId}))}))>-1&&(u=!0)}if(!u){if(c.findIndex((function(t){return t.id==e.id}))>-1&&!n){var h=Te()(o.state.listPromotionDeactive);h.push(e.id),o.setState({listPromotionDeactive:h})}if(n)p.push({promotion_advance_id:e.id,promotion_advance_info:e});else{var v=p.findIndex((function(t){return t.promotion_advance_id==e.id}));p.splice(v,1),"fixed_prices"==e.type&&(l=l.map((function(t){var n=e.items.find((function(e){return e.variation_id==t.variationId||e.product_id==t.productId}));return!t.isBonusProduct&&n&&(t.retailPrice=Te()(null==t.retailPriceOriginal?t.retailPrice:t.retailPriceOriginal),t.isFixedPrices=!1,delete t.retailPriceOriginal),t})))}o.setState({promotionAdvanceCanbeActive:c,activatedPromotionAdvance:p,isChangeFreeShip:!!(p&&p.length>0)||i,cart:l},(function(){setTimeout((function(){o.handleItemsWhenActivePromotionAdvance()}),200)})),n?o.handleOpenModalBonusItems(e):o.handleDeleteBonusItemsFromPromotionAdvance(e)}}else{!d||d.findIndex((function(t){return t.promotion_product_id==e.id}));if(n)d.push({promotion_product_id:e.id,promotion_product_info:e});else{var f=d.findIndex((function(t){return t.promotion_product_id==e.id}));d.splice(f,1)}o.setState({activatedPromotionProducts:d,isChangeFreeShip:!!(d&&d.length>0)||i,onActivePromotions:{active:n,onActive:!0,data:[{promotion_product_id:e.id,promotion_product_info:e}]}})}})),Object(Z.a)(Object(G.a)(o),"tranformItemToSendRequest",(function(e){return{variation_id:e.id,product_id:e.product_id,one_time_product:e.oneTime,quantity:e.quantity,variation_info:{name:e.product.name,id:e.custom_id||e.display_id,product_id:e.product.custom_id||e.product.display_id},variations_warehouses:e.variations_warehouses}})),Object(Z.a)(Object(G.a)(o),"fetchBonusItems",(function(e){var t=o.props,n=t.accessToken,r=t.shopId,a=o.state.warehouseId,i="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(r,"/promotion_advance/get_bonus_items?access_token=").concat(n),c=e.map((function(e){return{variation_id:e.variation_id,quantity:e.quantity}}));return We()({method:"post",url:i,params:{bonus_items:c,warehouse_id:a}}).then((function(e){return e.data.data})).catch((function(){console.log("L\u1ed7i t\u1ea3i s\u1ea3n ph\u1ea9m khuy\u1ebfn m\xe3i")}))})),Object(Z.a)(Object(G.a)(o),"handleOpenModalBonusItems",(function(e){var t;if(null!==(t=e.bonus_items)&&void 0!==t&&t.length){var n=[];Object(Ue.s)(e.bonus_items,500).forEach(function(){var t=Object(H.a)(L.a.mark((function t(r){return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.fetchBonusItems(r).then((function(e){e.forEach((function(e){var t=o.tranformItemToSendRequest(e);n.push(t)}))}));case 2:e.bonus_items.length==n.length&&(e.bonus_items=n,o.setState({selectedPromotionAdvance:e,visibleModalBonusItems:!0}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}})),Object(Z.a)(Object(G.a)(o),"handleDeleteBonusItemsFromPromotionAdvance",(function(e){var t=o.state.cart,n=Te()(o.state.selectBonusItem)||[],r=e.activated_promotion_advances_id?e.bonus_items:e.bonus_items.filter((function(t){return n.find((function(n){return n.promotionAdvanceId==e.id&&n.bonusItem.variationId==t.variation_id}))})),a=t.filter((function(e){return e.isBonusProduct})).map((function(e){var t=r.find((function(t){return t.variation_id==e.variationId}));return t&&(e.quantity=e.quantity-t.quantity),e})).filter((function(e){return e.quantity>0}));a=t.filter((function(e){return!e.isBonusProduct})).concat(a),n=n.filter((function(t){return t.promotionAdvanceId!=e.id})),o.setState({cart:a,selectBonusItem:n})})),Object(Z.a)(Object(G.a)(o),"findComboCanBeActiveAgain",(function(e){var t=o.state,n=t.disabledComboVariation,r=t.disabledComboProduct,a=t.disabledComboCategory;e.length<=0&&(n&&!r&&a&&o.setState({comboBy:"product"},(function(){o.findComboCanBeActive()})),!n&&r&&a&&o.setState({comboBy:"variation"},(function(){o.findComboCanBeActive()})),n&&r&&!a&&o.setState({comboBy:"category"},(function(){o.findComboCanBeActive()})))})),Object(Z.a)(Object(G.a)(o),"oldCodeComboByProduct",(function(){var e=o.state,t=e.insertedAt,n=e.recentOrderId;return!!(n&&Qe()(t).unix()<At)||!n&&Qe()().unix()<Qe()("2022-05-10T12:00:00").unix()})),Object(Z.a)(Object(G.a)(o),"setupVariationsByComboProduct",(function(e){var t;if(!o.oldCodeComboByProduct()){var n=o.state,r=n.comboBy,a=n.recentOrderId,i=Te()(o.state.cart);if("variation"==r||null===(t=e)||void 0===t||!t.length)return i=i.reduce((function(e,t){return t.quantityByComboProducts&&(t.quantityByComboProducts=[]),e.push(t),e}),[]),o.setState({cart:i});var c=i.filter((function(e){return e.isBonusProduct}));i=(i=o.reBundledProducts(i)).reduce((function(e,t){return t.id?e.push(t):e.push(jt(jt({},t),{},{key:Object(Ue.ib)()})),e}),[]);var s=(e=e.sort((function(e,t){return e.sort_index-t.sort_index}))).filter((function(e){return!e.combo_product_info.is_variation})).reduce((function(e,t){var n,r,o=t.combo_product_variations||(null===(n=t.combo_product_info)||void 0===n?void 0:n.combo_product_variations)||[],a=t.quantity_combo_activated||(null===(r=t.combo_product_info)||void 0===r?void 0:r.quantity_combo_activated)||1,i=o.reduce((function(e,n){var r,o;return e.push({combo_id:(null===(r=t.combo_product_info)||void 0===r?void 0:r.id)||t.combo_product_id,product_id:n.product_id,count:n.count*a,name:(null===(o=t.combo_product_info)||void 0===o?void 0:o.name)||t.name||""}),e}),[]);return e.concat(i)}),[]).reduce((function(e,t){var n=[];if(e.filter((function(e){return e.productId==t.product_id})).map((function(e){var t=(e.quantityByComboProducts||[]).reduce((function(e,t){return e+t.count}),0);(0==t||t<e.quantity)&&n.push(e)})),(null===n||void 0===n?void 0:n.length)>0){var r=t.count;n.map((function(n){var o=(n.quantityByComboProducts||[]).reduce((function(e,t){return e+t.count}),0),i=n.quantity-o,c=n.quantityByComboProducts||[];c.push({combo_id:t.combo_id,count:r>=i?i:r,name:t.name||"",color:Object(Ue.gb)(t.combo_id)}),n.quantityByComboProducts=c,r=r>=i?r-i:0;var s=e.findIndex((function(e){return a&&e.id?e.id==n.id:e.key==n.key}));e[s]=n}))}else{var o=i.filter((function(e){return e.quantity>0&&e.productId==t.product_id})),c=t.count;o.map((function(n){var r={combo_id:t.combo_id,name:t.name||"",color:Object(Ue.gb)(t.combo_id)};c>=n.quantity?(r.count=n.quantity,c-=n.quantity):(r.count=c,c=0),n.quantityByComboProducts=[r],e.push(n)}))}return e}),[]);s=s.reduce((function(e,t){var n=(t.quantityByComboProducts||[]).filter((function(e){return e.count>0}));return n.length?t.quantityByComboProducts=n:t.quantityByComboProducts=[],e.push(t),e}),[]),i=i.reduce((function(e,t){var n=s.findIndex((function(e){return a&&t.id?e.id==t.id:e.key==t.key}));return n>-1?e.push(s[n]):e.push(t),e}),[]).concat(c),o.setState({cart:i})}})),Object(Z.a)(Object(G.a)(o),"getAllChildCategories",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.state.categories,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return t?(t.map((function(t){var r,a;if(t.id!=e&&e){if((null===(r=t.nodes)||void 0===r?void 0:r.length)>0)return o.getAllChildCategories(e,t.nodes,n)}else if(n.push(t.id),(null===(a=t.nodes)||void 0===a?void 0:a.length)>0)return o.getAllChildCategories(null,t.nodes,n)})),n):[]})),Object(Z.a)(Object(G.a)(o),"findComboCanBeActive",(function(e,t,n){if(!o.state.noDiscountWholesale){var r=o.reFormatItems(),a=o.state,i=(a.cart,a.comboBy),c=a.currency,s=[],d=[],u=[],l=[],p=Te()(t),m=r.reduce((function(e,t){return t.comboProducts&&0!=t.comboProducts.length?t.isBonusProduct||t.isIncludedAccessory?e:e.concat(t.comboProducts.filter((function(t){return-1==e.findIndex((function(e){return e.id==t.id}))}))||[]):e}),[]),h=r.reduce((function(e,t){return t.comboVariations&&0!=t.comboVariations.length?t.isBonusProduct||t.isIncludedAccessory?e:e.concat(t.comboVariations.filter((function(t){return-1==e.findIndex((function(e){return e.id==t.id}))}))||[]):e}),[]),v=o.getCurrentShop(),f=((null===v||void 0===v?void 0:v.combo_availability)||[]).filter((function(e){return e.is_categories})),_=m.concat(h).concat(f),b=Qe()().unix(),g=(null===v||void 0===v?void 0:v.currency)||"VND";(_=_.filter((function(e){var t=e.order_types||[];return(!t.length||t.includes("all")||t.includes("online"))&&(!e.start_time||Qe()(e.start_time).unix()<=b)&&(!e.end_time||Qe()(e.end_time).unix()>=b)&&(!e.currency&&(c||g)==g||e.currency==(c||g))}))).length>0&&_.find((function(e){return e.is_categories}))&&e&&o.setState({comboBy:"category"});var O=o.oldCodeComboByProduct();_.forEach((function(t){t.is_categories?function(t){var n,a=0,c=[];t.categories.map((function(e){var t=o.getAllChildCategories(e.id),n=r.filter((function(e){return o.compare2Array(e.categoryIds,t)})),i=n.reduce((function(e,t){return e+t.quantity-(t.quantity_in_combo_by_categories||0)}),0);n&&i>=e.quantity&&(c.push(Math.floor(i/e.quantity)),a+=1)})),a>0&&a==(null===(n=t.categories)||void 0===n?void 0:n.length)&&(c.sort((function(e,t){return e-t})),t.quantity_combo_activated=c[0],("category"==i||e)&&s.push(t),o.setState({disabledComboCategory:!1}),l.push(t))}(t):function(e){var t,n=[],a=[],c=0,l=0;if(e.combo_product_variations.forEach((function(e){if(t=e.variation_id,-1!=r.findIndex((function(t){return e.variation_id&&t.variationId==e.variation_id&&t.quantity>=e.count}))){c++;var o=r.findIndex((function(t){return e.variation_id&&t.variationId==e.variation_id}));o>-1&&n.push(Math.floor(r[o].quantity/e.count))}if(!e.variation_id&&-1!=r.findIndex((function(t){return e.product_id==t.productId}))){var i=0;r.forEach((function(t){e.variation_id||e.product_id!=t.productId||(i+=t.quantity)})),!e.variation_id&&e.count<=i&&(l++,O||a.push(Math.floor(i/e.count)))}})),c==e.combo_product_variations.length){n.sort((function(e,t){return e-t}));var p=jt(jt({},e),{},{quantity_combo_activated:n[0]});"variation"==i?null!=t&&s.push(p):"product"==i&&null==t&&s.push(p),o.setState({disabledComboVariation:!1}),d.push(p)}else l==e.combo_product_variations.length&&(O||(a.sort((function(e,t){return e-t})),e.quantity_combo_activated=a[0]),"variation"==i?null!=t&&s.push(e):"product"==i&&null==t&&s.push(e),o.setState({disabledComboProduct:!1}),u.push(e))}(t)})),setTimeout((function(){o.findComboCanBeActiveAgain(s)})),d.length<=0&&o.setState({disabledComboVariation:!0}),u.length<=0&&o.setState({disabledComboProduct:!0}),l.length<=0&&o.setState({disabledComboCategory:!0});localStorage.setItem("comboProductsCanBeActive",JSON.stringify(s));var j=Object(K.a)(o.state.activatedComboProducts);if(e&&(s=Ce()(s.concat(j.map((function(e){return jt(jt({},e.combo_product_info),{},{id:e.combo_product_id})}))),"id")),j=j.filter((function(e){return s.find((function(t){return t.id==e.combo_product_id}))})),s.length>0&&!e&&Object(Ue.v)(o.state.statusOrder,2,-1)){var y=s.find((function(e){return e.id==o.state.comboIdSelected}));if(y)j=[{combo_product_id:y.id,combo_product_info:y}];else{if(s.sort((function(e,t){return t.combo_product_variations.reduce((function(e,t){return e+t.count}),0)-e.combo_product_variations.reduce((function(e,t){return e+t.count}),0)})),s.filter((function(e){return e.is_categories})).length>0){var P=s.filter((function(e){return e.is_categories}));P.sort((function(e,t){return(t.categories||[]).reduce((function(e,t){return e+t.quantity}),0)-(e.categories||[]).reduce((function(e,t){return e+t.quantity}),0)})),s=P.concat(s.filter((function(e){return!e.is_categories})))}j=[{combo_product_id:s[0].id,combo_product_info:s[0]}]}}var C=null;C=De()(p,j)?o.state.onActiveCombos:{active:!0,data:j,prevData:p},o.setState({activatedComboProducts:j,onActiveCombos:C}),n&&0==j.length&&0==p.length&&o.setState({onActiveCombos:{active:!1,data:[],prevData:[]}}),o.setState({comboProductsCanBeActive:s},Object(H.a)(L.a.mark((function t(){return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.reFindComboCanBeActive(o.state.activatedComboProducts,s,e);case 2:return t.next=4,o.setupVariationsByComboProduct(o.state.activatedComboProducts);case 4:case"end":return t.stop()}}),t)}))))}})),Object(Z.a)(Object(G.a)(o),"reFindComboCanBeActive",(function(e,t,n){var r=o.state,a=r.comboBy,i=(r.cart,r.isChangeFreeShip),c=o.reFormatItems();c=o.reBundledProducts(c);var s=o.oldCodeComboByProduct(),d=t||JSON.parse(localStorage.getItem("comboProductsCanBeActive")),u=[],l=d.filter((function(t){return-1!=e.findIndex((function(e){return e.combo_product_id==t.id}))}));if("variation"==a||!s){var p="variation"!=a?{type:"product_id",typeCustom:"productId"}:{type:"variation_id",typeCustom:"variationId"},m=p.type,h=p.typeCustom;e.map((function(e){e.combo_product_info.is_categories?e.combo_product_info.categories.map((function(t){var n=o.getAllChildCategories(t.id),r=c.filter((function(e){return o.compare2Array(e.categoryIds,n)})),a=t.quantity*(e.quantity_combo_activated||e.combo_product_info.quantity_combo_activated||1);r.forEach((function(e){a>0&&(e.quantity_in_combo_by_categories=(e.quantity_in_combo_by_categories||0)+a>=e.quantity?e.quantity:a,a=Math.abs(e.quantity-a))}))})):e.combo_product_info.combo_product_variations.map((function(t){-1!=c.findIndex((function(e){return e[h]&&t[m]&&e[h]==t[m]}))&&(u[t[m]]=(u[t[m]]||0)+t.count*(e.quantity_combo_activated||e.combo_product_info.quantity_combo_activated||1))}))})),d.filter((function(t){return-1==e.findIndex((function(e){return e.combo_product_id==t.id}))})).map((function(e){var t,n=[];if(e.is_categories){if((null===(t=e.categories)||void 0===t?void 0:t.length)>0){var r=0,i=[];e.categories.map((function(e){var t=o.getAllChildCategories(e.id),n=c.filter((function(e){return o.compare2Array(e.categoryIds,t)})),a=n.reduce((function(e,t){return e+t.quantity-(t.quantity_in_combo_by_categories||0)}),0);n&&a>=e.quantity&&(i.push(Math.floor(a/e.quantity)),r+=1)})),r>0&&r==e.categories.length?(i.sort((function(e,t){return e-t})),n.push(i[0]),delete e.not_enough_quantity):e.not_enough_quantity=!0}}else"product"==a?e.combo_product_variations.map((function(e){var t=0;if(c.forEach((function(n){e.variation_id||e.product_id!=n.productId||(t+=n.quantity)})),!e.variation_id&&e.count<=t){var r=u[e.product_id]?Math.floor((t-u[e.product_id])/e.count):Math.floor(t/e.count);n.push(r)}})):"variation"==a&&e.combo_product_variations.map((function(e){var t=c.findIndex((function(t){return e.variation_id&&e.variation_id==t.variationId}));if(t>-1){var r=u[c[t].variationId]?Math.floor((c[t].quantity-u[c[t].variationId])/e.count):Math.floor(c[t].quantity/e.count);n.push(r)}}));n.sort((function(e,t){return e-t})),e.quantity_combo_activated=n[0],l.push(e)})),o.setState({comboProductsCanBeActive:l,isAddBonusProduct:!0,isChangeFreeShip:e&&e.length>0?!n:i}),localStorage.setItem("comboProductsCanBeActive",JSON.stringify(l))}})),Object(Z.a)(Object(G.a)(o),"activeComboProduct",(function(e){arguments.length>1&&void 0!==arguments[1]||JSON.parse(localStorage.getItem("comboProductsCanBeActive"));var t=Te()(o.state.activatedComboProducts)||[],n=-1==t.findIndex((function(t){return t.combo_product_id==e.id})),r=t.findIndex((function(t){var n,r;return t.combo_product_id==e.id&&(null===(n=t.combo_product_info)||void 0===n||null===(r=n.bonus_products)||void 0===r?void 0:r.length)}))>-1;if(n)(null==e.quantity_combo_activated||e.quantity_combo_activated>0)&&t.push({combo_product_id:e.id,combo_product_info:e});else{var a=t.findIndex((function(t){return t.combo_product_id==e.id}));a>-1&&t.splice(a,1)}var i={activatedComboProducts:t};(n||r)&&(i=jt(jt({},i),{},{onActiveCombos:{active:n,onActive:!0,data:[{combo_product_id:e.id,combo_product_info:e}]}})),o.setState(i,Object(H.a)(L.a.mark((function e(){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.reFindComboCanBeActive(o.state.activatedComboProducts);case 2:return e.next=4,o.setupVariationsByComboProduct(o.state.activatedComboProducts);case 4:case"end":return e.stop()}}),e)}))))})),Object(Z.a)(Object(G.a)(o),"findBonusProductAvailable",(function(){var e=o.state.cart,t=Te()(e),n=[];t.length&&t.map((function(e){if(e.bonusEachProduct&&e.bonusEachProduct.length>0&&!e.isBonusProduct){var t=Te()(e.bonusEachProduct);n.push.apply(n,Object(K.a)(t))}if(e.bonusEachVariation&&e.bonusEachVariation.length>0&&!e.isBonusProduct){var r=Te()(e.bonusEachVariation);n.push.apply(n,Object(K.a)(r))}}));var r=n.length>0?Ce()(n,"variation_id"):[];r.length>0&&r.map((function(e){var n=0,r=t.filter((function(t){return!t.isBonusProduct&&t.bonusEachProduct&&t.bonusEachProduct.length&&-1!=t.bonusEachProduct.findIndex((function(t){return t.variation_id==e.variation_id}))||!t.isBonusProduct&&t.bonusEachVariation&&t.bonusEachVariation.length&&-1!=t.bonusEachVariation.findIndex((function(t){return t.variation_id==e.variation_id}))}));r.length>0&&r.map((function(t){var r=t.bonusEachProduct.find((function(t){return t.variation_id==e.variation_id})),o=t.bonusEachVariation.find((function(t){return t.variation_id==e.variation_id}));n+=t.quantity*(parseInt(r?r.quantity:0)+parseInt(o?o.quantity:0))})),e.quantity=n,e.bonus_each_product=!0,e.one_time_product=!1,e.variation_info.retail_price=0,e.variation_info.category_ids=[]}));var a=[];r.map((function(e){return a.push(o.convertItemToPushIntoCart(e))}));var i=t.filter((function(e){return!e.isBonusProduct||!e.isBonusEachProduct}));i=i.concat(a),o.setState({cart:i,isAddBonusProduct:!0})})),Object(Z.a)(Object(G.a)(o),"onProductQuantityChange",(function(e,t,n){var r=o.props.cacheDb,a=o.state,i=a.cart,c=a.activatedComboProducts,s=Te()(i),d=parseInt(e)-s[t].quantity;if(s[t].isPriceByWeight){var u=+(s[t].weight*s[t].quantity/e).toFixed(2),l=(s[t].retailPrice*s[t].quantity+s[t].additionPrice)/e,p=Math.floor(l),m=s[t].retailPrice*s[t].quantity+s[t].additionPrice-p*e;s[t].weight=u,s[t].retailPrice=p,s[t].retailPriceWholesaleOriginal=p,s[t].additionPrice=m}s[t].quantity=parseInt(e),s[t].hasChangeQuantity=!0,!o.state.editingOrderId&&r.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:s}),o.setState({cart:s,isUseWholeSale:!0,activatedComboProducts:[]},Object(H.a)(L.a.mark((function r(){var a,s;return L.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(i.length>0)){r.next=5;break}return r.next=3,o.findComboCanBeActive(null,c);case 3:return r.next=5,o.findBonusProductAvailable(d);case 5:return r.next=7,o.findPromotionProductsCanBeActive();case 7:return r.next=9,o.findPromotionAdvanceCanbeActive(!1,!0);case 9:return r.next=11,o.calcDiscountPercent();case 11:null!==(a=o.measureInput[t])&&void 0!==a&&a.input&&n&&(s=+(e/n).toFixed(2),o.measureInput[t].input.value=s.toString().replace(/\./g,Object(Ue.Hb)(o.state.currency)));case 12:case"end":return r.stop()}}),r)})))),o.checkShippingFee(o.state.provinceId,o.state.districtId)})),Object(Z.a)(Object(G.a)(o),"handleDeleteProduct",(function(e,t){var n=o.props.cacheDb,r=o.state,a=r.cart,i=r.activatedComboProducts,c=Te()(a);if(t>-1)return c[t]=jt(jt({},c[t]),{},{isDeleteActualVariationInfo:!0,actualVariationInfo:null}),o.setState({cart:c});c.splice(e,1);var s=c.map((function(e,t){return e.index=t,e}));0==s.filter((function(e){return!e.isBonusProduct&&!e.isBonusEachProduct})).length&&(s=[]),!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:s}),s?o.setState({cart:s,isUseWholeSale:!0,activatedComboProducts:[]},Object(H.a)(L.a.mark((function e(){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.findComboCanBeActive(null,i,!0);case 2:return e.next=4,o.findBonusProductAvailable();case 4:return e.next=6,o.findPromotionProductsCanBeActive();case 6:return e.next=8,o.findPromotionAdvanceCanbeActive();case 8:return e.next=10,o.findPromotionAdvanceCoupon();case 10:return e.next=12,o.calcDiscountPercent();case 12:o.scrollToBottom();case 13:case"end":return e.stop()}}),e)})))):o.setState({cart:s,comboProductsCanBeActive:[],activatedComboProducts:[]})})),Object(Z.a)(Object(G.a)(o),"calcTotalProductPrice",(function(e){return e.reduce((function(e,t){return t.productName?t.oneTime?e+(t.oneTimePrice-o.calcDiscountByDiscountEachProduct(t)):e+(t.retailPrice*t.quantity+(t.additionPrice||0)-o.calcDiscountByDiscountEachProduct(t)):e}),0)})),Object(Z.a)(Object(G.a)(o),"calcDiscountPercent",(function(){var e=o.state,t=e.cart,n=e.discountAmount,r=o.calcTotalProductPrice(t),a=0!=r?Math.round(100*n/r):0;o.setState({orderDiscountPercent:a})})),Object(Z.a)(Object(G.a)(o),"onBookingTotalChange",(function(e,t){var n=o.props,r=(n.conversationId,n.cacheDb),a=o.state.cart;1==t?o.setState({bookingTotalChildren:e.target.value?Math.abs(parseInt(e.target.value)):void 0}):(o.setState({bookingTotalAdults:e.target.value?Math.abs(parseInt(e.target.value)):void 0}),!o.state.editingOrderId&&r.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:a}),o.setState({cart:a}))})),Object(Z.a)(Object(G.a)(o),"onOrderPriceValueChange",(function(e,t,n){var r=o.props.cacheDb,a=t;switch(e){case"discount":var i=0!=n?Math.round(100*a/n):0;o.state.editingOrderId||(r.put({conv_id:o.cacheDbKey,field_name:"order.discountAmount",value:a}),r.put({conv_id:o.cacheDbKey,field_name:"order.orderDiscountPercent",value:i})),o.setState({discountAmount:a,orderDiscountPercent:i});break;case"shipping":!o.state.editingOrderId&&r.put({conv_id:o.cacheDbKey,field_name:"order.shippingFee",value:a}),o.setState({shippingFee:a,isFreeShip:!1,isChangeShippingFee:!0});break;case"payments":o.firstPayments=jt(jt({},o.firstPayments),a),o.setState({payments:a});break;case"transferMoney":case"chargedByCard":case"cash":case"surcharge":case"referralAmountDiscount":!o.state.editingOrderId&&r.put({conv_id:o.cacheDbKey,field_name:"order.".concat(e),value:a}),o.setState(Object(Z.a)({},e,a))}})),Object(Z.a)(Object(G.a)(o),"onPrepaidByPointChange",(function(e){var t=o.props,n=(t.conversationId,t.cacheDb),r=o.state.rewardPointSetting;!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.prepaidPoint",value:e});var a=e*r.point_to_money_ratio.money/r.point_to_money_ratio.point;!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.prepaidMoney",value:a}),o.setState({prepaidPoint:e,prepaidMoney:a})})),Object(Z.a)(Object(G.a)(o),"renderErrorMessage",(function(e,t){var n,r,a=o.props,i=a.dispatch,c=a.t,s=function e(t){var n=Ne()(t).map((function(t){return Ie()(t)?e(t):t}));return Ae()(n)},d=e?e.errors?e.errors.message_code?c("messageCode.".concat(e.errors.message_code)):s(e.errors):e.message_code?c("messageCode.".concat(e.message_code)):s(e.message):null;null===e||void 0===e||null===(n=e.extra_error)||void 0===n||!n.message||null!==(r=d)&&void 0!==r&&r.length||(d=Ie()(e.extra_error.message)?e.extra_error.message.message:e.extra_error.message),i(Object(Ge.a)({message:d||t,title:c("errorNotification"),level:"error",position:"tr",autoDismiss:3}))})),Object(Z.a)(Object(G.a)(o),"editStatus",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0;r?o.setState({isChangeTags:!0}):6==t?o.setState({changeStatusCancel:!0}):o.setState({changeStatusConfirm:!0});var c=o.props,s=c.dispatch,d=c.accessToken,u=c.shopId,l=c.auth,p=c.messages,m=c.conversations,h=c.t,v=(c.pages,o.state.selectedPhone,"".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(u,"/orders/").concat(e,"?access_token=").concat(d));Object(Ue.lc)(v).then((function(c){if(c.success){var v,f,_=c.data;if(_.shipments&&_.shipments[0]&&_.shipments[0].tracking&&!_.extraServices&&!_.service){var b=_.shipments[0].tracking,g=[];b.services&&(b.services.cod_service&&!0===b.services.cod_service.use_cod&&g.push("cod"),!0===b.services.is_receiver_pay&&g.push("is_receiver_pay"),!0===b.services.is_allow_try_out&&g.push("is_allow_try_out"),!0===b.services.is_allow_checking_good&&g.push("is_allow_checking_good")),_.extraServices=g.join(","),_.service=b.services.name}n?(f=_.note?"".concat(_.note,"\n---\n").concat(n):n,v={order:jt(jt({},_),{},{status:t,note:f})}):v=r?{order:jt(jt({},_),{},{tags:r.length?r:-1})}:"undefined"!=typeof i?{order:jt(jt({},_),{},{priority_order:i})}:{order:jt(jt({},_),{},{status:t})};var O="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(u,"/orders/").concat(e,"?access_token=").concat(d);Object(Ue.oc)(O,v).then((function(e){if(e.success){var n,r,i,c,d=p.recentOrders,u=e.data,v=u.display_id,f=u.custom_id,_=u.items.reduce((function(e,t){return t.variation_info.name?e+t.variation_info.retail_price*t.quantity:e}),0),b=o.getRecipientLocation(),g=jt(jt({},o.isLegalToUseRecentOrder()&&d.find((function(e){return e.id==u.id}))||{}),{},{custom_id:u.custom_id,display_id:u.display_id,id:u.id,payment:_-u.discount+u.shipping_fee,phone_number:u.bill_phone_number,email:u.bill_email,received_at_shop:u.received_at_shop,recipient_location:b,shipments:u.shipments,status:u.status,tags:u.tags,inserted_at:u.inserted_at,last_update_status_at:u.last_update_status_at,items:u.items,assigning_seller_id:u.assigning_seller_id,cod:u.cod,prepaid:u.prepaid,order_currency:u.order_currency,note:u.note,creator:u.creator,full_address:null===(n=u.shipping_address)||void 0===n?void 0:n.full_address,address:null===(r=u.shipping_address)||void 0===r?void 0:r.address,note_print:u.note_print,estimate_delivery_date:u.estimate_delivery_date,last_editor:u.last_editor,last_editor_id:u.last_editor_id,receiver:null===(i=u.shipping_address)||void 0===i?void 0:i.full_name});d=o.isLegalToUseRecentOrder()?d.map((function(e){return e.id===g.id?g:e})):d;var O={can_inbox:p.canInbox,notes:p.notes,recent_phone_numbers:p.recentPhoneNumbers,reports_by_phone:p.reportsByPhone,is_banned:p.isBanned,banned_count:p.bannedCount,reported_count:p.reportedCount,comment_count:p.commentCount,last_commented_at:p.lastCommentedAt,recent_orders:d};o.setState({changeStatusConfirm:!1,changeStatusCancel:!1,isChangeTags:!1});var j=o.props.conversations.selectedId;if(m.selectedId===j&&s(Object(ze.M)(O)),s(Object(Ge.a)(Object(Ue.Ed)("".concat(h("conversation.customerInfo.order")," #").concat(f||v," ").concat(h("notification.orderWasChangedWithSuccess"))))),g.phone_number&&6==t&&a){var y={selectedPhone:0==g.phone_number.slice(0,1)?"+62".concat(g.phone_number.substring(1,g.phone_number.length)):g.phone_number,content:"Reject taking delivery!"};s(Object(mt.e)(o.props.pageId,m.selectedId,m.selectedCustomers[0].id,m.selectedCustomers[0].name,l.accessToken,y))}null!==(c=e.extra_error)&&void 0!==c&&c.message&&o.renderErrorMessage(e,h("notification.anErrorOccuredWhileEditingOrder"))}else o.renderErrorMessage(e,h("notification.anErrorOccuredWhileEditingOrder")),o.setState({changeStatusConfirm:!1,changeStatusCancel:!1,isChangeTags:!1})})).catch((function(e){console.log(e),o.setState({changeStatusConfirm:!1,changeStatusCancel:!1,isChangeTags:!1})}))}else{var j=c.message&&c.permission?"".concat(c.message," ").concat(h(c.permission)):null;o.setState({changeStatusConfirm:!1,changeStatusCancel:!1,isChangeTags:!1}),s(Object(Ge.a)({message:j||h(150),title:h("failedText"),level:"error",position:"tr",autoDismiss:3}))}})).catch((function(e){console.log(e),o.setState({changeStatusConfirm:!1,changeStatusCancel:!1,isChangeTags:!1}),s(Object(Ge.a)({message:h(150),title:h("failedText"),level:"error",position:"tr",autoDismiss:3}))}))})),Object(Z.a)(Object(G.a)(o),"checkedSyncPartner",(function(){var e=o.state,t=e.oldWarehouse,n=e.warehouseId,r=e.partner,a=!1;if(r&&r.system_created){var i=Te()(o.state.oldCart),c=Te()(o.state.cart),s=[],d=[];i&&i.length>0&&(s=i.map((function(e){return ye()(e,["quantity","retailPrice","productName","variationText","weight","discountEachProduct"])}))),c&&c.length>0&&(d=c.map((function(e){return ye()(e,["quantity","retailPrice","productName","variationText","weight","discountEachProduct"])}))),De()(s,d)&&t==n||(a=!0)}a?o.setState({visibleConfirmSync:!0,changeInfoPartner:!0}):o.onOrderSubmit("edit")})),Object(Z.a)(Object(G.a)(o),"onCreate",(function(e,t,n,r){var a=o.props,i=a.dispatch,c=a.conversations,s=a.pageWarehouses,d=a.t,u=o.state,l=u.cart,p=u.selectedPhone,m=u.type;Object(Ue.nc)(e,t).then((function(e){if(e.success){var t,n,a,u,h=e.data.display_id,v=e.data.custom_id,f=o.props.messages,_=o.isLegalToUseRecentOrder()&&f.recentOrders||[];2!=m&&(document.getElementById("shippingFee").value="0",document.getElementById("discountAmount").value="0");var b=l&&l.reduce((function(e,t){return t.productName?t.oneTime?e+t.oneTimePrice:e+(t.retailPrice*t.quantity+(t.additionPrice||0)):e}),0),g=o.getRecipientLocation();_=[{custom_id:v,display_id:h,id:e.data.id,cod:e.data.cod,prepaid:e.data.prepaid,payment:b-e.data.discount+e.data.shipping_fee,phone_number:e.data.bill_phone_number,email:e.data.bill_email,received_at_shop:!1,recipient_location:g,shipments:null,status:e.data.status,tags:e.data.tags,inserted_at:e.data.inserted_at,last_update_status_at:e.data.last_update_status_at,items:e.data.items,assigning_seller_id:e.data.assigning_seller_id,order_currency:((null===r||void 0===r?void 0:r.multiple_currency)||[]).length?o.state.currency:null,full_address:null===(t=e.data.shipping_address)||void 0===t?void 0:t.full_address,address:null===(n=e.data.shipping_address)||void 0===n?void 0:n.address,estimate_delivery_date:e.data.estimate_delivery_date,note_print:e.data.note_print,note:e.data.note,creator:e.data.creator,last_editor:e.data.last_editor,last_editor_id:e.data.last_editor_id,receiver:null===(a=e.data.shipping_address)||void 0===a?void 0:a.full_name,customer_referral_code:e.data.customer_referral_code,referral_amount_discount:e.data.referral_amount_discount,is_reward_point:e.data.is_reward_point}].concat(o.isLegalToUseRecentOrder()?_:[]).slice(0,5);var O={can_inbox:f.canInbox,notes:f.notes,recent_phone_numbers:""==p?f.recentPhoneNumbers:[p].concat(f.recentPhoneNumbers),reports_by_phone:f.reportsByPhone,is_banned:f.isBanned,banned_count:f.bannedCount,reported_count:f.reportedCount,comment_count:f.commentCount,last_commented_at:f.lastCommentedAt,recent_orders:_},j=o.props.conversations.selectedId;c.selectedId===j&&i(Object(ze.M)(O)),o.newSelectableAddress=null,o.newSelectablePhone=null;var y=document.getElementById("shippingAddress");y&&(y.value="");var P=document.getElementById("customerPhone");P&&(P.value="");var C=document.getElementById("customerEmail");C&&(C.value=""),i(Object(Ge.a)(Object(Ue.Ed)("".concat(d("conversation.customerInfo.order")," #").concat(v||h," ").concat(d("conversation.customerInfo.wasCreatedSuccess"))))),s.map((function(e){var t=e.id;localStorage.removeItem("warehouse_cart_".concat(t))})),null!==(u=e.extra_error)&&void 0!==u&&u.message&&o.renderErrorMessage(e,d("notification.anErrorOccuredWhileEditingOrder")),o.setState({orderListChange:"created",noteOrder:It(""),noteImages:[],notePrintOrder:It(""),provinceId:"",districtId:"",districts:[],communeId:"",communes:[],postcode:"",postcodes:[],selectedAddress:"",serviceName:"",serviceNameVi:"",services:[],totalPrice:0,totalWeight:0,isReceiverPay:!1,isAllowTryOut:!1,isAllowCheckingGood:!1,isUsingCod:!0,shippingCost:0,codCost:0,shippingFee:0,discountAmount:0,orderDiscountPercent:0,prepaidPoint:0,prepaidMoney:0,transferMoney:0,chargedByCard:0,cash:0,surcharge:0,prepaid:0,activatedComboProducts:[],comboProductsCanBeActive:[],activatedPromotionProducts:[],activatedPromotionAdvance:[],promotionProductsCanBeActive:[],cart:[],bookingTotalChildren:0,bookingTotalAdults:0,reservationDateTime:Qe()(),tags:[],tableIds:[],fbLink:null,assigningSellerId:null,assigningCareId:null,marketerId:null,insertedAt:null,noDiscountWholesale:o.checkDiscountToWholesale(),referralAmountDiscount:0}),o.handleChangeTab(0,!1),o.clearOrderInfo()}else if(e.permission&&""!=e.permission){var x=o.renderError(e.message,e.permission,e.user_has_permission);i(Object(Ge.a)({message:x,title:d("errorNotification"),level:"error",position:"tr",autoDismiss:3}))}else o.renderErrorMessage(e,d("notification.errorOccuredWhileCreatingOrder"));o.setState({savingOrder:!1})})).catch((function(e){console.log(e),o.setState({savingOrder:!1}),o.renderErrorMessage(e,d("notification.errorOccuredWhileCreatingOrder"))}))})),Object(Z.a)(Object(G.a)(o),"setOrderNoteImages",(function(e){o.setState({noteImages:[].concat(Object(K.a)(o.state.noteImages||[]),Object(K.a)(e)).filter((function(e,t,n){return n.findIndex((function(t){return t==e}))===t}))})})),Object(Z.a)(Object(G.a)(o),"parseItemToSendRequest",(function(e){if(e)return{id:e.id,one_time_product:e.oneTime,quantity:e.quantity,variation_id:e.variationId,product_id:e.productId,is_bonus_product:e.isBonusProduct||!1,bonus_each_product:e.isBonusEachProduct||!1,is_fixed_prices:e.isFixedPrices||!1,discount_each_product:0==e.discountEachProduct?0:e.discountEachProduct||null,is_locked:e.isLocked||null,is_discount_percent:0==e.isDiscountPercent?0:e.isDiscountPercent||null,is_wholesale:e.isWholesale||!1,is_wholesale_for_all_variations:e.isWholesaleForAllVariations||!1,variation_info:{name:e.productName,retail_price:e.oneTime?Math.round(e.oneTimePrice/e.quantity):e.retailPrice,retail_price_original:null==e.retailPriceOriginal?null:e.retailPriceOriginal,weight:e.weight,detail:e.variationText,last_imported_price:e.oneTime?e.lastImportedPrice||0:null,measure_info:e.measureInfo,retail_price_wholesale_original:e.retailPriceWholesaleOriginal,images:e.images,addition_price:e.additionPrice||0,is_accessory:e.isIncludedAccessory||!1},manipulation_warehouses:e.manipulationWarehouses,variations_warehouses:[],quantity_by_combo_products:e.quantityByComboProducts||[],note:e.note,assigning_seller_id:e.assigningSellerId||null}})),Object(Z.a)(Object(G.a)(o),"onOrderSubmit",function(){var e=Object(H.a)(L.a.mark((function e(t){var n,r,a,i,c,s,d,u,l,p,m,h,v,f,_,b,g,O,j,y,P,C,x,I,S,A,w,N,k,D,B,T,q,E,M,W,R,F,V,K,Q,H,U,Y,G,z,X,J,$,ee,te,ne,re,oe,ae,ce,se,de,ue,le,pe,me,he,ve,fe,_e,be,ge,Oe,je,ye,Pe,Ce,xe,Ie,Se,Ae,we,Ne,ke,De,Be,Te,qe,Ee,Me,We,Re,Fe,Ve,Le,Ke,He,Ye,Xe,Je,Ze,$e,et,tt,nt,rt,ot,at,it;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.setState({savingOrder:!0}),r=o.props,a=r.dispatch,i=r.accessToken,c=r.pageId,s=r.shopId,d=r.conversations,u=r.messages,l=r.auth,r.pageWarehouses,p=r.t,r.currentShops,m=o.state,h=m.shippingFee,v=m.isFreeShip,f=m.discountAmount,_=m.transferMoney,b=m.chargedByCard,g=m.cash,O=m.surcharge,m.prepaid,j=m.prepaidPoint,y=m.prepaidMoney,P=m.countryId,C=m.provinceId,x=m.districtId,I=m.communeId,S=m.postcode,A=m.cart,w=m.isReceiverPay,N=m.isAllowTryOut,k=m.isAllowCheckingGood,D=m.isUsingCod,B=m.serviceName,T=m.selectedPhone,q=m.selectedEmail,E=m.selectedAddress,M=m.provinces,W=m.districts,R=m.communes,F=m.activatedComboProducts,V=m.activatedPromotionProducts,K=m.activatedPromotionAdvance,Q=m.recentOrderId,H=m.warehouseId,U=m.type,Y=m.reservationDateTime,m.bookingTotalChildren,G=m.bookingTotalAdults,z=m.tags,X=m.statusOrder,J=m.isSendToSnappy,$=m.dontSyncWithSnappy,m.orderCustomerName,ee=m.duplicatedPhone,te=m.duplicatedCustomer,ne=m.partnerId,re=m.cod,oe=m.totalFee,ae=m.notePrintOrder,ce=m.noteOrder,se=m.isCustomerLevel,de=m.returnFree,m.customPartnerFee,ue=m.isCalculationTax,le=m.assigningSellerId,pe=m.assigningCareId,me=m.marketerId,he=m.insertedAt,ve=m.selectedCustomer,fe=m.orderSources,_e=m.account,be=m.estimateDeliveryDate,ge=m.isSaveQuickProduct,Oe=m.noteImages,je=m.customerReferralCode,ye=m.referralAmountDiscount,Pe=m.isRewardPoint,Ce=ce.getPlainText(),xe=2==U?"":ae.getPlainText(),Ie=document.getElementById("customerName").value,localStorage.getItem("".concat(c,"_warehouse")),o.setState({visibleConfirmSync:!1,changeInfoPartner:!1}),2==U&&(A.length<2?A.push({index:1,id:null,variationId:null,oneTime:!0,remain:0,productName:"adult",quantity:G||0,retailPrice:0,oneTimePrice:0,weight:0,lastImportedPrice:0}):A[1].quantity=G||0),Se=o.getCurrentShop(),o.calcTotalProductPrice(A),Ae=2==U?A.map((function(e){return{id:e.id||null,one_time_product:e.oneTime,quantity:e.quantity,variation_id:e.variationId,product_id:e.productId,is_bonus_product:e.isBonusProduct||!1,bonus_each_product:e.isBonusEachProduct||!1,is_fixed_prices:e.isFixedPrices||!1,discount_each_product:0==e.discountEachProduct?0:e.discountEachProduct||null,is_discount_percent:0==e.isDiscountPercent?0:e.isDiscountPercent||null,is_locked:e.isLocked||null,is_wholesale:e.isWholesale||!1,variation_info:{name:e.productName,retail_price:e.oneTime?e.retailPrice:Math.round(e.oneTimePrice/e.quantity),retail_price_original:null==e.retailPriceOriginal?null:e.retailPriceOriginal,last_imported_price:e.oneTime?e.lastImportedPrice||0:null,retail_price_wholesale_original:e.retailPriceWholesaleOriginal,images:e.images},manipulation_warehouses:e.manipulationWarehouses,note:e.note}})):A.filter((function(e){return e.productName})).map((function(e){return jt(jt({},o.parseItemToSendRequest(e)),{},{actual_variation_info:e.oneTime?null:o.parseItemToSendRequest(e.actualVariationInfo),is_delete_actual_variation_info:!e.oneTime&&(e.isDeleteActualVariationInfo||!1)})})),Ne=u.data.length,ke=Ne-1;case 14:if(!(ke>=0)){e.next=22;break}if((De=u.data[ke]).from.id==c||De.is_removed){e.next=19;break}return we=De.id,e.abrupt("break",22);case 19:ke--,e.next=14;break;case 22:if(Be=o.state,Te=Be.provinceName,qe=Be.districtName,Ee=Be.communeName,!Te&&M&&(Te=M.reduce((function(e,t){return t.value===C&&(e=t.label),e}),"")),!qe&&W&&(qe=W.reduce((function(e,t){return t.value===x&&(e=t.label),e}),"")),!Ee&&R&&(Ee=R.reduce((function(e,t){return t.value===I&&(e=t.label),e}),"")),Me="COMMENT"==d.selectedType&&u.post?u.post.id:o.state.selectedPostId,We=(!Ae||0!=Ae.length)&&k,Re=(!Ae||0!=Ae.length)&&N,Ve="".concat(Fe=E).concat(Ee?", ".concat(Ee):"").concat(qe?", ".concat(qe):"").concat(Te?", ".concat(Te):""),Le=u.birthday?u.birthday.date:null,Ke=u.birthday?u.birthday.month:null,He=u.birthday?u.birthday.year:null,Ye={date:Le,month:Ke,year:He},Xe=[],Je=[],K.map((function(e){(e.promotion_advance_info.items||[]).map((function(e){Ae.find((function(t){return t.product_id==e.product_id||t.variation_id==e.variation_id}))&&Xe.push(e)})),Je.push({id:e.id||null,promotion_advance_id:e.promotion_advance_id,promotion_advance_info:jt(jt({},e.promotion_advance_info),{},{items:Xe})}),Xe=[]})),Ze={order:jt((n={shop_id:s,page_id:c,service:B,extraServices:"".concat(D?"cod":"",",").concat(w?"is_receiver_pay":"",",").concat(We?"is_allow_checking_good":"",",").concat(Re?"is_allow_try_out":""),conversation_id:d.selectedId,message_id:we,page_customer_id:ve?ve.id:d.selectedCustomers[0].id,shipping_fee:h,is_free_shipping:v,discount:f,prepaid_by_point:{point:j,money:y},transfer_money:_,charged_by_card:b,prepaid:_+b+g+o.totalPayments(),surcharge:O,status:X,note:Ce,note_print:xe,received_at_shop:!1,note_image:Oe,warehouse_id:H,bill_full_name:Ie,bill_phone_number:T,bill_email:q,customer_birthday:Ye,customer_gender:u.gender?u.gender:null,items:Ae,order_sources:fe,account:_e,activated_combo_products:F,activated_promotion_products:V,activated_promotion_advances:Je,shipping_address:{country_code:P,province_id:C,district_id:x,commune_id:I,post_code:S,address:Fe,full_name:Ie,phone_number:T,full_address:Ve},tags:"edit"==t&&(!z||z&&0==z.length)?-1:z,post_id:Me||null,is_send_to_snappy:J,dont_sync_with_snappy:$,duplicated_phone:ee,duplicated_customer:te,partner:jt(jt({},o.state.partner),{},{partner_id:void 0==ne?void 0:/^\d+$/.test(ne)?parseInt(ne):ne,cod:re,total_fee:oe}),is_customer_level:se,change_info_partner:o.state.changeInfoPartner,return_fee:de,is_calculation_tax:ue,assigning_seller_id:le||(Se&&Se.auto_assign_creator?l.userId:null),assigning_care_id:pe||null,pke_mkter:me||null,inserted_at:he||null},Object(Z.a)(n,"is_free_shipping",v),Object(Z.a)(n,"order_currency",o.state.currency),Object(Z.a)(n,"estimate_delivery_date",be||null),Object(Z.a)(n,"is_save_quick_product",ge||!1),Object(Z.a)(n,"customer_referral_code",je||"-1"),Object(Z.a)(n,"referral_amount_discount",ye),Object(Z.a)(n,"is_reward_point",null==Pe||Pe),n),o.paymentParams())},Ae.find((function(e){return e.one_time_product&&!e.id}))||delete Ze.order.is_save_quick_product,Ze.order.hasOwnProperty("estimate_delivery_date")&&!Ze.order.estimate_delivery_date&&delete Ze.order.estimate_delivery_date,void 0==Ze.order.partner.partner_id&&delete Ze.order.partner,0==((null===Se||void 0===Se?void 0:Se.multiple_currency)||[]).length&&delete Ze.order.order_currency,2==U&&(Ze.order.reservation_datetime=Qe()(Y).unix(),Ze.order.table_ids=o.state.tableIds),(Se&&Se.custom_partners||[]).find((function(e){return e.id==ne}))&&(Ze.order.partner_fee=o.checkedCustomPartner(ne)),!Ze.order.items.find((function(e){return e.is_locked}))){e.next=50;break}return $e={message:p("notification.variationIsLocked")},o.renderErrorMessage($e),o.setState({savingOrder:!1}),e.abrupt("return");case 50:if(!(o.props.pageWarehouses&&o.props.pageWarehouses.length>0)){e.next=57;break}if(!Ze.order.items.find((function(e){var t=(e.manipulation_warehouses||[]).filter((function(e){return(o.props.pageWarehouses.map((function(e){return e.id}))||[]).includes(e)}));return t&&t.length>0&&!t.includes(Ze.order.warehouse_id)}))){e.next=57;break}return et={message:p("notification.variationManipulationWarehouses")},o.renderErrorMessage(et),o.setState({savingOrder:!1}),e.abrupt("return");case 57:if(H){e.next=62;break}return tt={message:p("notification.noWarehouse")},o.renderErrorMessage(tt),o.setState({savingOrder:!1}),e.abrupt("return");case 62:"create"==t&&(Ze.order.no_discount_to_wholesale=o.checkDiscountToWholesale()),nt="",e.t0=t,e.next="create"===e.t0?67:"edit"===e.t0?72:75;break;case 67:for(at in rt=0,ot=0,u.reportsByPhone)it=u.reportsByPhone[at],rt+=it.order_success||0,ot+=it.order_fail||0;return nt="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(s,"/orders?access_token=").concat(i),null!==Se&&void 0!==Se&&Se.percent_order_refunds&&0!==Se.percent_order_refunds&&ot/rt*100>parseInt(Se.percent_order_refunds)?(o.setState({savingOrder:!1}),ie.a.confirm({title:p("conversation.createOrder.confirmContinueToCreateOrder",{percent_order_refunds:Se.percent_order_refunds}),okText:p("conversation.createOrder.continue"),cancelText:p("conversation.createOrder.cancel"),onOk:function(){o.setState({savingOrder:!0}),o.onCreate(nt,Ze,t,Se)}})):o.onCreate(nt,Ze,t,Se),e.abrupt("break",75);case 72:return nt="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(s,"/orders/").concat(Q,"?access_token=").concat(i),Object(Ue.oc)(nt,Ze).then((function(e){if(e.success){var t,n,r,i,c=o.props.messages,s=(o.state.openEditOrder,c.recentOrders),u=e.data,l=u.display_id,m=u.custom_id,h=u.items.reduce((function(e,t){return t.variation_info.name?e+t.variation_info.retail_price*t.quantity:e}),0),v=o.getRecipientLocation(),f={custom_id:u.custom_id,display_id:u.display_id,id:u.id,cod:u.cod,prepaid:u.prepaid,payment:h-u.discount+u.shipping_fee,phone_number:u.bill_phone_number,email:u.bill_email,received_at_shop:u.received_at_shop,recipient_location:v,shipments:u.shipments,status:u.status,tags:u.tags,inserted_at:u.inserted_at,last_update_status_at:u.last_update_status_at,items:u.items,order_currency:u.order_currency,full_address:null===(t=u.shipping_address)||void 0===t?void 0:t.full_address,address:null===(n=u.shipping_address)||void 0===n?void 0:n.address,estimate_delivery_date:u.estimate_delivery_date,note_print:u.note_print,note:u.note,creator:u.creator,last_editor:u.last_editor,last_editor_id:u.last_editor_id,receiver:null===(r=u.shipping_address)||void 0===r?void 0:r.full_name,customer_referral_code:u.customer_referral_code,is_reward_point:u.is_reward_point,third_party_infomation:u.third_party_infomation,full_name:u.bill_full_name};s=o.isLegalToUseRecentOrder()?s.map((function(e){return e.id===f.id?f:e})):s;var _=(u.items||[]).map((function(e,t){var n=e.actual_variation_info&&o.renderItemToCart(e.actual_variation_info,0,!0);return jt(jt({},o.renderItemToCart(e,t)),{},{actualVariationInfo:n})})),b={can_inbox:c.canInbox,notes:c.notes,recent_phone_numbers:""==T?c.recentPhoneNumbers:[T].concat(c.recentPhoneNumbers),is_banned:c.isBanned,banned_count:c.bannedCount,reports_by_phone:c.reportsByPhone,reported_count:c.reportedCount,comment_count:c.commentCount,last_commented_at:c.lastCommentedAt,recent_orders:s};o.setState({orderListChange:"edited",cart:_});var g=o.props.conversations.selectedId;d.selectedId===g&&a(Object(ze.M)(b)),a(Object(Ge.a)(Object(Ue.Ed)("".concat(p("conversation.customerInfo.order")," #").concat(m||l," ").concat(p("notification.orderWasChangedWithSuccess"))))),null!==(i=e.extra_error)&&void 0!==i&&i.message&&o.renderErrorMessage(e,p("notification.anErrorOccuredWhileEditingOrder"))}else o.renderErrorMessage(e,p("notification.anErrorOccuredWhileEditingOrder"));o.setState({savingOrder:!1})})).catch((function(e){console.log(e),o.setState({savingOrder:!1}),o.renderErrorMessage(e,p("notification.anErrorOccuredWhileEditingOrder"))})),e.abrupt("break",75);case 75:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(Z.a)(Object(G.a)(o),"renderError",(function(e,t,n){var r=o.props,a=r.t,c=r.shopId,s="".concat("https://pos.pages.fm/permission-support","?id=").concat(c),d=encodeURI(s);return Object(i.jsxs)("div",{children:[e," ",t?a("".concat(t)):"",". ",a("notification.contactPermission")," ",Object(i.jsx)("a",{href:d,target:"_blank",children:a("notification.here")})]})})),Object(Z.a)(Object(G.a)(o),"handleChangeServices",(function(e,t){var n=o.props.pageId,r=t.target.checked;switch(e){case"isReceiverPay":o.setState({isReceiverPay:r}),localStorage.setItem("".concat(n,"_isReceiverPay"),r);break;case"isUsingCod":o.setState({isUsingCod:r}),localStorage.setItem("".concat(n,"_isUsingCod"),r);break;case"isAllowCheckingGood":o.setState({isAllowCheckingGood:r}),localStorage.setItem("".concat(n,"_isAllowCheckingGood"),r);break;case"isAllowTryOut":o.setState({isAllowTryOut:r}),localStorage.setItem("".concat(n,"_isAllowTryOut"),r)}})),Object(Z.a)(Object(G.a)(o),"getRecentPhoneOptions",(function(){var e=o.props.messages.recentPhoneNumbers;if(e)return e.map((function(e){return Object(i.jsx)(F.a.Option,{text:e,children:Object(i.jsx)("span",{children:e})},e)}))})),Object(Z.a)(Object(G.a)(o),"getRecentEmailOptions",(function(){var e=o.props.messages.recentOrders,t=[];return o.isLegalToUseRecentOrder()&&e.forEach((function(e){e.email&&t.push({value:e.email,label:e.email})})),t.filter((function(e,t,n){return t==n.indexOf(e)}))})),Object(Z.a)(Object(G.a)(o),"getRecentAddressOptions",(function(e){var t=o.state.countries,n=[];if(e){var r=(e.shop_customer_addresses||[]).reduce((function(e,t){return t.address&&-1==n.findIndex((function(e){return e==t.address}))&&(n.push(t.address),e.push({id:t.id,value:t.address,label:t.full_address,provinceId:t.province_id,districtId:t.district_id,communeId:t.commune_id,customerFullName:t.full_name,countryCode:t.country_code})),e}),[]),a=Object(G.a)(o).newSelectableAddress;return 1==t.length?"84"==t[0]?r.filter((function(e){return e.countryCode==t[0]||!e.countryCode})):r.filter((function(e){if(e.provinceId){var n=e.provinceId?e.provinceId.indexOf("_"):-1,r=e.provinceId?"-1"==n?"84":e.provinceId.slice(0,n):"84";return e.countryCode==t[0]||r==t[0]}return!0})):a?r.concat([a]):r}return[]})),Object(Z.a)(Object(G.a)(o),"onEmailSelected",(function(e){var t=e&&e.value?e.value:"";o.setState({selectedEmail:t});var n=document.getElementById("customerEmail");n.value=t,n.focus()})),Object(Z.a)(Object(G.a)(o),"onSelectAddress",(function(e,t){var n=o.getRecentAddressOptions().find((function(t){return t.id==e})),r=t.find((function(t){return t.key==e})),a=(null===r||void 0===r?void 0:r.value)||null;o.setState({selectedAddress:a,countryId:"",provinceId:"",provinceName:"",districtId:"",districtName:"",communeId:"",communeName:""}),n?o.onAddressSelected(n):o.autoFillShippingAddress(r)})),Object(Z.a)(Object(G.a)(o),"onAddressSelected",(function(e){var t=e.provinceId?e.provinceId.indexOf("_"):-1,n=e.provinceId?"-1"==t?"84":e.provinceId.slice(0,t):o.state.countryId,r=e.countryCode?e.countryCode:n,a=e&&e.value?e.value:e.address?e.address:"";o.setState({selectedAddress:a});var i=o.state,c=i.warehouseId,s=i.partner,d=e.provinceId||e.province_id,u=e.districtId||e.district_id,l=e.communeId||e.commune_id;e.customerFullName&&o.setState({customerName:e.customerFullName}),r&&o.onChangeCountry(r,!1),d&&o.onProvinceSelected({value:d},!1),u&&o.onDistrictSelected({value:u},!1),l&&o.onCommuneSelected({value:l},!1),e.post_code&&o.handlePostcode(e.post_code,!0),!c||!d||u||s&&s.extend_code||o.handleAutoFillTransport(d,null),c&&d&&u&&(s&&s.extend_code||o.handleAutoFillTransport(d,u))})),Object(Z.a)(Object(G.a)(o),"onChangePhoneNumber",(function(e){var t=o.props.cacheDb;!o.state.editingOrderId&&t.put({conv_id:o.cacheDbKey,field_name:"order.selectedPhone",value:e}),o.setState({selectedPhone:e},(function(){return o.onPhoneSelected()}))})),Object(Z.a)(Object(G.a)(o),"onSearchAddress",(function(e){var t=e&&e.target&&e.target?e.target.value:e;o.setState({selectedAddress:t}),t&&o.dataAddressSource(t)})),Object(Z.a)(Object(G.a)(o),"onChangeAddress",(function(e,t){void 0==e&&o.setState({countryId:"",provinceId:"",provinceName:"",districtId:"",districtName:"",districts:[],communeId:"",communeName:"",communes:[],addressSource:null,postcode:"",postcodes:[]});var n=o.props.cacheDb,r=t.find((function(t){return t.key==e}));!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.selectedAddress",value:r?r.value?r.value:r.label:e}),o.setState({disableShipOrder:!1}),o.dataAddressSource(e)})),Object(Z.a)(Object(G.a)(o),"checkCartValue",(function(e){return e.filter((function(e){return null!=e.productName&&""!=e.productName})).length>0})),Object(Z.a)(Object(G.a)(o),"onChangeDatePicker",(function(e,t){o.setState({reservationDateTime:e})})),Object(Z.a)(Object(G.a)(o),"getTagMenu",(function(){var e=o.getCurrentShop();return Object(Ue.Zb)(e,o.state.statusOrder)})),Object(Z.a)(Object(G.a)(o),"handleAddTag",(function(e){var t=e.key;if("search"!=t)if("delete-all"!=t){var n=parseInt(t);if(o.state.tags.includes(n))o.handleRemoveTag(n);else{var r=o.state,a=r.tags,i=r.orderTagGroups.reduce((function(e,t){return t.tags.includes(n)?e.concat(t.tags):e}),[]);o.setState({tags:o.addOrderTag(a.filter((function(e){return!i.includes(e)})),n),tagVisible:!1,isUseWholeSale:!0})}}else o.setState({tags:[],isUseWholeSale:!0})})),Object(Z.a)(Object(G.a)(o),"addOrderTag",(function(e,t){return[[4,5,6],[9,10],[11,12]].forEach((function(n){n.includes(t)&&e.filter((function(e){return!n.includes(e)}))})),e.concat(t)})),Object(Z.a)(Object(G.a)(o),"handleRemoveTag",(function(e){o.setState({tags:o.state.tags.filter((function(t){return t!=e})),isUseWholeSale:!0})})),Object(Z.a)(Object(G.a)(o),"onTableClick",(function(e){return function(){var t=o.state,n=t.reservationDateTime,r=t.displayId,a=Object(K.a)(o.state.tableIds),i=Object(Ue.nb)(n),c=e.orders.find((function(e){return Qe()(e.reservation_at).isSame(n,"day")&&Object(Ue.nb)(e.reservation_at)==i})),s=a.indexOf(e.id);if(-1!=s)a.splice(s,1),o.setState({tableIds:a});else{if(c&&c.display_id!=r)return W.a.warning("B\xe0n n\xe0y \u0111\xe3 c\xf3 ng\u01b0\u1eddi \u0111\u1eb7t v\xe0o bu\u1ed5i ".concat("am"==i?"s\xe1ng":"chi\u1ec1u"));a.push(e.id),o.setState({tableIds:a})}}})),Object(Z.a)(Object(G.a)(o),"onPhoneSelected",(function(){var e=o.props,t=e.accessToken,n=e.shopId,r=o.state.selectedPhone,a=function(){return o.setState({orderByPhone:null,isLoadingCheckedPhone:!1,duplicatedPhone:!1,visiblePhone:!1})};if((null===r||void 0===r?void 0:r.length)>9){o.setState({isLoadingCheckedPhone:!0});var i="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(n,"/orders/phone_number_info?phone_number=").concat(r,"&access_token=").concat(t);Object(Ue.lc)(i).then((function(e){if(e.success){var t=e.data,n=t.check_duplicated,r=t.check_returned,a=n.duplicated_phone,i=n.inserted_at,c=n.custom_id,s=n.display_id,d=n.order_id;a&&Object(Ue.ed)();var u=c||s;o.setState({orderByPhone:t,isLoadingCheckedPhone:!1,duplicatedPhone:a,visiblePhone:a,duplicatedPhoneDate:i,duplicateDisplayIdPhone:u,returnedPhone:r.returned_phone,visibleReturnedPhone:r.returned_phone,retunedPhoneDate:r.inserted_at,returnedDisplayIdPhone:r.custom_id||r.display_id,duplicateOrderIdPhone:d})}})).catch((function(){a()}))}else a()})),Object(Z.a)(Object(G.a)(o),"onCustomerDuplicated",(function(){var e=o.props,t=e.accessToken,n=e.shopId,r=e.pageId,a=o.state.selectedCustomer;if(a){var i="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(n,"/orders/duplicated_shop_customer_id?page_id=").concat(r,"&access_token=").concat(t,"&customer_id=").concat(a.id);Object(Ue.lc)(i).then((function(e){if(e.success){var t=e.duplicated_customer,n=e.inserted_at,r=e.custom_id,a=e.display_id,i=e.order_id;t&&Object(Ue.ed)();var c=r||a;o.setState({duplicatedCustomer:t,visibleCustomer:t,duplicatedCustomerDate:n,duplicateDisplayId:c,duplicateOrderId:i})}}))}})),Object(Z.a)(Object(G.a)(o),"renderPriceOrder",(function(e){var t=o.state,n=t.currency,r=t.currentWidth,a=e.quantity*e.retailPrice+(e.additionPrice||0),c=e.isDiscountPercent?a-a*e.discountEachProduct/100:a-e.discountEachProduct*e.quantity;return e.discountEachProduct&&0==e.discountEachProduct||!e.discountEachProduct?Object(i.jsx)("span",{className:"text-ellipsis ".concat(r<1152?"price-product-custom":""),style:{float:"right"},children:Object(Ue.X)(a,n,!0)}):Object(i.jsxs)("div",{style:r<1152?{display:"grid",textAlign:"right"}:{display:"grid"},children:[Object(i.jsxs)("div",{className:"text-ellipsis ".concat(r<1152?"price-product-custom":""),children:["-",e.isDiscountPercent?Object(Ue.cb)(e.discountEachProduct,n)+"%":Object(Ue.X)(e.discountEachProduct,n)]}),Object(i.jsx)("div",{className:"text-ellipsis ".concat(r<1152?"price-product-custom":""),children:Object(Ue.X)(c,n,!0)})]})})),Object(Z.a)(Object(G.a)(o),"renderComboByProduct",(function(e){return e.map((function(t,n){return Object(i.jsxs)(E.a,{className:"tag-item-display-id",color:"".concat(t.color),style:e.length-1>n?{}:{margin:0},children:[Object(i.jsxs)("span",{children:[t.name,":"]}),Object(i.jsx)("span",{style:{paddingLeft:5,fontWeight:700},children:t.count})]})}))})),Object(Z.a)(Object(G.a)(o),"renderTooltipInfoOrderItem",(function(e,t){var n,r=o.props.t,a=o.oldCodeComboByProduct(),c=e.displayProductId&&(!e.displayVariationCustomId||!e.displayVariationCustomId.toLowerCase().includes(e.displayProductId.toString().toLowerCase()));return Object(i.jsxs)("div",{children:[Object(i.jsx)("div",{children:t}),Object(i.jsxs)("span",{children:[c&&Object(i.jsx)(E.a,{color:"green",className:"tag-item-display-id text-ellipsis tag-custom tag-custom-id-product",children:e.displayProductId}),e.displayVariationId&&Object(i.jsx)(E.a,{color:"pink",className:"tag-item-display-id text-ellipsis tag-custom tag-custom-id-variation ".concat(c?"":"tag-hide-product-id"),children:e.displayVariationId}),e.isFixedPrices&&Object(i.jsx)(E.a,{className:"tag-item-display-id text-ellipsis tag-custom tag-custom-fixed",children:r("conversation.createOrder.fixed")})]}),(null===(n=e.quantityByComboProducts)||void 0===n?void 0:n.length)>0&&!a&&Object(i.jsxs)("div",{children:["Combo: ",o.renderComboByProduct(e.quantityByComboProducts)]})]})})),Object(Z.a)(Object(G.a)(o),"renderNameProduct",(function(e,t,n){var r=o.props.t,a=o.state,c=a.statusOrder,s=a.warehouseId,d=o.getCurrentShop(),u=e.variationsWarehouses&&e.variationsWarehouses.find&&e.variationsWarehouses.find((function(e){return e.warehouse_id===s})),l=u&&(u.remain_quantity>0?u.remain_quantity:0)||0,p=parseInt(e.count.value)-parseInt(e.hasChangeQuantity?(e.addedToCartQuantity||0)+l:Number.isInteger(e.addedToCartQuantity)?e.addedToCartQuantity:l),m=Object(Ue.v)(c,5,-1)&&!e.oneTime&&p>0,h=e.isPriceByWeight?Math.round((e.weight||0)*e.quantity):e.weight||0,v=null!==d&&void 0!==d&&d.config_weight_product?"".concat(h/1e3," kg"):"".concat(h," g"),f=e.detail&&!e.oneTime?e.detail.split(",").reduce((function(e,t){var n,r=null===(n=t.split(":")[1])||void 0===n?void 0:n.trim();return e.push(r),e}),[]).join(", "):"";return e.oneTime?Object(i.jsx)("div",{style:{width:"100%"},className:"col-item-text profile-customer-custom",children:Object(i.jsx)(T.a,{id:"oneTimeProductInput".concat(t),placeholder:r("conversation.createOrder.nameProduct"),value:e.name,style:{overflow:"hidden",textOverflow:"ellipsis"},onChange:o.onChangeCart(t,"productName"),className:"input-name-item font-weight-500 text-color-default input-focus background-default"})}):e.count.item.isBonusProduct?Object(i.jsxs)("div",{className:"info-order-item info-order-item-bonus col-item-text",children:[Object(i.jsx)(D.a,{title:n,placement:"top",children:Object(i.jsx)("div",{className:"text-color-default font-weight-500",children:n})}),Object(i.jsxs)("div",{className:"detail-product text-ellipsis",children:[m&&Object(i.jsxs)(E.a,{className:"set_font_family conversation_tags_item",children:[r("conversation.createOrder.missing"),": ",p]}),e.detail&&Object(i.jsx)("span",{className:"detail",children:e.detail})]})]}):Object(i.jsx)("div",{style:{width:"100%"},className:"col-item-text",children:Object(i.jsxs)("div",{className:"info-order-item",children:[Object(i.jsx)(D.a,{placement:"top",title:o.renderTooltipInfoOrderItem(e,n),children:Object(i.jsx)("div",{className:"text-color-default font-weight-500",children:n})}),Object(i.jsxs)("div",{className:"detail-product text-ellipsis",children:[m&&Object(i.jsxs)(E.a,{className:"set_font_family conversation_tags_item",children:[r("conversation.createOrder.missing"),": ",p]}),f&&Object(i.jsx)("span",{className:"detail",children:f}),f&&e.weight>0&&Object(i.jsx)("span",{children:", "}),e.weight>0&&Object(i.jsx)("span",{style:{color:"#108ee9"},children:v})]})]})})})),Object(Z.a)(Object(G.a)(o),"renderRetailPrice",(function(e,t,n){var r,a=o.state.currency,c=o.getCurrentShop(),s=(null===c||void 0===c?void 0:c.user_shop)&&Object(Ue.bd)(null===c||void 0===c||null===(r=c.user_shop)||void 0===r?void 0:r.role);if(e.isPriceByWeight){var d=o.getRetailPriceByCurrency(e,a);d=o.parseRetailPriceToRate(d,e,a);var u=e.weight?((n*e.quantity+e.additionPrice)/e.quantity).toFixed(2):d;return Object(i.jsx)("span",{style:{float:"right"},children:Object(Ue.X)(u,a,!0)})}var l=!e.name||e.count.item.isIncludedAccessory;return e.oneTime?Object(i.jsx)(D.a,{placement:"top",title:!e.name&&"Nh\u1eadp t\xean s\u1ea3n ph\u1ea9m tr\u01b0\u1edbc",children:Object(i.jsx)(ut.a,{id:"priceOneTimeProduct",currency:a,isMoney:!0,value:e.retailPrice,style:{textAlign:"left"},callBack:function(e){return o.onChangePrice(t,e)},disabled:l,min:0,noBlur:!!Ue.pc.includes(a),noNumberHandler:!0})}):!e.count.item.isBonusProduct&&!e.isActualVariation&&c&&(c.change_retail_price||null!==s&&void 0!==s&&s.for_control_orders)?Object(i.jsx)(ut.a,{id:"priceOneTimeProduct",currency:a,isMoney:!0,value:e.retailPrice,style:{textAlign:"left"},callBack:function(e){return o.onChangePrice(t,e)},disabled:l,min:0,noBlur:!!Ue.pc.includes(a),noNumberHandler:!0}):Object(i.jsx)("span",{style:{float:"right"},children:Object(Ue.X)(n,a,!0)})})),Object(Z.a)(Object(G.a)(o),"handleBeforeChangeProduct",(function(e,t,n){var r=Math.round(e*n);o.onProductQuantityChange(r,t,n)})),Object(Z.a)(Object(G.a)(o),"renderQuantity",(function(e,t,n){var r,a=o.state.currency;if(e.oneTime)return Object(i.jsx)(ut.a,{currency:a,min:1,isMoney:!1,value:n,callBack:function(e){return o.onChangeQuantity(t,e)}});if(e.count.item.isBonusProduct||null===(r=e.measureInfo)||void 0===r||!r.measure_id||e.isActualVariation)return e.count.item.isBonusProduct||e.isActualVariation?Object(i.jsx)("span",{style:{float:"right"},children:n}):Object(i.jsx)(ut.a,{currency:a,min:1,isMoney:!1,value:n,callBack:function(e){return o.onProductQuantityChange(e,t)}});var c=e.measureInfo.exchange_value;return n/=c,Object(i.jsx)(ut.a,{currency:a,min:0,isMoney:!1,value:n,isPercent:!0,getRef:function(e){return o.measureInput[t]=null===e||void 0===e?void 0:e.inputNumberRef},callBack:function(e){return o.handleBeforeChangeProduct(e,t,c)}})})),Object(Z.a)(Object(G.a)(o),"renderSelectMeasure",(function(e,t){var n,r,a=o.getCurrentShop(),c=o.getGroupMeasure(null===a||void 0===a?void 0:a.product_measurements,null===(n=e.measureInfo)||void 0===n?void 0:n.measure_id),s=((null===c||void 0===c?void 0:c.nodes)||[]).find((function(t){var n;return t.id==(null===(n=e.measureInfo)||void 0===n?void 0:n.measure_id)})),d=((null===c||void 0===c?void 0:c.nodes)||[]).filter((function(e){return!e.is_removed})).concat(null!==s&&void 0!==s&&s.is_removed?s:[]),u=(null===s||void 0===s?void 0:s.is_removed)||(null===c||void 0===c?void 0:c.is_removed)||e.isActualVariation||e.measureGroupId!=(null===c||void 0===c?void 0:c.id)&&(null===(r=e.measureInfo)||void 0===r?void 0:r.measure_id);return s&&Object(i.jsx)(se.a,{bordered:!1,disabled:u,onChange:function(n){return o.handleChangeMeasure(e,n,t,s)},dropdownMatchSelectWidth:!1,dropdownClassName:"customize-select-dropdown",className:"customize-select-measure text-ellipsis select-focus background-default",value:s.id,children:d.map((function(e){return Object(i.jsx)(Pt,{value:e.id,children:Object(i.jsx)("span",{children:e.name})},e.id)}))})})),Object(Z.a)(Object(G.a)(o),"renderSelectWarehouse",(function(e,t){var n=o.props.t,r=o.state,a=r.warehouseId,c=r.userWarehousesPermissions,s=r.isEditOrder,d=r.visibleWarehouse,u=t.find((function(e){return e.value==a}));t=t.filter((function(e){return e.allowCreateOrder}));var l=s?t:Object(Ue.cc)(c,t,"tao_don"),p=Object(i.jsx)(ne.a,{children:l.map((function(e){return Object(i.jsx)(ne.a.Item,{onClick:function(){return o.onChangeWarehouse(e.value)},children:e.label},e.value)}))});return Object(i.jsxs)("div",{className:"box-warehouses",onClick:function(e){return e.stopPropagation()},children:[Object(i.jsx)(A.a,{overlay:p,visible:d,trigger:"hover",overlayClassName:"dropdown-warehouses",onVisibleChange:function(e){return o.setState({visibleWarehouse:e})},children:Object(i.jsxs)("a",{className:"font-weight-500 header-text-settings",children:[Object(i.jsx)("span",{className:"label",children:u&&e?u.label:n("conversation.createOrder.warehouse")}),Object(i.jsx)(N.a,{type:"right",className:"icon-down-warehouse"})]})}),Object(i.jsx)(D.a,{placement:"topRight",title:n("conversation.createOrder.tipWarehouses"),overlayClassName:"tooltip-checkbox-warehouses",className:"tooltip-checkbox-warehouses",children:Object(i.jsx)(I.a,{className:"checkbox-save-warehouses",checked:o.state.saveWarehouses,onChange:function(e){return o.handleChangeSaveWarehouses(e)}})})]})})),Object(Z.a)(Object(G.a)(o),"handleChangeReferralCode",(function(e){var t=o.props,n=t.currentShops,r=t.shopId,a=t.accessToken,i=t.t,c=t.dispatch,s=(t.pageId,o.state.selectedCustomer),d=n.find((function(e){return e.id==r}));if(d){var u=function(){o.setState({visibleReferralCode:!1,customerReferralCode:null})};if(e){var l="".concat(Object(Ue.Mb)(!0),"/v1//shops/").concat(r,"/customers/get_referral_code?access_token=").concat(a);We()({method:"get",url:l,params:{referral_code:e,shop_customer_id:s.customer_id}}).then((function(e){if(e.data.success&&e.data.data){var t,n,r=e.data.data;if((null===(t=d.referral_code_discount)||void 0===t?void 0:t.active)||!1)return r=jt(jt({},r),{},{discount:(null===(n=d.referral_code_discount)||void 0===n?void 0:n.discount)||0,is_percent:!d.referral_code_discount||d.referral_code_discount.is_percent}),c(Object(Ge.a)(Object(Ue.Ed)(i("conversation.createOrder.successAddedReferralCode")))),o.setState({visibleReferralCode:!0,customerReferralCode:r})}u()})).catch((function(){u()}))}else u()}})),Object(Z.a)(Object(G.a)(o),"handleVisibleInputReferralCode",(function(e){if("visible"!=e){var t=o.state,n=t.referralCodeValue,r=t.customerReferralCode;n&&n==(null===r||void 0===r?void 0:r.referral_code)&&o.setState({visibleReferralCode:!0})}else o.setState({visibleReferralCode:!1},(function(){document.getElementById("inputReferralCodeId").focus()}))})),Object(Z.a)(Object(G.a)(o),"renderReferralCode",(function(){if(o.getCurrentShop()){var e=o.props.t,t=o.state,n=t.recentOrderId,r=t.customerReferralCode,a=t.visibleReferralCode,c=t.referralCodeValue,s=o.getReferralCode();return s||n&&r?Object(i.jsxs)("div",{className:"card-referral-code card-voucher-custom",children:[Object(i.jsx)("div",{className:"text-color-default font-weight-500 title-voucher",children:e("conversation.createOrder.referralCode")}),s?Object(i.jsx)("div",{children:a?Object(i.jsxs)(E.a,{color:"gold",style:{cursor:"pointer"},onClick:function(){return o.handleVisibleInputReferralCode("visible")},children:[Object(i.jsx)(N.a,{type:"edit"})," ",c]}):Object(i.jsx)(T.a,{id:"inputReferralCodeId",style:{width:200,height:22},placeholder:e("conversation.createOrder.inputReferralCode"),onChange:function(e){e.stopPropagation(),o.setState({referralCodeValue:e.target.value}),o.handleChangeReferralCode(e.target.value)},value:c,onBlur:function(){return o.handleVisibleInputReferralCode("hidden")}})}):Object(i.jsx)(E.a,{color:"gold",children:r.referral_code})]}):void 0}})),Object(Z.a)(Object(G.a)(o),"renderHeaderOrderProducts",(function(){var e=o.props,t=e.pageWarehouses,n=e.t,r=o.state.warehouseId,a=Object.keys(t).map((function(e){return{value:t[e].id,label:t[e].name,isEditOrder:!1,id:t[e].id,allowCreateOrder:t[e].allow_create_order}})),c=!!t.find((function(e){return e.id==r}));return Object(i.jsxs)("div",{className:"box-header header-order-products flex-between",children:[Object(i.jsxs)("div",{className:"header-order-title flex-align-items",children:[Object(i.jsx)(N.a,{type:"shopping-cart",className:"img img-shopping"}),Object(i.jsx)("span",{className:"text-color-default text-ellipsis font-weight-500",style:{maxWidth:"calc(100% - 10px)"},children:n("conversation.createOrder.product")})]}),o.renderSelectWarehouse(c,a)]})})),Object(Z.a)(Object(G.a)(o),"scrollToBottom",(function(){var e=document.getElementById(o.idOrderItems);e&&e.scrollIntoView({block:"end",inline:"nearest"})})),Object(Z.a)(Object(G.a)(o),"renderTableProductTitle",(function(){var e,t,n,r,a,c,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=o.props.t,l=o.state,p=l.currentWidth,m=l.activatedPromotionAdvance,h=l.activatedPromotionProducts,v=l.activatedComboProducts,f=l.promotionAdvanceCanbeActive,_=l.promotionProductsCanBeActive,b=l.comboProductsCanBeActive,g=Te()(d||o.state.cart||[]),O=g.some((function(e){var t;return null===(t=e.measureInfo)||void 0===t?void 0:t.measure_id})),j=p>=1152&&!O,P=function(e,t){return j?e:t},x=0;g&&g.map((function(e){var t;null!==(t=e.measureInfo)&&void 0!==t&&t.exchange_value?x+=e.quantity/e.measureInfo.exchange_value:x+=e.quantity})),x=+x.toFixed(2);var I=(null===(e=document.getElementsByClassName("profile-customer")[0])||void 0===e?void 0:e.offsetHeight)||0,S=(null===(t=document.getElementsByClassName("header-order-products")[0])||void 0===t?void 0:t.offsetHeight)||0,A=18,w=g.find((function(e){return e.isBonusProduct})),N=w&&(null===(n=document.getElementsByClassName("bonus-items")[0])||void 0===n?void 0:n.offsetHeight)||0,k=!(null!==m&&void 0!==m&&m.length)&&!(null!==h&&void 0!==h&&h.length)&&!(null!==v&&void 0!==v&&v.length),B=(null===f||void 0===f?void 0:f.length)>0||(null===_||void 0===_?void 0:_.length)>0||(null===b||void 0===b?void 0:b.length)>0,T=(B&&(null===(r=document.getElementsByClassName("popover-add-voucher")[0])||void 0===r?void 0:r.offsetHeight)||0)+(N>0?N+10:0)+(!k&&(null===(a=document.getElementsByClassName("list-voucher-activated")[0])||void 0===a?void 0:a.offsetHeight)||0),q="".concat(I,"px - ").concat(S,"px - ").concat(A,"px - ").concat(456+T,"px"),E="calc(100vh - ".concat(q,")"),M=(null===(c=document.getElementsByClassName("table-product-title")[0])||void 0===c?void 0:c.offsetHeight)||0,W="calc(100vh - ".concat(q," - ").concat(M,"px)");return Object(i.jsxs)("div",{className:"box-table-product",style:s?{maxHeight:180}:{minHeight:E},children:[Object(i.jsxs)(y.a,{className:"table-product table-product-title",children:[Object(i.jsx)(C.a,{span:P(7,11),className:"col-product",children:Object(i.jsx)("div",{className:"col-title text-color-default font-weight-500",children:u("conversation.createOrder.labelName")})}),Object(i.jsx)(C.a,{span:P(4,5),className:"col-product",children:Object(i.jsx)("div",{className:"col-title text-color-default font-weight-500 col-title-right",children:Object(i.jsxs)(D.a,{placement:"top",title:"".concat(u("conversation.createOrder.count"),": ").concat(x),children:[Object(i.jsxs)("span",{children:[u("conversation.createOrder.count"),":"]}),Object(i.jsx)("span",{children:x})]})})}),Object(i.jsx)(C.a,{span:P(6,8),className:"col-product",children:Object(i.jsx)("div",{className:"col-title text-color-default font-weight-500 col-title-right",children:u("conversation.createOrder.retailPrice")})}),Object(i.jsx)(C.a,{span:P(7,0),className:"col-product",children:Object(i.jsx)("div",{className:"col-title text-color-default font-weight-500 col-title-right",children:u("conversation.createOrder.finalPrice")})})]}),Object(i.jsx)("div",{className:"table-product-item",children:g.length>0?o.renderTableProduct(!1,s):Object(i.jsxs)("div",{className:"table-product-not-item",style:{minHeight:d?150:W},children:[Object(i.jsx)("img",{src:Object(Ue.Nb)("not_data.svg")}),Object(i.jsx)("span",{className:"text-not-products",children:u("conversation.createOrder.notOrderItems")})]})})]})})),Object(Z.a)(Object(G.a)(o),"renderTableProduct",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=o.props.t,r=o.state.currentWidth,a=null!==t&&void 0!==t&&t.actualVariationInfo?[t.actualVariationInfo]:Te()(o.state.cart||[]),c=a.length,s=a.some((function(e){var t;return null===(t=e.measureInfo)||void 0===t?void 0:t.measure_id})),d=r>=1152&&!s,u=function(e,t){return d?e:t};return a.map((function(d,l){var p,m;if(e==(d.isBonusProduct||!1)){var h={key:l,name:d.productName,count:{item:d,value:d.quantity},retailPrice:d.retailPrice,price:o.renderPriceOrder(d),isDiscountPercent:d.isDiscountPercent,discountEachProduct:d.discountEachProduct||0,delete:l,oneTime:d.oneTime,length:c,detail:d.variationText,visibleProductDetal:d.visibleProductDetal,displayVariationId:d.displayVariationId,displayVariationCustomId:d.displayVariationCustomId,displayProductId:d.displayProductId,variationsWarehouses:d.variationsWarehouses,addedToCartQuantity:d.addedToCartQuantity,hasChangeQuantity:d.hasChangeQuantity,lastImportedPrice:d.lastImportedPrice,measureGroupId:d.measureGroupId,measureInfo:d.measureInfo,weight:d.weight,isFixedPrices:d.isFixedPrices,images:d.images||[],quantityByComboProducts:d.quantityByComboProducts||[],quantity:d.quantity,additionPrice:d.additionPrice||0,isPriceByWeight:d.isPriceByWeight,retailPriceByWeight:d.retailPriceByWeight,returnedCount:d.returnedCount,note:d.note,assigningSellerId:d.assigningSellerId,actualVariationInfo:d.actualVariationInfo||null,isActualVariation:d.isActualVariation||!1};return Object(i.jsxs)("div",{className:"row-table-product row-table-product-custom ".concat(l==a.length-1?"last-row-table-product":""),children:[(h.oneTime||!h.count.item.isBonusProduct)&&o.renderOrderItemButton(h,null===t||void 0===t?void 0:t.key),Object(i.jsxs)(y.a,{className:"table-product",children:[Object(i.jsx)(C.a,{span:u(7,8),className:"col-product col-product-name",children:o.renderNameProduct(h,l,h.name)}),Object(i.jsx)(C.a,{span:u(4,8),className:"col-product",children:Object(i.jsx)("div",{className:"item-product profile-customer profile-customer-custom col-item-text",children:Object(i.jsx)(T.a.Group,{size:"large",children:Object(i.jsxs)(y.a,{gutter:4,children:[Object(i.jsx)(C.a,{span:null!==(p=h.measureInfo)&&void 0!==p&&p.measure_id?10:24,children:o.renderQuantity(h,l,h.count.value)}),Object(i.jsx)(C.a,{span:null!==(m=h.measureInfo)&&void 0!==m&&m.measure_id?14:0,children:o.renderSelectMeasure(h,l)})]})})})}),Object(i.jsx)(C.a,{span:u(6,8),className:"col-product",children:Object(i.jsx)("div",{className:"item-product profile-customer-custom col-item-text",children:o.renderRetailPrice(h,l,h.retailPrice)})}),Object(i.jsx)(C.a,{span:u(7,0),className:"col-product",children:Object(i.jsx)("div",{className:"item-product col-item-text font-weight-500",children:o.renderPriceOrder(d)})})]}),(r<1152||s)&&Object(i.jsxs)("div",{className:"price-order-sub flex-between font-weight-500 text-color-default",children:[Object(i.jsx)("span",{style:{marginRight:5,whiteSpace:"nowrap"},children:n("conversation.createOrder.finalPrice")}),o.renderPriceOrder(d)]})]})}}))})),Object(Z.a)(Object(G.a)(o),"getVariationInfo",(function(e){var t="";e&&e.length>0&&(t=e.map((function(e){return"".concat(e.name,": ").concat(e.value)})).join(", "));return t})),Object(Z.a)(Object(G.a)(o),"handleSelectCombo",(function(e,t){var n=e.reduce((function(e,t){return o.handleBeforeSelectItem(t,t.count,t.id,e)}),Te()(o.state.cart));o.setState({comboIdSelected:t,cart:n,isUseWholeSale:!0},(function(){o.calcDiscountPercent(),n.length>0&&(o.findComboCanBeActive(null,o.state.activatedComboProducts),o.findBonusProductAvailable(),o.findPromotionProductsCanBeActive(),o.findPromotionAdvanceCanbeActive(),setTimeout((function(){o.findPromotionAdvanceCoupon()}),150))}))})),Object(Z.a)(Object(G.a)(o),"pushComboIntoItem",(function(e){e.combo_products=[],e.combo_variations=[];var t=o.getCurrentShop();return t&&t.combo_availability&&t.combo_availability.map((function(t){var n=t.combo_product_variations.findIndex((function(t){return!t.variation_id&&t.product_id==e.product.id})),r=t.combo_product_variations.findIndex((function(t){return t.variation_id&&t.variation_id==e.id}));n>-1?e.combo_products.push(t):r>-1&&e.combo_variations.push(t)})),e})),Object(Z.a)(Object(G.a)(o),"handleBeforeSelectItem",(function(e,t,n,r,a){var i=o.state.currency,c=r||Te()(o.state.cart),s=o.getCurrentShop(),d=o.pushComboIntoItem(e),u=d.product.name,l=d.retail_price,p=d.retail_price_currency_original,m=d.wholesale_price2,h=d.wholesale_price2,v=d.id,f=d.product.id,_=d.remain_quantity,b=d.weight,g=d.product.category_ids,O=d.is_locked,j=d.product.brand_id,y=d.custom_id||d.display_id,P=d.custom_id,C=d.product.custom_id||d.product.display_id,x=d.variations_warehouses,I=d.product.bonus_products,S=d.product.manipulation_warehouses,A=d.product.tags,w=d.product.is_accessory||!1,N=d.bonus_variations,k=d.retail_price_by_currency||[],D=k.find((function(e){return e.currency==s&&s.currency}))?k:k.concat({currency:s&&s.currency,retailPriceByCurrency:l}),B=Te()(c),T=B&&B.length>0?B.findIndex((function(e){return e.variationId==n&&!e.isBonusProduct})):-1,q=d.product.measure_group_id,E=T>-1&&(null===s||void 0===s||!s.add_products_into_cart)?B[T].measureInfo:o.getExchangeMeasure(q,null,!0),M=E?{measure_id:E.id||E.measure_id,exchange_value:E.exchange_value}:{};null!==E&&void 0!==E&&E.exchange_value&&(t=(t||1)*E.exchange_value);var W=d.product.is_price_by_weight,R=d.retail_price_by_weight,F=d.addition_price,V={id:null,index:(B||[]).filter((function(e){return!e.isBonusProduct})).length,variationId:v,variationText:o.getVariationInfo(d.fields),oneTime:!1,productName:u,remain:_,quantity:t||1,retailPrice:l,retailPriceCurrencyOriginal:p,wholesalePrice:m,wholesalePriceOriginal:h,oneTimePrice:0,weight:b,comboProducts:d.combo_products,comboVariations:d.combo_variations,productId:f,categoryIds:g,isBonusProduct:!1,isLocked:O,visibleProductDetal:!1,brandId:j,displayProductId:C,displayVariationId:y,displayVariationCustomId:P,variationsWarehouses:x,bonusEachProduct:I,manipulationWarehouses:S,productTags:A,bonusEachVariation:N,retailPriceByCurrency:D,measureInfo:M,measureGroupId:q,retailPriceWholesaleOriginal:d.retail_price_wholesale_original||l,quantityByComboProducts:[],images:d.images,isPriceByWeight:W,additionPrice:F,retailPriceByWeight:R,isIncludedAccessory:w,isActualVariation:a},L=o.getRetailPriceByCurrency(V,i),K=o.parseRetailPriceToRate(L,V,i);if(W){var Q=Te()(K),H=b*(Q=null!==s&&void 0!==s&&s.config_weight_product&&b>0?parseFloat((Q/1e3).toFixed(1)):Q)/(t||1);F=b*Q-(K=Math.floor(H))*(t||1)}return V=jt(jt({},V),{},{retailPrice:K,retailPriceWholesaleOriginal:d.retail_price_wholesale_original||K,retailPriceByWeight:L,additionPrice:F}),a?V:(T>-1?s&&s.add_products_into_cart?B.push(V):B[T].quantity+=t||1:B.push(V),B)})),Object(Z.a)(Object(G.a)(o),"handleSelectItem",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o.isSelectItem=!0;var r,a=o.props.cacheDb,i=o.state.searchResult;e=e.toString().includes("-combo-")?e.toString().split("-combo-")[0]:e,r=n||i.find((function(t){return t.id===e}));var c=c=o.handleBeforeSelectItem(r,t,e);!o.state.editingOrderId&&a.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:c}),o.setState({cart:c,isUseWholeSale:!0},Object(H.a)(L.a.mark((function e(){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.calcDiscountPercent(),o.scrollToBottom(),!(c.length>0)){e.next=12;break}return e.next=5,o.findComboCanBeActive(null,o.state.activatedComboProducts);case 5:return e.next=7,o.findBonusProductAvailable();case 7:return e.next=9,o.findPromotionProductsCanBeActive();case 9:return e.next=11,o.findPromotionAdvanceCanbeActive();case 11:setTimeout((function(){o.findPromotionAdvanceCoupon()}),150);case 12:case"end":return e.stop()}}),e)}))))})),Object(Z.a)(Object(G.a)(o),"onAddProductToCart",(function(){var e=o.props,t=e.cacheDb,n=e.dispatch,r=e.t;if(0!=o.getCurrentShop().on_add_quick_product){var a=o.state.cart,i=a.length,c=a.concat([{id:null,index:i,variationId:null,oneTime:!0,remain:0,productName:null,quantity:1,retailPrice:0,wholesalePrice:0,oneTimePrice:0,weight:0,variationText:null,categoryIds:[],visibleProductDetal:!1,images:[]}]);!o.state.editingOrderId&&t.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:c}),o.setState({cart:c},(function(){o.scrollToBottom(),o.findPromotionProductsCanBeActive(),o.findPromotionAdvanceCanbeActive(),o.findPromotionAdvanceCoupon()})),setTimeout((function(){return o.focusLastestOneTimeProductName(i)}),200)}else n(Object(Ge.a)({message:r("conversation.createOrder.offAddQuickProduct"),title:"L\u1ed7i",level:"error",position:"tr",autoDismiss:3}))})),Object(Z.a)(Object(G.a)(o),"handleDeSelectItem",(function(e){var t=o.state.cart,n=Te()(t).filter((function(t){return t.variationId!=e}));o.setState({cart:n})})),Object(Z.a)(Object(G.a)(o),"focusLastestOneTimeProductName",(function(e){var t=document.getElementById("oneTimeProductInput".concat(e));t&&t.focus()})),Object(Z.a)(Object(G.a)(o),"onChangeWeight",(function(e,t){var n=o.props.cacheDb,r=o.getCurrentShop(),a=o.state,i=a.cart,c=a.currency,s=Te()(i);if(e=null!==r&&void 0!==r&&r.config_weight_product?Math.round(1e3*parseFloat(e.toString().replace(",","."))):e,s[t].isPriceByWeight){var d=+(e/s[t].quantity).toFixed(2),u=o.getRetailPriceByCurrency(s[t],c);u=o.parseRetailPriceToRate(u,s[t],c);var l=(u=null!==r&&void 0!==r&&r.config_weight_product&&d>0?parseFloat((u/1e3).toFixed(1)):u)*e/s[t].quantity,p=Math.floor(l),m=u*e-p*s[t].quantity;s[t].weight=d,s[t].retailPrice=p,s[t].retailPriceWholesaleOriginal=p,s[t].additionPrice=m}else s[t].weight=Object(Ue.ab)(e)||0;!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:s}),o.setState({cart:s})})),Object(Z.a)(Object(G.a)(o),"onChangeDetailProduct",(function(e){return function(t){var n=o.props,r=(n.conversationId,n.cacheDb),a=o.state.cart,i=a.findIndex((function(t){return t.index===e})),c=Object(K.a)(a);c[i].variationText=t.target.value,!o.state.editingOrderId&&r.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:c}),o.setState({cart:c})}})),Object(Z.a)(Object(G.a)(o),"onChangeCart",(function(e,t){return function(n){var r=o.props.cacheDb,a=o.state.cart,i=null!==n&&void 0!==n&&n.target?n.target.value:n,c=Te()(a);c[e][t]=i,!o.state.editingOrderId&&r.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:c}),o.setState({cart:c})}})),Object(Z.a)(Object(G.a)(o),"onChangeQuantity",(function(e,t){var n=o.props.cacheDb,r=o.state.cart,a=Te()(r);a[e].quantity=t,a[e].oneTime&&(a[e].oneTimePrice=t*r[e].retailPrice),!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:a}),o.setState({cart:a},(function(){o.findPromotionProductsCanBeActive(),o.findPromotionAdvanceCanbeActive(),r.length>0&&(o.findComboCanBeActive(null,o.state.activatedComboProducts),o.findBonusProductAvailable())}))})),Object(Z.a)(Object(G.a)(o),"onChangePrice",(function(e,t){var n=o.props.cacheDb,r=o.state.cart,a=Te()(r);a[e].oneTime&&(a[e].oneTimePrice=t*r[e].quantity),a[e].retailPrice=t,a[e].retailPriceWholesaleOriginal=t,!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:a}),o.setState({cart:a},(function(){o.calcDiscountPercent(),o.findPromotionProductsCanBeActive(),o.findPromotionAdvanceCanbeActive()}))})),Object(Z.a)(Object(G.a)(o),"onChangeSnappy",(function(){var e=o.state,t=e.isSendToSnappy,n=e.dontSyncWithSnappy,r=o.props.cacheDb;!o.state.editingOrderId&&r.put({conv_id:o.cacheDbKey,field_name:"order.isSendToSnappy",value:!t}),!o.state.editingOrderId&&r.put({conv_id:o.cacheDbKey,field_name:"order.dontSyncWithSnappy",value:!n}),o.setState({isSendToSnappy:!t,dontSyncWithSnappy:!n})})),Object(Z.a)(Object(G.a)(o),"totalDiscountCombo",(function(e){if(!e||0==e.length)return 0;var t=0;return e.map((function(e){t+=e.combo_product_info.discount_amount})),t})),Object(Z.a)(Object(G.a)(o),"modalVisiblePaymentInfo",(function(){o.setState({modalVisible:!0})})),Object(Z.a)(Object(G.a)(o),"onChangePartner",(function(e){return function(t){var n=o.state,r=n.warehouseId,a=n.provinceId,i=n.districtId;"partner_id"==e&&(o.setState({partnerId:t}),localStorage.setItem("shipping_partner_id",t),0==t&&null!=t||o.setState({isSendToSnappy:!1,dontSyncWithSnappy:!0}),a&&i&&o.checkShippingFee(a,i,r,t))}})),Object(Z.a)(Object(G.a)(o),"checkedCustomPartner",(function(e){var t=o.props.pageWarehouses,n=o.state,r=n.provinceId,a=n.districtId,i=n.warehouseId,c=n.countryId,s=o.getCurrentShop(),d=s&&s.custom_partners,u=e||o.state.partnerId,l=d&&d.length?d.find((function(e){return e.id==u})):void 0,p=0;if(l&&l.is_advanve_fee&&s){var m=Object(Ue.Kb)(c,r,a,s,i,t);m&&(p=3==m?l.inner_fee:2==m?l.suburban_fee:1==m?l.outer_fee:0)}return p||(l&&l.partner_fee?l.partner_fee:0)})),Object(Z.a)(Object(G.a)(o),"onChangeCombo",(function(e){var t=e.target.value;o.setState({comboBy:t},(function(){o.findComboCanBeActive(null,o.state.activatedComboProducts)}))})),Object(Z.a)(Object(G.a)(o),"renderTitleFreeShip",(function(){var e=o.props.t;return o.state.isFreeShip?Object(i.jsx)("div",{children:e("conversation.createOrder.freeShip")}):null})),Object(Z.a)(Object(G.a)(o),"handleChangeBySuggestPrice",(function(e,t,n){var r="payments"==t?jt(jt({},o.state.payments),{},Object(Z.a)({},n,e+(o.state.payments[n]||0))):e+(o.state[t]||0);o.onOrderPriceValueChange(t,r)})),Object(Z.a)(Object(G.a)(o),"renderSuggestRemainPrice",(function(e,t,n){return Object(i.jsxs)("div",{style:{display:"flex",justifyContent:"end"},onClick:function(){return o.handleChangeBySuggestPrice(e,t,n)},children:["+",Object(Ue.X)(e,o.state.currency)]})})),Object(Z.a)(Object(G.a)(o),"createDropTransferProof",(function(e){(null===e||void 0===e?void 0:e.length)>0?o.setState({modalVisible:!0,activeKeyPayment:"2",createProof:!0,proofImages:e,fileList:[{uid:e[0],status:"done",url:e[0]}]}):O.a.error({message:t("failedText"),description:"Something went wrong!!!"})})),Object(Z.a)(Object(G.a)(o),"setTransferProofState",(function(e,t){o.setState(Object(Z.a)({},e,t))})),Object(Z.a)(Object(G.a)(o),"renderTransferComfirm",(function(){var e=o.props,t=e.currentShops,n=e.shopId,r=e.accessToken,a=e.t,c=o.state,s=c.transferProofs,d=c.transferMoney,u=c.recentOrderId,l=c.createProof,p=c.fileList,m=c.proofImages,h=c.currency,v=c.payments;return Object(i.jsx)(_t.a,{t:a,currentShops:t,transferProofs:s,currency:h,transferMoney:d,setTransferProofState:o.setTransferProofState,recentOrderId:u,shopId:n,accessToken:r,createProof:l,proofImages:m,fileList:p,payments:v})})),Object(Z.a)(Object(G.a)(o),"renderPaymentInfo",(function(e,t,n){var r=o.props.t,a=o.state,c=a.isEditOrder,s=a.activeKeyPayment,d=o.getCurrentShop();return d&&(d.active_module||[]).includes(9)&&d.require_transfer_proof&&c?Object(i.jsxs)(b.a,{activeKey:s,onChange:function(e){return o.setState({activeKeyPayment:e})},className:"tab-payment-info",children:[Object(i.jsx)(b.a.TabPane,{tab:r("conversation.transferConfirm.payment"),children:o.renderTabPanePaymentInfo(e,t,n)},"1"),Object(i.jsx)(b.a.TabPane,{tab:r("conversation.transferConfirm.verify"),children:o.renderTransferComfirm()},"2")]}):o.renderTabPanePaymentInfo(e,t,n)})),Object(Z.a)(Object(G.a)(o),"renderRemainReferralAmount",(function(){var e=o.props.t,t=o.state,n=t.maxReferralAmount,r=t.referralAmountDiscount,a=t.currency,c=n>(r||0)?n-(r||0):0;return Object(i.jsxs)("span",{children:[Object(i.jsxs)("span",{children:[e("conversation.createOrder.remaining"),":"]}),"\xa0",Object(i.jsx)("span",{children:Object(Ue.X)(c,a)})]})})),Object(Z.a)(Object(G.a)(o),"getKeyPayment",(function(e){switch(e){case"transfer_money":return"transferMoney";case"charged_by_card":return"chargedByCard";default:return e}})),Object(Z.a)(Object(G.a)(o),"getValuePayment",(function(e){var t=o.state,n=t.transferMoney,r=t.cash,a=t.chargedByCard;switch(e){case"cash":return r;case"transfer_money":return n;case"charged_by_card":return a;default:return 0}})),Object(Z.a)(Object(G.a)(o),"renderIconPayment",(function(e,t){var n=o.props.t;switch(e){case"cash":return Object(i.jsxs)("span",{className:"flex-align-items",children:[Object(i.jsx)("img",{src:Object(Ue.Nb)("money.svg"),className:"img img-payment"})," ",n("conversation.createOrder.cash")]});case"transfer_money":return Object(i.jsxs)("span",{className:"flex-align-items",children:[Object(i.jsx)("img",{src:Object(Ue.Nb)("arrowsLeftRight.svg"),className:"img img-payment"})," ",n("conversation.createOrder.transferMoney")]});case"charged_by_card":return Object(i.jsxs)("span",{className:"flex-align-items",children:[Object(i.jsx)(N.a,{type:"credit-card",className:"img img-payment"})," ",n("conversation.createOrder.chargedByCard")]});case"charged_by_momo":return Object(i.jsxs)("div",{style:{color:"#A9246C"},className:"flex-align-items",children:[Object(i.jsx)("img",{src:"/static/images/momo.svg",className:"img img-payment"}),n("conversation.createOrder.momo")]});case"charged_by_vnpay":return Object(i.jsxs)("div",{style:{color:"#dd3d43"},className:"flex-align-items",children:[Object(i.jsx)("img",{src:"/static/images/vnpay_payment.svg",className:"img img-payment"}),"VNPay"]});case"charged_by_kredivo":return Object(i.jsxs)("div",{style:{color:"#fc843c"},className:"flex-align-items",children:[Object(i.jsx)("img",{src:"/static/images/kredivo_payment.png",className:"img img-payment"}),"Kredivo"]});case"charged_by_fundiin":return Object(i.jsxs)("div",{style:{color:"#5bc0f7"},className:"flex-align-items",children:[Object(i.jsx)("img",{src:"/static/images/fundiin_payment.png",className:"img img-payment"}),"Fundiin"]});case"charged_by_qrpay":return Object(i.jsxs)("span",{className:"flex-align-items flex-align-items",children:[Object(i.jsx)(N.a,{type:"qrcode",className:"img img-payment"}),"QRPay"]});default:var r=t.find((function(t){return t.id==e}));return Object(i.jsxs)("span",{className:"text-color-default flex-align-items",children:[Object(i.jsx)(N.a,{type:"credit-card",className:"img-payment img"})," ",(null===r||void 0===r?void 0:r.name)||o.props.t("tool.deleted")]})}})),Object(Z.a)(Object(G.a)(o),"onSelectPayment",(function(e){var t=o.state,n=t.payments,r=t.paymentMethods.filter((function(t){return!e.includes(t)}));r.length&&(Nt.includes(r[0])?o.onOrderPriceValueChange(r[0],0):o.onOrderPriceValueChange("payments",jt(jt({},n),{},Object(Z.a)({},r[0],0)))),o.setState({paymentMethods:e})})),Object(Z.a)(Object(G.a)(o),"renderPaymentContent",(function(e){var t=o.props.t,n=[{label:t("conversation.createOrder.transferMoney"),value:"transfer_money"},{label:t("conversation.createOrder.cash"),value:"cash"},{label:t("conversation.createOrder.chargedByCard"),value:"charged_by_card"},{label:t("conversation.createOrder.momo"),value:"charged_by_momo"},{label:"VNPAY",value:"charged_by_vnpay"},{label:"Kredivo",value:"charged_by_kredivo"},{label:"Fundiin",value:"charged_by_fundiin"},{label:"QRPay",value:"charged_by_qrpay"}];return n=n.concat(e.map((function(e){return{label:e.name,value:e.id}}))),Object(i.jsx)("div",{children:Object(i.jsx)(I.a.Group,{className:"payment-checkbox",options:n,value:o.state.paymentMethods,onChange:o.onSelectPayment})})})),Object(Z.a)(Object(G.a)(o),"renderTabPanePaymentInfo",(function(e,t,n){var r,a,c,s=o.state,d=s.currency,u=s.rewardPointSetting,l=s.prepaidPoint,m=s.prepaidMoney,v=s.partnerId,_=s.surcharge,b=s.isCalculationTax,g=s.cart,O=s.isFreeShip,j=s.returnFree,y=s.maxPrepaidByPoint,P=s.payments,C=s.leveraPoint,x=s.paymentMethods,S=s.tab,A=s.showReferralAmount,w=s.maxReferralAmount,k=s.referralAmountDiscount,B=o.props.t,T=o.getCurrentShop(),q=o.calcTotalProductPrice(g),E=b&&T&&T.invoice_tax>0?T.invoice_tax*(q-n)/100:0,M=T.bank_payments||[],W=(null===T||void 0===T||null===(r=T.multiple_currency)||void 0===r?void 0:r.length)>0;return Object(i.jsx)("div",{className:"payment-info",children:Object(i.jsx)("div",{className:"box-payment-body",children:Object(i.jsxs)("div",{className:"layer-payment-body",children:[Object(i.jsxs)("div",{className:"flex-between header-payment-methods",children:[Object(i.jsx)(h.a,{placement:"bottomLeft",trigger:"click",overlayClassName:"popover-payment-methods",content:o.renderPaymentContent(M),title:Object(i.jsx)("span",{style:{cursor:"pointer"},onClick:o.openSettingPayment,children:B("conversation.createOrder.paymentMethods")}),children:Object(i.jsxs)(f.a,{onClick:o.openSettingPayment,size:"small",className:"btn-create-transfer-confirmation btn-payment-methods font-weight-500",children:[Object(i.jsx)(N.a,{type:"plus"}),B("conversation.createOrder.morePaymentMethods")]})}),W&&o.renderSelectCurrency(T)]}),Object(i.jsx)("div",{className:"box-payment-content",children:Object(i.jsxs)("div",{className:"item-payment",children:[Object(i.jsxs)("div",{className:"list-checkbox-payment",children:[!j&&Object(i.jsx)(I.a,{disabled:!(2!=S||null===(a=T.settings)||void 0===a||!a.block_edit_shipping_fee)&&(null===(c=T.settings)||void 0===c?void 0:c.block_edit_shipping_fee),checked:O,onChange:function(e){return o.handleChangeSaveIsFreeShipping(e)},className:"checkbox-payment",children:Object(i.jsx)("span",{className:"text-color-default text-checkbox-payment",children:B("conversation.createOrder.checkBoxFreeShip")})}),(!O||j)&&Object(i.jsx)(I.a,{checked:j,onChange:function(e){return o.handleChangeSaveReturnFree(e)},className:"checkbox-payment",children:Object(i.jsx)("span",{className:"text-color-default text-checkbox-payment",children:B("conversation.createOrder.returnFree")})}),T&&T.invoice_tax>0&&Object(i.jsx)(I.a,{checked:b,onChange:function(e){return o.handleChangeSaveTax(e,E)},className:"checkbox-payment",style:{marginBottom:0},children:Object(i.jsx)("span",{className:"text-color-default text-checkbox-payment",children:B("conversation.createOrder.invoiceTaxCalculation")})})]}),b&&T&&T.invoice_tax>0&&Object(i.jsxs)("div",{className:"flex-between row-payment",children:[Object(i.jsxs)("span",{className:"text-color-default flex-align-items",children:[Object(i.jsx)("img",{src:Object(Ue.Nb)("receipt.svg"),className:"img"})," ",B("conversation.createOrder.invoiceTax")]}),Object(i.jsx)(ut.a,{id:"invoiceTax",currency:d,isMoney:!0,value:E,suffix:Object(Ue.yb)(d),disabled:!0,className:"input-background-default",boxClassName:"box-input-number-wrapper-custom background-default"})]}),x.map((function(t){var n,r;Nt.includes(t)?(n=o.getValuePayment(t),r=o.getKeyPayment(t)):(n=P[t]||0,r=t);var a=Object(i.jsx)("div",{children:Object(i.jsx)(ut.a,{id:r,currency:d,isMoney:!0,value:n,className:"input-background-default",callBack:function(e){Nt.includes(t)?o.onOrderPriceValueChange(r,e):o.onOrderPriceValueChange("payments",jt(jt({},P),{},Object(Z.a)({},r,e)))},suffix:Object(Ue.yb)(d),boxClassName:"box-input-number-wrapper-custom background-default"})},t);return Object(i.jsxs)("div",{className:"flex-between row-payment",children:[o.renderIconPayment(t,M),Object(i.jsx)(h.a,{overlayClassName:"pop-select pop-suggest-payment",placement:"topRight",trigger:"click",content:e>0?Nt.includes(t)?o.renderSuggestRemainPrice(e,r):o.renderSuggestRemainPrice(e,"payments",r):null,children:a},t)]},t)})),Object(i.jsxs)("div",{className:"flex-between row-payment",children:[Object(i.jsxs)("span",{className:"text-color-default flex-align-items",children:[Object(i.jsx)(N.a,{type:"plus-circle",className:"img img-payment"})," ",B("conversation.createOrder.surcharge")]}),Object(i.jsx)(ut.a,{id:"surcharge",className:"input-background-default",currency:d,isMoney:!0,value:_,callBack:function(e){return o.onOrderPriceValueChange("surcharge",e)},style:{textAlign:"right"},suffix:Object(Ue.yb)(d),boxClassName:"box-input-number-wrapper-custom background-default"})]}),(u&&"true"==u.enabled||0!=l)&&Object(i.jsxs)("div",{className:"prepaid-point flex-between row-payment",children:[Object(i.jsxs)("span",{className:"text-color-default flex-align-items",children:[Object(i.jsx)(N.a,{className:"img img-payment",type:"star"})," ",B("conversation.createOrder.prepaidByPoint")," (",B("conversation.createOrder.max"),": ",Object(Ue.cb)(y),")"]}),Object(i.jsx)(D.a,{title:Object(Ue.X)(m,d),placement:"left",children:Object(i.jsx)("div",{children:Object(i.jsx)(ut.a,{className:"input-background-default",id:"prepaidByPoint",currency:d,value:l,max:y,min:0,callBack:function(e){return o.onPrepaidByPointChange(e)},style:{textAlign:"right"},suffix:Object(i.jsx)(N.a,{type:"star",style:{color:"#ffbf00"}}),boxClassName:"box-input-number-wrapper-custom background-default"})})})]}),A&&Object(i.jsxs)("div",{className:"referral-money flex-between row-payment",children:[Object(i.jsxs)("span",{className:"text-color-default flex-align-items",children:[Object(i.jsx)(N.a,{type:"gift",className:"img img-payment"}),B("conversation.createOrder.referralMoney")]}),Object(i.jsx)(D.a,{title:o.renderRemainReferralAmount(),placement:"left",trigger:"hover",children:Object(i.jsx)("div",{children:Object(i.jsx)(ut.a,{className:"input-background-default",boxClassName:"box-input-number-wrapper-custom background-default",id:"referralMoney",currency:d,isMoney:!0,min:0,max:w,value:k,callBack:function(e){return o.onOrderPriceValueChange("referralAmountDiscount",e)},suffix:Object(Ue.yb)(d)})})})]}),C>0&&Object(i.jsxs)("div",{className:"flex-between row-payment",children:[Object(i.jsxs)("div",{className:"text-color-default flex-align-items",children:[Object(i.jsx)("img",{src:"/static/images/levera.svg",className:"img img-payment"}),Object(i.jsx)("div",{children:"Thanh to\xe1n Levera"})]}),Object(i.jsx)(ut.a,{className:"input-background-default",currency:d,isMoney:!0,min:0,disabled:!0,suffix:Object(Ue.yb)(d),value:t,boxClassName:"box-input-number-wrapper-custom background-default"})]}),C>0&&Object(i.jsx)(p.a,{style:{marginTop:10},type:"warning",message:Object(i.jsxs)("div",{children:["Li\xean h\u1ec7 Levera:",Object(i.jsx)("span",{style:{marginRight:4,fontWeight:500,marginLeft:4},children:"1900.888.619"}),"/",Object(i.jsx)("span",{style:{color:"rgb(24, 144, 255)",cursor:"pointer",marginLeft:4,fontWeight:500},onClick:function(){window.open("https://admin.levera.vn/")},children:"Levera.vn"})]})}),Object(i.jsxs)("div",{className:"flex-between row-payment row-partner",children:[Object(i.jsxs)("span",{className:"text-color-default flex-align-items",children:[Object(i.jsx)("img",{src:Object(Ue.Nb)("truck.svg"),className:"img img-payment"})," ",B("conversation.createOrder.shippingCompany")]}),Object(i.jsx)(bt.a,{t:B,placeholder:B("conversation.createOrder.shippingCompany"),currentShop:T,shopId:T.id,partnerId:v,onChangePartnerId:o.onChangePartner("partner_id")})]})]})})]})})})})),Object(Z.a)(Object(G.a)(o),"handleSelectBonusItems",(function(e){var t=o.props.t,n=o.state,r=n.selectedPromotionAdvance,a=n.cart,i=Te()(o.state.selectBonusItem)||[],c=Te()(a),s=r.bonus_items[e],d=i.filter((function(e){var t;return null===(t=r.bonus_items)||void 0===t?void 0:t.find((function(t){return t.variation_id==e.bonusItem.variationId}))}));if(parseInt(r.total_quantity_bonus||0)&&d.reduce((function(e,t){return e+t.bonusItem.quantity}),0)+s.quantity>r.total_quantity_bonus)return O.a.error({message:t("conversation.createOrder.errorAddBonusItems"),description:t("conversation.createOrder.outOfRangeQuantity")});s=o.convertItemToPushIntoCart(s);var u=c.findIndex((function(e){return e.isBonusProduct&&e.variationId==s.variationId}));u>-1?c[u].quantity+=parseInt(s.quantity||0):c.push(s),i.push({promotionAdvanceId:r.id,bonusItem:s}),o.setState({cart:c,isAddBonusProduct:!1,selectBonusItem:i})})),Object(Z.a)(Object(G.a)(o),"calcLeveraPoint",(function(e){var t=o.state,n=t.leveraPoint,r=t.statusOrder,a=t.thirdPartyInfomation,i=(null===a||void 0===a?void 0:a.point_formula)||{ratio:.4},c=[5,6,7].includes(r)?0:n||0,s=1e3*Math.floor(e*i.ratio/1e3);return s=Math.min(c,s),s=i.max?Math.min(s,i.max):s,Math.max(s,0)})),Object(Z.a)(Object(G.a)(o),"renderTitleDiscountByPromotionAdvance",(function(e){var t=o.state.currency,n=o.props.t;return"".concat(n("conversation.createOrder.discountAmount")," ").concat(Object(Ue.X)(o.calcDiscountByPromotionAdvance([e]),t))})),Object(Z.a)(Object(G.a)(o),"updateActivatedPromotionAdvanceCoupon",(function(e){var t=Te()(o.state.activatedPromotionAdvance);t=t.filter((function(e){return!["coupon_id_multiple_times","discount_by_coupon_id"].includes(e.promotion_advance_info.type)})),o.setState({activatedPromotionAdvance:t.concat(e)})})),Object(Z.a)(Object(G.a)(o),"deactivePromotionAdvanceCoupon",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Te()(o.state.activatedPromotionAdvance),n=e?t.filter((function(t){return["discount_by_coupon_id","coupon_id_multiple_times"].includes(t.promotion_advance_info.type)&&t.promotion_advance_id!=e})):[];o.updateActivatedPromotionAdvanceCoupon(n)})),Object(Z.a)(Object(G.a)(o),"handleChangeCouponId",(function(e){var t=o.props,n=t.shopId,r=t.accessToken,a=t.shopCustomer,i=t.dispatch,c=t.t,s=(t.currentShops,o.state),d=s.selectedCustomer,u=s.warehouseId,l=s.cart,p=s.currency,m=(null===a||void 0===a?void 0:a.tags)||[],h=o.getCurrentShop(),v=(null===h||void 0===h?void 0:h.currency)||"VND",f="".concat(Object(Ue.Mb)(!0),"/v1/shops/").concat(n,"/promotion_advance/get_promotion_coupon?access_token=").concat(r);We()({method:"get",url:f,params:{name:e,customer_tags:m,shop_customer_id:d.customer_id}}).then((function(e){if(e.data.success){var t,n,r,a,s,m,f,_,b,g,O,j,y,P,C;if(null!==h&&void 0!==h&&null!==(t=h.settings)&&void 0!==t&&t.only_active_one_promotion&&(null===(n=o.state.activatedPromotionAdvance)||void 0===n?void 0:n.length)>0)return i(Object(Ge.a)(Object(Ue.P)(c("conversation.createOrder.onlyActiveOnePromotion"))));var x=!(null!==e&&void 0!==e&&null!==(r=e.data)&&void 0!==r&&r.data.customer_tags)||0==(null===e||void 0===e||null===(a=e.data)||void 0===a||null===(s=a.data.customer_tags)||void 0===s?void 0:s.length);if(!x&&null!==d&&void 0!==d&&d.tags&&(x=o.compare2Array(e.data.data.customer_tags,null===d||void 0===d?void 0:d.tags)),(null===(m=e.data)||void 0===m||null===(f=m.data)||void 0===f||null===(_=f.warehouse_ids)||void 0===_?void 0:_.length)>0&&!e.data.data.warehouse_ids.find((function(e){return e==u})))return i(Object(Ge.a)(Object(Ue.P)(c("conversation.createOrder.voucherUseFailed"))));if(e.data.data.currency&&e.data.data.currency!=(p||v)||!e.data.data.currency&&(p||v)!=v)return i(Object(Ge.a)(Object(Ue.P)(c("conversation.createOrder.voucherUseFailed"))));var I=o.calcTotalPrice(l),S=(null===e||void 0===e||null===(b=e.data)||void 0===b||null===(g=b.data)||void 0===g||null===(O=g.promo_code_info)||void 0===O?void 0:O.order_price_min)||0,A=(null===e||void 0===e||null===(j=e.data)||void 0===j||null===(y=j.data)||void 0===y||null===(P=y.promo_code_info)||void 0===P?void 0:P.order_price_max)||0,w=!0;if(A>0&&(I<S||I>A)&&(w=!1),!A&&S>0&&I<S&&(w=!1),null!==e&&void 0!==e&&null!==(C=e.data)&&void 0!==C&&C.data&&x&&w){var N=Te()(o.state.activatedPromotionAdvance).filter((function(t){return["discount_by_coupon_id","coupon_id_multiple_times"].includes(t.promotion_advance_info.type)&&t.promotion_advance_id!=e.data.data.id}));return N.push({promotion_advance_id:e.data.data.id,promotion_advance_info:e.data.data}),o.updateActivatedPromotionAdvanceCoupon(N),i(Object(Ge.a)(Object(Ue.Ed)(c("conversation.createOrder.useVoucherSuccessfully")))),void o.setState({couponValue:null})}i(Object(Ge.a)(Object(Ue.P)(c("conversation.createOrder.voucherUseFailed")))),o.deactivePromotionAdvanceCoupon(e.data.data.id)}else o.renderErrorMessage(null,e.data.message||c("conversation.createOrder.errorAddVoucher"))})).catch((function(){console.log("L\u1ed7i th\xeam voucher")}))})),Object(Z.a)(Object(G.a)(o),"handleChangeInputCouponId",(function(e){var t=e.target.value;o.setState({couponValue:t},(function(){o.state.couponValue&&o.handleChangeCouponId(t)}))})),Object(Z.a)(Object(G.a)(o),"renderActivedComboAndPromotion",(function(){var e=o.state,t=e.activatedPromotionAdvance,n=e.activatedPromotionProducts,r=e.activatedComboProducts;if(null!==t&&void 0!==t&&t.length||null!==n&&void 0!==n&&n.length||null!==r&&void 0!==r&&r.length)return Object(i.jsxs)("div",{className:"list-voucher-activated",children:[o.renderTagCombo(!0),o.renderTagPromotion(!0)]})})),Object(Z.a)(Object(G.a)(o),"renderTagPromotion",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=o.props,n=t.t,r=t.currentShops,a=t.shopId,c=o.state,s=c.cart,d=c.currency,u=c.promotionAdvanceCanbeActive,l=c.promotionProductsCanBeActive,p=r.find((function(e){return e.id==a})),m=Object(K.a)(o.state.activatedPromotionAdvance),h=Object(K.a)(o.state.activatedPromotionProducts);return Object(i.jsx)(tt.a,{t:n,currency:d,cart:s,promotionProductsCanBeActive:l,activatedPromotionProducts:h,promotionAdvanceCanbeActive:u,activatedPromotionAdvance:m,activePromotionProduct:o.activePromotionProduct,currentShop:p,getItemIsApplying:function(e){return o.getItemIsApplying(e)},discountByEachPromotionAdvance:function(e){return o.discountByEachPromotionAdvance(e)},displayDiscountPromotionLevel:o.calcLevelPromotion,onlyActivated:e,calcDiscountByPromotionAdvance:o.calcDiscountByPromotionAdvance,deactivePromotionAdvanceCoupon:o.deactivePromotionAdvanceCoupon})})),Object(Z.a)(Object(G.a)(o),"renderTagCombo",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=o.props.t,n=o.state,r=n.comboBy,a=n.currency,c=n.comboProductsCanBeActive,s=o.reFormatItems(),d=o.oldCodeComboByProduct(),u=Object(K.a)(o.state.activatedComboProducts);return Object(i.jsx)(et.a,{t:t,currency:a,cart:s,comboBy:r,comboProductsCanBeActive:c,activatedComboProducts:u,activeComboProduct:o.activeComboProduct,oldCodeCombo:d,onlyActivated:e})})),Object(Z.a)(Object(G.a)(o),"renderComboAndPromotion",(function(){var e=o.props.t,t=o.state,n=t.comboBy,r=t.couponValue,a=t.disabledComboProduct,c=t.disabledComboCategory,s=t.hasPromotionByCouponId,d=t.disabledComboVariation,u=t.promotionAdvanceCanbeActive,l=t.promotionProductsCanBeActive,p=Object(K.a)(o.state.activatedPromotionAdvance),m=!a||!d||!c,h=o.getReferralCode();if(m||l.concat(u).length>0||s||h)return Object(i.jsxs)("div",{className:"box-combo-and-promotion",children:[m&&Object(i.jsxs)("div",{className:"card-combo-product-custom card-voucher-custom",children:[Object(i.jsx)("div",{className:"text-color-default font-weight-500 title-voucher",children:"Combo"}),Object(i.jsxs)("div",{children:[m&&Object(i.jsxs)(oe.a.Group,{onChange:o.onChangeCombo,value:n,className:"radio-group-combo",children:[Object(i.jsx)(oe.a,{className:"radio-combo-product",disabled:d,value:"variation",children:e("conversation.createOrder.variation")}),Object(i.jsx)(oe.a,{className:"radio-combo-product",disabled:a,value:"product",children:e("conversation.createOrder.product")}),Object(i.jsx)(oe.a,{className:"radio-combo-product",disabled:c,value:"category",children:e("conversation.createOrder.category")})]}),o.renderTagCombo()]})]}),(l.concat(u).length>0||s)&&Object(i.jsxs)("div",{className:"card-promotion-custom card-voucher-custom",children:[Object(i.jsx)("div",{className:"text-color-default font-weight-500 title-voucher",children:e("conversation.createOrder.promotion")}),Object(i.jsxs)("div",{children:[s&&Object(i.jsxs)("div",{className:"promotion-advance-coupon-ids",children:[(null===p||void 0===p?void 0:p.length)>0&&Object(i.jsx)("div",{className:"tag-coupon-ids",children:p.filter((function(e){return["discount_by_coupon_id","coupon_id_multiple_times"].includes(e.promotion_advance_info.type)})).map((function(e){return Object(i.jsx)(D.a,{title:o.renderTitleDiscountByPromotionAdvance(e),children:Object(i.jsx)(E.a,{className:"tag-voucher tag-promotion-id",color:Object(Ue.gb)(e.promotion_advance_id.replace(/\D/g,"")),closable:!0,onClose:function(){return o.deactivePromotionAdvanceCoupon(e.promotion_advance_id)},children:e.promotion_advance_info.name})})}))}),Object(i.jsx)(T.a,{id:"inputCouponId",placeholder:e("conversation.createOrder.InputPromotionCode"),onChange:o.handleChangeInputCouponId,value:r,prefix:Object(i.jsx)(N.a,{type:"percentage"}),className:"input-promotion-code",allowClear:!0})]}),o.renderTagPromotion()]})]}),o.renderReferralCode()]})})),Object(Z.a)(Object(G.a)(o),"onCheckDiscountLevel",(function(e){var t=o.props.cacheDb;!o.state.editingOrderId&&t.put({conv_id:o.cacheDbKey,field_name:"order.isCustomerLevel",value:e}),o.setState({isCustomerLevel:e})})),Object(Z.a)(Object(G.a)(o),"renderDiscountByCustomerLevel",(function(e,t){var n=o.state.currency,r=o.props.t;return t?Object(i.jsxs)("div",{children:[Object(i.jsxs)("span",{children:[r("conversation.createOrder.amountDiscount"),": "]}),Object(i.jsx)("span",{children:Object(Ue.X)(e,n,!0)})]}):r("conversation.createOrder.turnOnCustomerLevel")})),Object(Z.a)(Object(G.a)(o),"renderTotalDiscount",(function(e){var t=o.state,n=t.levelCustomer,r=t.activatedComboProducts,a=t.activatedPromotionProducts,c=t.currency,s=t.cart,d=t.isCustomerLevel,u=t.statusOrder,l=(t.discountByCustomerLevel,t.activatedPromotionAdvance),p=t.payment_from_customers_exchange_order,m=t.recentOrderId,h=t.noDiscountWholesale,v=o.props,f=v.currentShops,_=v.shopId,b=v.t,g=v.shopCustomer,O=f.find((function(e){return e.id==_})),j=o.checkDisabledDiscountLevelCustomer(),y=j.isActivatedLevel,P=j.isActivatedCustomerLevel,C=!(!(null!==y&&!y)&&!(null!==P&&!P)),x=g&&g.tags&&g.tags.length>0?g.tags.filter((function(e){return(O&&O.tags_exclusion_customer_level||[]).includes(e)})):[],I=m&&h||o.checkDiscountToWholesale()&&!m,S=!I&&!C&&0!=d,A=s.reduce((function(e,t){return e+o.calcDiscountByDiscountEachProduct(t)}),0),w=o.calcDiscountByReferralCode(),k=!I&&(Object(Ue.v)(u,2,-1)&&0==x.length);return Object(i.jsx)("div",{children:(!n&&0==r.length&&0==a.length&&l.length,Object(i.jsxs)("div",{children:[n&&Object(i.jsxs)("div",{style:{display:"flex"},children:[Object(i.jsx)(D.a,{title:o.renderDiscountByCustomerLevel(e,S),children:Object(i.jsxs)(E.a,{color:S?n.color_customer_level:"#d9d9d9",style:{fontWeight:600,cursor:"pointer"},onClick:k&&!C?function(){return o.onCheckDiscountLevel(!S)}:void 0,disabled:C,children:[n.name,S&&Object(i.jsx)(N.a,{style:{marginLeft:3},type:"check"})]})}),S&&Object(i.jsxs)("div",{children:[b("conversation.createOrder.discount"),"\xa0",Object(i.jsx)("span",{style:{color:"#49a9ee",fontWeight:600},children:2==n.discount_type?Object(Ue.X)(n.discount,c):"".concat(n.discount,"%")})," ",b("conversation.createOrder.eachOrder")]})]}),p>0&&Object(i.jsxs)("div",{children:[b("conversation.createOrder.paymentFromCustomerExchangeOrder"),": ",Object(i.jsx)("span",{children:Object(Ue.X)(p,c,!0)})]}),r.length>0&&Object(i.jsxs)("div",{children:[b("conversation.createOrder.discountByCombo"),": ",Object(i.jsx)("span",{children:Object(Ue.X)(o.calcDiscountByComboProducts(),c,!0)})]}),(a.length>0||l.length>0)&&Object(i.jsxs)("div",{children:[b("conversation.createOrder.discountByPromotion"),": ",Object(i.jsx)("span",{children:Object(Ue.X)(o.calcDiscountByPromotionProduct()+o.calcDiscountByPromotionProduct2()+o.calcDiscountByPromotionAdvance(),c,!0)})]}),A>0&&Object(i.jsxs)("div",{children:[b("conversation.createOrder.totalDiscountEachProduct"),": ",Object(i.jsx)("span",{children:Object(Ue.X)(A,c,!0)})]}),w>0&&Object(i.jsxs)("div",{children:[b("conversation.createOrder.discountByReferralCode"),": ",Object(i.jsx)("span",{children:Object(Ue.X)(w,c,!0)})]})]}))})})),Object(Z.a)(Object(G.a)(o),"onChangeCascaderOrderSource",(function(e){var t=e[0],n=e[1];o.setState({orderSources:t,account:n,isChangeOrderSource:!1},(function(){o.findPromotionAdvanceCanbeActive()}))})),Object(Z.a)(Object(G.a)(o),"getOrderSource",(function(){var e=o.props.pageId,t=o.state.orderSources,n=t?Te()(t):null;return!n&&e&&"zl"==e.slice(0,2)&&(n="-8"),!n&&e&&"tt"==e.slice(0,2)&&(n="-9"),!n&&e&&"wa"==e.slice(0,2)&&(n="-10"),!n&&e&&"ig"==e.slice(0,2)&&(n="-11"),!n&&e&&"lv"==e.slice(0,2)&&(n="-12"),!n&&e&&"ln"==e.slice(0,2)&&(n="-14"),n})),Object(Z.a)(Object(G.a)(o),"getValueCascader",(function(e){var t=o.props.pageId,n=o.state,r=n.orderSources,a=n.account,i=o.getOrderSource();i&&"-1"!=i||Ce()(Object(Ue.Sb)(e.order_sources,e).concat(Object(Ue.Nc)(e)),"id").map((function(e){e.id&&"-1"==e.id.toString()&&(i="-1")}));return r?[i,a]:t?[i,t]:void 0})),Object(Z.a)(Object(G.a)(o),"renderOrderSources",(function(e){var t,n,r=o.props.t,a=o.state,c=a.isChangeOrderSource,s=a.popupVisibleOrderSource,d=Object(Ue.Kc)(e,o.props.accessToken),l=o.getValueCascader(e);if(d.forEach((function(t){!n&&l&&l[1]&&t.value==l[0]&&t.children?n=Object(Ue.Nc)(e).map((function(e){return e.id})).find((function(e){return e==t.value}))?(t.children.find((function(e){return e.value==l[1]}))||{}).label:Object(i.jsxs)("span",{children:[Object(i.jsx)("span",{children:t.label}),"\xa0/\xa0",Object(i.jsx)("span",{children:(t.children.find((function(e){return e.value==l[1]}))||{}).label})]}):!n&&l&&l[0]&&t.value==l[0]&&(n=t.label)})),!n&&l&&l[1]&&d.find((function(e){return"-1"==e.value}))){var p=d.find((function(e){return"-1"==e.value})).children||[];n=(p.find((function(e){return e.page_id==l[1]}))||{}).label}return Object(i.jsx)(Ee.a.Fragment,{children:c?Object(i.jsx)(u.a,{className:"order-source-options background-default",popupClassName:"order-source-popup",options:d,displayRender:function(e,t){return Object(Ue.L)(e,t,o.props.accessToken)},placeholder:r("conversation.createOrder.selectOrderSource"),value:l,onChange:o.onChangeCascaderOrderSource,changeOnSelect:!0,showSearch:{filter:function(e,t){return t.some((function(t){return Object(Ue.w)(t.title).indexOf(Object(Ue.w)(e))>-1}))},render:function(e,t,n,r){return t.map((function(t,r){var o=t.title,a=Object(Ue.w)(e),c=Object(Ue.w)(o).indexOf(a)>-1?function(e,t,n){var r=Object(Ue.w)(e).indexOf(t);if(r>-1){var o=e.substr(0,r),a=e.substr(r,t.length),c=e.substr(r+t.length,e.length);return Object(i.jsxs)("span",{children:[o,Object(i.jsx)("span",{className:"".concat(n,"-menu-item-keyword"),children:a}),c]})}return e}(o,a,n):o;return 0===r?c:[" / ",c]}))},sort:function(){return 0}},expandTrigger:"hover",popupVisible:s,autoFocus:!0}):Object(i.jsx)("div",{className:"text-ellipsis text-other-info",onClick:function(){return o.setState({isChangeOrderSource:!0,popupVisibleOrderSource:!0})},style:{maxWidth:"calc(100% - ".concat((null===(t=document.getElementsByClassName("title-order-source")[0])||void 0===t?void 0:t.offsetWidth)||0,"px - 8px)")},children:l?n:r("conversation.createOrder.notAvailable")})})})),Object(Z.a)(Object(G.a)(o),"onWholesalePrice",(function(e){var t=o.getCurrentShop(),n=Te()(o.state.cart);return Object(Ue.dc)(t,n,e,o.state.tags,o.props.conversations.selectedCustomers[0],o.state.recentOrderId)})),Object(Z.a)(Object(G.a)(o),"getRetailPriceByCurrency",(function(e,t){var n=o.getCurrentShop(),r=(null===n||void 0===n?void 0:n.currency)||"VND";if(e.isWholesale){var a=o.onWholesalePrice(e),i=a.wholesalePrice;a.isWholesaleForAllVariations;return i}var c=e.retailPriceOriginal||e.retailPriceCurrencyOriginal||e.retailPrice,s=(e.retailPriceByCurrency||[]).filter((function(e){return e.retailPriceByCurrency>0})).find((function(e){return e.currency==t}));return s?s.retailPriceByCurrency:r==t?e.retailPriceCurrencyOriginal:c})),Object(Z.a)(Object(G.a)(o),"parseRetailPriceToRate",(function(e,t,n){var r,a=o.getCurrentShop(),i=(null===a||void 0===a?void 0:a.currency)||"VND";n=n||i;var c=null===(r=(a.multiple_currency||[]).find((function(e){return e.currency==n})))||void 0===r?void 0:r.rate,s=t.isWholesale,d=(t.retailPriceByCurrency||[]).find((function(e){return e.retailPriceByCurrency>0&&e.currency==n}));return!c||d&&!s||n==i?e:parseFloat(e/c).toFixed(1)*(Ue.pc.includes(n)?1:100)})),Object(Z.a)(Object(G.a)(o),"checkedChangeCurrency",(function(e,t){var n=o.props,r=n.currentShops,a=n.shopId,i=o.state,c=i.currency,s=i.isEditOrder,d=r.find((function(e){return e.id==a}));if(e&&!s&&d&&(d.multiple_currency||[]).length){var u=e.toString().split("_")[0],l=Object(Ue.A)().find((function(e){return e.countryCode==u&&[1,2,3].includes(u.length)})),p=t?e:l?l.currency:c;(d.multiple_currency||[]).map((function(e){return e.currency})).concat(d.currency).includes(p)&&o.handleChangeSelectCurrency(p)}})),Object(Z.a)(Object(G.a)(o),"handleChangeSelectCurrency",(function(e,t){var n=o.getCurrentShop(),r=(null===n||void 0===n?void 0:n.currency)||"VND",a=Te()(o.state.cart);if(a=a.map((function(t){var r=o.getRetailPriceByCurrency(t,e);r=o.parseRetailPriceToRate(r,t,e);var a=t.additionPrice||0;if(t.isPriceByWeight){var i=Te()(r);i=null!==n&&void 0!==n&&n.config_weight_product&&t.weight>0?parseFloat((i/1e3).toFixed(1)):i,r=Math.floor(i*t.weight);var c=i*t.weight*(t.quantity||1);a=Math.floor(c-r*(t.quantity||1))}return t=jt(jt({},t),{},{retailPrice:r,retailPriceWholesaleOriginal:r,additionPrice:a})})),t&&o.state.currency!=e){var i=(Te()(o.state.activatedPromotionAdvance)||[]).filter((function(t){var n,o,a;return["coupon_id_multiple_times","discount_by_coupon_id"].includes(t.promotion_advance_info.type)&&(!(null!==(n=t.promotion_advance_info)&&void 0!==n&&n.currency)&&(e||r)==r||(null===(o=t.promotion_advance_info)||void 0===o?void 0:o.currency)&&(null===(a=t.promotion_advance_info)||void 0===a?void 0:a.currency)==(e||r))}));o.updateActivatedPromotionAdvanceCoupon(i)}!o.state.editingOrderId&&o.props.cacheDb.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:a}),o.setState({currency:e,cart:a},(function(){o.calcDiscountPercent(),o.findPromotionProductsCanBeActive(),o.findPromotionAdvanceCanbeActive(),o.findComboCanBeActive()})),t&&localStorage.setItem("default_currrency_".concat(o.props.pageId),e)})),Object(Z.a)(Object(G.a)(o),"renderSelectCurrency",(function(e){var t=o.state.currency;if(e){var n=(e.multiple_currency||[]).filter((function(t){return t.currency!=e.currency}));return Object(i.jsx)(se.a,{onSelect:function(e){return o.handleChangeSelectCurrency(e,!0)},size:"small",value:t,className:"select-currentcy",children:n.concat({currency:e.currency}).map((function(e){return Object(i.jsx)(Pt,{value:e.currency,children:e.currency},e.currency)}))})}})),Object(Z.a)(Object(G.a)(o),"getGroupMeasure",(function(e,t){return(e||[]).find((function(e){return(e.nodes||[]).find((function(e){return e.id==t}))}))})),Object(Z.a)(Object(G.a)(o),"getExchangeMeasure",(function(e,t,n){var r=o.props,a=r.currentShops,i=r.shopId,c=a.find((function(e){return e.id==i})),s=null===c||void 0===c?void 0:c.product_measurements,d=(s||[]).find((function(t){return t.id==e})),u=o.getGroupMeasure(s,t),l=((null===d||void 0===d?void 0:d.nodes)||[]).filter((function(e){return n&&!e.is_removed}));if(!n||null===d||void 0===d||!d.is_removed)return t?((null===u||void 0===u?void 0:u.nodes)||[]).find((function(e){return e.id==t})):l.find((function(e){return e.is_default}))||pe()(l,"exchange_value")})),Object(Z.a)(Object(G.a)(o),"updateImageQuickProduct",(function(e,t){var n=o.state,r=n.cart,a=n.editingOrderId,i=o.props.cacheDb,c=r.findIndex((function(t){return t.index===e})),s=Te()(r);s[c].images=t,!a&&i.put({conv_id:o.cacheDbKey,field_name:"order.cart",value:s}),o.setState({cart:s})})),Object(Z.a)(Object(G.a)(o),"renderEditItem",(function(e){var t=o.state,n=t.currency,r=t.statusOrder,a=o.props,c=a.t,s=a.accessToken,d=a.currentShops,u=a.shopId,l=d.find((function(e){return e.id==u})),p=o.checkDisabledOrderDiscount(),m=e.isActualVariation||!e.name||!Object(Ue.v)(r,2,-1)||p,h=Object(Ue.v)(r,2,[0,1]),v=null!==l&&void 0!==l&&l.config_weight_product?e.isPriceByWeight?+(e.weight*e.quantity/1e3).toFixed(3):parseFloat(e.weight/1e3):e.isPriceByWeight?Math.round(e.weight*e.quantity):e.weight,f={marginTop:12},_=e.key;return Object(i.jsxs)("div",{style:{padding:0},children:[e.oneTime&&Object(i.jsx)(vt.a,{t:c,accessToken:s,images:e.images,disabled:h,updateImageQuickProduct:function(e){return o.updateImageQuickProduct(_,e)},className:"image-quick-product"}),Object(i.jsxs)(y.a,{gutter:14,style:f,children:[Object(i.jsxs)(C.a,{span:12,children:[Object(i.jsx)("span",{className:"text-color-default title-item-detail",children:c("conversation.createOrder.nameProduct")}),Object(i.jsx)(T.a,{placeholder:c("conversation.createOrder.nameProduct"),value:e.name,onChange:o.onChangeCart(_,"productName"),disabled:!e.oneTime,className:"item-detail-input input-focus background-default"})]}),Object(i.jsxs)(C.a,{span:12,children:[Object(i.jsx)("span",{className:"text-color-default title-item-detail",children:c("conversation.createOrder.productDetail")}),Object(i.jsx)(T.a,{defaultValue:e.detail?e.detail:void 0,className:"item-detail-input input-focus background-default",onChange:o.onChangeDetailProduct(_),disabled:!e.oneTime,placeholder:c("conversation.createOrder.detailProduct")})]})]}),Object(i.jsxs)(y.a,{gutter:14,style:f,children:[Object(i.jsxs)(C.a,{span:12,children:[Object(i.jsxs)("span",{className:"text-color-default title-item-detail",children:[c("conversation.createOrder.weight"),null!==l&&void 0!==l&&l.config_weight_product?"(kg)":"(g)",!e.isPriceByWeight&&Object(i.jsx)(D.a,{title:Object(i.jsxs)("span",{className:"text-color-default",children:[Object(i.jsxs)("span",{children:[c("conversation.createOrder.weight")," (",Object(i.jsx)("span",{className:"font-weight-500",children:null!==l&&void 0!==l&&l.config_weight_product?"".concat(e.weight/1e3," kg"):"".concat(e.weight," g")}),")"]}),"\xa0 X\xa0",Object(i.jsxs)("span",{children:[c("textOnly.statistics.quantity")," (",Object(i.jsx)("span",{className:"font-weight-500",children:e.quantity}),")"]}),"\xa0 =\xa0",Object(i.jsxs)("span",{children:[c("conversation.createOrder.totalWeight")," (",Object(i.jsxs)("span",{className:"font-weight-500",children:[(e.quantity*v).toString().replace(".",",")," ",null!==l&&void 0!==l&&l.config_weight_product?"kg":"g"]}),")"]})]}),children:Object(i.jsx)(N.a,{type:"info-circle",theme:"twoTone",style:{marginLeft:4}})})]}),Object(i.jsx)("div",{style:{display:"flex",alignItems:"center"},children:Object(i.jsx)(ut.a,{isMoney:!1,currency:n,isPercent:null===l||void 0===l?void 0:l.config_weight_product,min:0,value:v,callBack:function(e){return o.onChangeWeight(e,_)},step:null!==l&&void 0!==l&&l.config_weight_product?1:100,className:"item-detail-input item-input-number-custom background-default"})})]}),Object(i.jsxs)(C.a,{span:12,children:[Object(i.jsx)("span",{className:"text-color-default title-item-detail",children:c("conversation.createOrder.enterDiscountEachProduct")}),Object(i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(i.jsx)(ut.a,{className:"item-detail-input item-input-number-custom background-default",currency:n,value:e.discountEachProduct,callBack:function(t){return o.handleChangeDiscountEachProduct(e,t)},disabled:m||e.count.item.isIncludedAccessory,max:e.isDiscountPercent?100:null,isMoney:!e.isDiscountPercent}),Object(i.jsxs)(Ct,{style:{display:"flex",marginLeft:8},value:e.isDiscountPercent||!1,onChange:function(t){return o.handleChangeIsDiscountPercent(e,t.target.value)},disabled:m,buttonStyle:"solid",className:"item-detail-radio-group",children:[Object(i.jsx)(xt,{style:{minWidth:20,height:22,lineHeight:"20px",padding:"0px 5px",borderRadius:"4px 0px 0px 4px",border:"none"},value:!0,className:"item-detail-radio-button",children:"%"}),Object(i.jsx)(xt,{style:{minWidth:20,height:22,lineHeight:"20px",padding:"0px 5px",borderRadius:"0px 4px 4px 0px",border:"none"},value:!1,className:"item-detail-radio-button",children:Object(Ue.yb)(n)})]})]})]})]}),Object(i.jsxs)(y.a,{gutter:14,style:f,children:[Object(i.jsxs)(C.a,{span:e.oneTime?12:0,children:[Object(i.jsx)("span",{className:"text-color-default title-item-detail",children:c("conversation.createOrder.costCapital")}),Object(i.jsx)(ut.a,{currency:n,min:0,value:e.lastImportedPrice||0,callBack:function(e){return o.onChangeCostPrice(e,_)},className:"item-detail-input item-input-number-custom background-default"})]}),Object(i.jsxs)(C.a,{span:e.oneTime?12:24,children:[Object(i.jsx)("span",{className:"text-color-default title-item-detail",children:c("conversation.createOrder.assigningSellerByProduct")}),Object(i.jsx)(se.a,{showSearch:!0,allowClear:!0,showAction:["click"],placeholder:c("conversation.createOrder.selectEmployee"),onChange:o.onChangeCart(_,"assigningSellerId"),dropdownMatchSelectWidth:!1,size:"small",filterOption:function(e,t){return Object(Ue.fb)(e,t.props.label)},getPopupContainer:function(e){return e.parentNode},value:e.assigningSellerId,className:"select-assigner-seller-product background-default select-focus",disabled:e.isActualVariation,children:o.renderFormatedUsers(!0)})]})]}),Object(i.jsxs)("div",{style:f,children:[Object(i.jsx)("span",{className:"text-color-default title-item-detail",children:c("order.note")}),Object(i.jsx)(T.a,{className:"item-detail-input input-focus background-default",placeholder:c("order.note"),value:e.note,onChange:o.onChangeCart(_,"note")})]})]})})),Object(Z.a)(Object(G.a)(o),"handleSelectActualItem",(function(e,t){var n=o.state.searchResultActualVariation,r=Te()(o.state.cart||[]),a=(n||[]).find((function(e){return e.id===t})),i=o.handleBeforeSelectItem(a,1,t,null,!0);i=jt(jt({},i),{},{quantity:e.quantity,discount_each_product:e.discountEachProduct,is_discount_percent:e.isDiscountPercent,retailPrice:e.retailPrice}),r[e.key]=jt(jt({},r[e.key]),{},{actualVariationInfo:i,isDeleteActualVariationInfo:!1}),o.setState({cart:r})})),Object(Z.a)(Object(G.a)(o),"renderActualVariationInfo",(function(e){var t=null!==e&&void 0!==e&&e.actualVariationInfo?[e.actualVariationInfo]:[];return Object(i.jsxs)("section",{className:"actual-variation-info",children:[o.renderTableProductTitle(e,t),o.renderProductSearch(e,!0)]})})),Object(Z.a)(Object(G.a)(o),"onChangeTabsProductDetail",(function(e){o.setState({tabsProductDetail:e})})),Object(Z.a)(Object(G.a)(o),"renderProductDetail",(function(e){var t=o.props.t,n=o.state.tabsProductDetail;return Object(i.jsxs)(b.a,{activeKey:n,onChange:o.onChangeTabsProductDetail,className:"tabs-product-detail",children:[Object(i.jsx)(b.a.TabPane,{tab:t("conversation.createOrder.editProduct"),children:o.renderEditItem(e)},"edit_order_item"),!e.oneTime&&Object(i.jsx)(b.a.TabPane,{tab:t("conversation.createOrder.productExchange"),children:o.renderActualVariationInfo(e)},"actual_variation")]})})),Object(Z.a)(Object(G.a)(o),"handleNavSelect",(function(e){return o.selectedSuggestion=e})),Object(Z.a)(Object(G.a)(o),"handleChangeMeasure",(function(e,t,n,r){var a=o.state.cart,i=Te()(a),c=o.getExchangeMeasure(e.measureGroupId,t);i[n].measureInfo={measure_id:t,exchange_value:c.exchange_value},o.setState({cart:i},(function(){var t=e.count.value/r.exchange_value*c.exchange_value;o.onProductQuantityChange(t,n)}))})),Object(Z.a)(Object(G.a)(o),"onChangeCostPrice",(function(e,t){var n=o.state.cart,r=Te()(n);r[t].lastImportedPrice=e,o.setState({cart:r})})),Object(Z.a)(Object(G.a)(o),"handleSearchChange",(function(e){var t=o.props,n=t.currentShops,r=t.shopId,a=n.find((function(e){return e.id==r}));if(a){var c=(a.quick_notes.filter((function(e){return!e.type||"normal"===e.type}))||[]).filter((function(t){return-1!=t.content.indexOf(e)||-1!=t.shortcut.indexOf(e)}));c=(c||[]).map((function(e){return Object(i.jsxs)(St,{value:e.content,data:e,style:{maxWidth:400},children:[e.shortcut&&Object(i.jsx)(E.a,{color:"purple",children:e.shortcut}),e.content]})})),o.setState({suggestions:c})}})),Object(Z.a)(Object(G.a)(o),"handleTextareaChange",(function(e){return function(t){var n=o.props.cacheDb;o.isSelectItem=!1,o.selectedSuggestion&&(t=(t=t.getPlainText()).replace("/".concat(o.selectedSuggestion),o.selectedSuggestion),t=It(t),o.selectedSuggestion=null),"noteOrder"===e?(!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.noteOrder",value:t.getPlainText()}),o.setState({noteOrder:t})):(!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.notePrintOrder",value:t.getPlainText()}),o.setState({notePrintOrder:t}))}})),Object(Z.a)(Object(G.a)(o),"handleVisibaleEditNote",(function(e){var t="id-".concat(e),n=document.getElementById(t);o.setState(Object(Z.a)({},e,!o.state[e]),(function(){o.state[e]&&o.handleFocusMention(),n&&n.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}))})),Object(Z.a)(Object(G.a)(o),"renderQuickNote",(function(e){var t=o.state,n=t.suggestions,r=t.noteOrder,a=t.notePrintOrder,c=t.noteImages,s=o.props,d=s.t,u=s.conversations,l=s.pages,p="notePrintOrder"===e?a:r,m=d("notePrintOrder"===e?"conversation.createOrder.orderTrackingNote":"conversation.createOrder.orderNote");"noteOrder"!==e||"instagram"!=l.currentPlatform||p.getPlainText()||(p=It("IG: "+u.selectedFrom.username));var h="noteOrder"===e&&c&&c.length>0?"has-image":"",v="noteOrder"==e?"isChangeNoteOrder":"isChangeNotePrintOrder",_=p.getPlainText();return Object(i.jsxs)("div",{className:"note ".concat("noteOrder"==e?"note-order":"note-print-order"),id:"id-".concat(v),children:[Object(i.jsxs)("div",{className:"flex-between",children:[Object(i.jsx)("div",{className:"text-color-default text-nowrap title-note",children:d("conversation.createOrder.".concat("noteOrder"==e?"noteOrder":"notePrintOrder"))}),o.state[v]?Object(i.jsx)(f.a,{onClick:function(){return o.handleVisibaleEditNote(v)},className:"btn-cancel-note btn-focus-custom font-weight-500",children:d("close")}):_||(null===c||void 0===c?void 0:c.length)>0&&"noteOrder"==e?"noteOrder"==e?Object(i.jsxs)("div",{onClick:function(){return o.handleVisibaleEditNote(v)},className:"flex-align-items div-content-note",children:[(null===c||void 0===c?void 0:c.length)>0&&"noteOrder"==e&&Object(i.jsxs)("div",{className:"box-image",children:[Object(i.jsx)("div",{className:"frame-images",children:Object(i.jsx)("span",{children:Object(i.jsx)("a",{className:"div-img",children:Object(i.jsx)("img",{className:"img",src:c[0]})})})}),Object(i.jsxs)("span",{className:"badeg-note-images font-weight-500",children:["+",c.length]})]}),_&&Object(i.jsx)(D.a,{title:p.getPlainText(),children:Object(i.jsx)("a",{className:"content-note text-note text-ellipsis",children:Object(i.jsx)("span",{children:p.getPlainText()})})})]}):Object(i.jsx)(D.a,{title:p.getPlainText(),children:Object(i.jsx)("a",{className:"content-note text-note text-ellipsis",onClick:function(){return o.handleVisibaleEditNote(v)},children:Object(i.jsx)("span",{children:p.getPlainText()})})}):Object(i.jsx)("span",{className:"text-note",onClick:function(){return o.handleVisibaleEditNote(v)},children:d("conversation.createOrder.addNote")})]}),o.state[v]&&Object(i.jsx)(ee.a,{style:{fontSize:13,minHeight:50,resize:"none"},className:"mention-note background-default".concat(" ",h),prefix:"/",notFoundContent:"Tr\u1ed1ng",placement:"top",onSearchChange:o.handleSearchChange,suggestions:n,onChange:o.handleTextareaChange(e),onSelect:o.handleNavSelect,value:p,placeholder:m,multiLines:!0,ref:o.focusMention}),"noteOrder"===e&&o.state[v]&&o.renderNoteImages()]})})),Object(Z.a)(Object(G.a)(o),"handleFocusMention",(function(){o.focusMention.current&&o.focusMention.current.focus()})),Object(Z.a)(Object(G.a)(o),"renderNoteImages",(function(){var e=o.state.noteImages,t=o.props,n=t.t,r=t.accessToken;return Object(i.jsx)(vt.a,{t:n,accessToken:r,images:e,updateImageQuickProduct:function(e){return o.setState({noteImages:e})}})})),Object(Z.a)(Object(G.a)(o),"handleChangeDiscountEachProduct",(function(e,t){var n=o.state.cart,r=Te()(n);r[e.key].isDiscountPercent&&t>100&&(t=100),r[e.key].discountEachProduct=t,o.setState({cart:r})})),Object(Z.a)(Object(G.a)(o),"handleChangeIsDiscountPercent",(function(e,t){var n=o.state.cart,r=Te()(n);r[e.key].isDiscountPercent=t,t&&r[e.key].discountEachProduct&&r[e.key].discountEachProduct>100&&(r[e.key].discountEachProduct=100),o.setState({cart:r})})),Object(Z.a)(Object(G.a)(o),"onChangeOrderDiscountPercent",(function(e,t){var n=o.props,r=n.cacheDb,a=(n.conversationId,Math.round(t*e/100));o.state.editingOrderId||(r.put({conv_id:o.cacheDbKey,field_name:"order.discountAmount",value:a}),r.put({conv_id:o.cacheDbKey,field_name:"order.orderDiscountPercent",value:e})),o.setState({discountAmount:a,orderDiscountPercent:e})})),Object(Z.a)(Object(G.a)(o),"renderPopoverDiscountAmount",(function(e){var t=o.state,n=t.currency,r=t.orderDiscountPercent;return Object(i.jsx)("div",{className:"popover-discount-percent",children:Object(i.jsx)(ut.a,{id:"orderDiscountPercent",prefix:Object(i.jsx)(N.a,{type:"calculator"}),currency:n,min:0,value:r,callBack:function(t){return o.onChangeOrderDiscountPercent(t,e)},suffix:"%",disabled:o.checkDisabledOrderDiscount()})})})),Object(Z.a)(Object(G.a)(o),"getListPostFromAttachment",(function(){var e=o.props,t=e.messages,n=(e.t,e.pageId),r=e.conversations,a=[];return(t.data||[]).map((function(e){if(e.attachments&&e.attachments.length>0){var t=e.attachments.findIndex((function(e){return e&&"link"==e.type&&e.url&&(e.url.includes("/posts/")||e.url.startsWith("https://facebook.com/".concat(n,"_")))}));if(t>-1){var r=e.attachments[t].url.match(/\d+/g)||[];1==(r=r.length>2?[]:r).length&&r.unshift(n),r=r.join("_")||null,a.push({inserted_at:Qe()(e.inserted_at),post_id:r})}}})),r&&r.selectedCustomers&&r.selectedCustomers.map((function(e){(e.ad_clicks||[]).map((function(e){e.post_id&&a.push({inserted_at:Qe()(e.inserted_at),post_id:e.post_id})}))})),Oe()(a,"inserted_at").reverse()})),Object(Z.a)(Object(G.a)(o),"onChangePostId",(function(e){return o.setState({selectedPostId:e})})),Object(Z.a)(Object(G.a)(o),"handleVisiblePopover",(function(e){var t=o.state.editProductKey;o.setState({editProductKey:e.key!=t?e.key:null,tabsProductDetail:e.actualVariationInfo&&!e.oneTime?"actual_variation":"edit_order_item",searchResultActualVariation:[]})})),Object(Z.a)(Object(G.a)(o),"renderOrderItemButton",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=o.state.editProductKey,r=o.props.auth,a=o.getCurrentShop();if(a){var c=e.key==n,s={display:c?"flex":"none"},d=a.user_shop&&Object(Ue.bd)(a.user_shop.role),u=!d.can_assign_order_to_another&&a.settings.do_not_delete_products_assigned_to_other&&e.assigningSellerId&&e.assigningSellerId!=r.userId;return Object(i.jsxs)("div",{className:"edit-icon pos-transition ".concat(o.state.currentWidth<1152?"edit-icon-custom":""),style:s,children:[!(null!==e&&void 0!==e&&e.isActualVariation)&&Object(i.jsx)(h.a,{content:o.renderProductDetail(e),placement:"left",trigger:"click",overlayClassName:"product-detail-custom product-detail-custom-".concat(e.key),visible:c,children:Object(i.jsx)("div",{className:"icon-edit",id:"icon-edit-product",onClick:function(){return o.handleVisiblePopover(e)}})}),!u&&Object(i.jsx)("div",{className:"icon-delete",id:"".concat((null===e||void 0===e?void 0:e.isActualVariation)?"icon-delete-actual":""),onClick:function(){return o.handleDeleteProduct(e.key,t)}})]})}})),Object(Z.a)(Object(G.a)(o),"autoSetupAddress",(function(e){var t=o.props.cacheDb,n=o.state,r=n.warehouseId,a=n.partner,i=e.country_code||e.countryCode,c=e.province_id||e.provinceId,s=e.district_id||e.districtId,d=e.commune_id||e.communeId,u=e.post_code;!o.state.editingOrderId&&t.put({conv_id:o.cacheDbKey,field_name:"order.selectedAddress",value:e.address}),i&&o.onChangeCountry(i,!1),c&&o.onProvinceSelected({value:c},!1),s&&o.onDistrictSelected({value:s},!1),d&&o.onCommuneSelected({value:d},!1),u&&o.handlePostcode(u,!0),!r||!c||s||a&&a.extend_code||o.handleAutoFillTransport(c,null),!(r&&c&&s)||a&&a.extend_code||o.handleAutoFillTransport(c,s)})),Object(Z.a)(Object(G.a)(o),"autoFillShippingAddress",(function(e){var t=o.state,n=t.addressSource,r=t.selectedCustomer,a=o.props.messages;if(n)n.key==e.key&&(n.selected=!0,o.setState({addressSource:n})),o.autoSetupAddress(n);else if(e.isRecentAddress){var i=(o.getRecentAddressOptions(r)||[]).find((function(t){return t.id==e.key}));i&&o.autoSetupAddress(i)}else(a.data||[]).map((function(t){if(t.attachments){var n=t.attachments.find((function(t){return t&&"address"==t.type&&t.address==e.value&&t.full_address==e.label}));n&&o.autoSetupAddress(n)}}))})),Object(Z.a)(Object(G.a)(o),"dataAddressSource",(function(e){var t="".concat(Object(Ue.Mb)(!0),"/v1/geo/detect_address?address=").concat(e,"&shop_id=").concat(o.props.shopId),n=Object(Ue.ib)();We.a.get(t).then((function(e){if(e.data){var t=e.data;t.full_address&&o.setState({addressSource:jt(jt({},t),{},{key:n})})}}))})),Object(Z.a)(Object(G.a)(o),"getProvincesWhenSearchNone",(function(e){var t=o.props.accessToken,n="".concat(Object(Ue.Mb)(!0),"/v1/geo/provinces?country_code=").concat(e,"&access_token=").concat(t);return We.a.get(n).then((function(e){if(e.success){1==e.data.length&&(o.setState({provinceId:e.data[0].id}),o.loadDistricts(o.state.provinceId));var t=e.data.map((function(e){return{value:e.id,label:e.name}}));o.cacheDbAddress&&o.cacheDbAddress.setItemCache("provinces",t),o.setState({provinces:t})}}))})),Object(Z.a)(Object(G.a)(o),"getDistrictsWhenSearchNone",(function(e){var t=o.props.accessToken,n="".concat(Object(Ue.Mb)(!0),"/v1/geo/districts?province_id=").concat(e,"&access_token=").concat(t);return We.a.get(n).then((function(e){if(e.success){var t=e.data.map((function(e){return{value:e.id,label:e.name}}));o.cacheDbAddress&&o.cacheDbAddress.setItemCache("districts",t),o.setState({districts:t})}}))})),Object(Z.a)(Object(G.a)(o),"getCommunesWhenSearchNone",(function(e){var t=o.state,n=(t.countries,t.countryId,o.checkCountryCode("66")),r=o.checkCountryCode("60"),a=o.checkCountryCode("966");if(!(n||r||a)){var i=o.props.accessToken,c="".concat(Object(Ue.Mb)(!0),"/v1/geo/communes?district_id=").concat(e,"&access_token=").concat(i);return We.a.get(c).then((function(e){if(e.success){var t=e.data.map((function(e){return{value:e.id,label:e.name}}));o.cacheDbAddress&&o.cacheDbAddress.setItemCache("communes",t),o.setState({communes:t})}}))}})),Object(Z.a)(Object(G.a)(o),"handlePostcode",(function(e,t){var n=o.props.cacheDb,r={value:e,label:e,title:e},a=t?"order.postcode":"order.commune";!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:a,value:r}),e?t?o.setState({postcode:e}):o.setState({communeId:r.value,communeName:r.label}):t?o.setState({postcode:""}):o.setState({communeId:"",communeName:""})})),Object(Z.a)(Object(G.a)(o),"onSelectCustomer",(function(e){var t=o.props.conversations.selectedCustomers,n=o.props.cacheDb,r=t.find((function(t){return t.id==e}));!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.customerName",value:r.name}),o.setState({customerName:r.name,orderCustomerName:r.name,selectedCustomer:r});var a=o.getRecentAddressOptions(r);a&&a.length>0?o.onAddressSelected(a[0]):(o.setState({selectedAddress:"",countryId:"",provinceId:"",provinceName:"",districtId:"",districtName:"",districts:[],communeId:"",communeName:"",communes:[],addressSource:null}),!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.selectedAddress",value:void 0}),o.setState({disableShipOrder:!1})),o.onCustomerDuplicated(),o.genLevelCustomer()})),Object(Z.a)(Object(G.a)(o),"onChangeCustomer",(function(e){var t=o.state.editingOrderId,n=o.props.cacheDb;void 0==e&&(o.setState({selectedAddress:"",countryId:"",provinceId:"",provinceName:"",districtId:"",districtName:"",districts:[],communeId:"",communeName:"",communes:[],addressSource:null,postcode:"",postcodes:[]}),!o.state.editingOrderId&&n.put({conv_id:o.cacheDbKey,field_name:"order.selectedAddress",value:void 0}),o.setState({disableShipOrder:!1})),!t&&n.put({conv_id:o.cacheDbKey,field_name:"order.customerName",value:e}),o.setState({customerName:e,orderCustomerName:e})})),Object(Z.a)(Object(G.a)(o),"renderInputCusNamePhoneNumber",(function(){var e,t=o.state,n=t.tab,r=t.customerName,a=t.orderCustomerName,c=t.isLoadingCheckedPhone,s=t.selectedPhone,d=o.props,u=d.t,l=d.conversations,p=d.cacheDb,m=d.pageId,h=o.props.messages,v=h.recentPhoneNumbers,f=h.recentOrders,_=1==n?r:a,b="";if(o.isLegalToUseRecentOrder()&&(null===f||void 0===f?void 0:f.length)>0){var g=-1;f.forEach((function(e){e.phone_number&&e.id>g&&(g=e.id,b="".concat(e.phone_number))}))}var O=b?[b]:[];O=v.concat(O);var j=(O=Object(K.a)(new Set(O))).map((function(e){return Object(i.jsx)(F.a.Option,{text:e,children:Object(i.jsx)("span",{children:e})},e)})),y=(l.selectedCustomers||[]).filter((function(e){return e.fb_id!=m})).map((function(e){return Object(i.jsx)(F.a.Option,{text:e.name,children:Object(i.jsx)("span",{children:e.name})},e.id)}));return Object(i.jsxs)("div",{className:"row-customer-info",style:{marginTop:0},children:[Object(i.jsx)("div",{className:"item-customer-info customer-name input-customer-marign-right",children:1==(null===(e=l.selectedCustomers)||void 0===e?void 0:e.length)?Object(i.jsx)(T.a,{id:"customerName",placeholder:u("conversation.createOrder.customerName"),style:{height:24},className:"input-customer background-default input-focus text-color-default",value:_,onChange:function(e){p.put({conv_id:o.cacheDbKey,field_name:"order.customerName",value:e.target.value});var t=1===n?{customerName:e.target.value}:{orderCustomerName:e.target.value};o.setState(t)}}):Object(i.jsx)(F.a,{dropdownClassName:"customize-select-dropdown",value:_,dataSource:y,onSelect:o.onSelectCustomer,onChange:o.onChangeCustomer,optionLabelProp:"text",style:{width:"100%"},allowClear:!0,children:Object(i.jsx)(T.a,{id:"customerName",className:"input-phone-number input-customer input-focus background-default text-color-default",value:_||"",placeholder:u("conversation.createOrder.customerName"),autoComplete:"off"})})}),Object(i.jsxs)("div",{className:"item-customer-info customer-phone-number input-customer-marign-left",children:[Object(i.jsx)(F.a,{dropdownClassName:"customize-select-dropdown",value:s||void 0,dataSource:j,onChange:o.onChangePhoneNumber,optionLabelProp:"text",style:{width:"100%"},children:Object(i.jsx)(T.a,{className:"input-phone-number input-customer input-focus background-default text-color-default",value:s||"",placeholder:u("conversation.createOrder.customerPhone"),autoComplete:"off"})}),c&&Object(i.jsx)("span",{style:{position:"absolute",right:10,top:3},children:Object(i.jsx)(N.a,{type:"loading"})})]})]})})),Object(Z.a)(Object(G.a)(o),"handleEmailChange",(function(e){var t=o.props.cacheDb,n=e.target.value;t.put({conv_id:o.cacheDbKey,field_name:"order.selectedEmail",value:n}),o.setState({selectedEmail:n})})),Object(Z.a)(Object(G.a)(o),"renderSelectAddess",(function(){var e=o.state,t=e.selectedAddress,n=e.addressSource,r=e.selectedCustomer,a=e.selectedEmail,c=o.props,s=c.messages,d=c.t,u=n?[{key:n.key,value:n.address,label:n.full_address}]:[];u=r?u.concat(o.getRecentAddressOptions(r).map((function(e){return{key:e.id,value:e.value,label:e.label,isRecentAddress:!0}}))):u,u=(u=(s.data||[]).reduce((function(e,t){var n=t.attachments.find((function(e){return e&&"address"==e.type})),r=n&&n.id?n.id:Object(Ue.ib)();return n?e.concat([{key:r,value:n.address,label:n.full_address}]):e}),u)).reduce((function(e,t){return-1==e.findIndex((function(e){return e.value==t.value&&e.label==t.label}))?e.concat([t]):e}),[]);var l=o.showEmailOrder();return Object(i.jsxs)("div",{className:"row-customer-info",children:[Object(i.jsx)("div",{className:"item-customer-info customer-address ".concat(l?"input-customer-marign-right":"customer-full-width"),children:Object(i.jsx)(F.a,{allowClear:!0,value:t?t.toString():void 0,id:"shippingAddress",dropdownClassName:"customize-select-dropdown customize-select-dropdown-address ".concat(l?"customize-dropdown-show-email":""),style:{width:"100%"},dataSource:u.map((function(e){return Object(i.jsxs)(F.a.Option,{text:e.value,children:[e.isRecentAddress&&Object(i.jsx)(N.a,{type:"check-circle",theme:"twoTone",twoToneColor:"#52c41a"})," ",Object(i.jsx)("span",{children:e.label})]},e.key)})),onSearch:o.onSearchAddress,onSelect:function(e){return o.onSelectAddress(e,u)},onChange:function(e){return o.onChangeAddress(e,u)},optionLabelProp:"text",children:Object(i.jsx)(T.a,{autoComplete:"off",value:t?t.toString():void 0,id:"shippingAddress",placeholder:d("conversation.createOrder.shippingAddress"),className:"input-customer input-focus background-default text-color-default"})})}),l&&Object(i.jsx)("div",{className:"item-customer-info customer-mail input-customer-marign-left",children:Object(i.jsx)(T.a,{className:"input-customer input-focus background-default text-color-default",value:a?a.toString():void 0,id:"email",placeholder:"Email",onChange:o.handleEmailChange,style:{height:24}})})]})})),Object(Z.a)(Object(G.a)(o),"getPlaceholderAddress",(function(e,t){var n=o.props.t,r="";switch(t){case"commune":switch(e){case"1":r=n("conversation.createOrder.town");break;case"63":r=n("conversation.createOrder.communePhilippines");break;case"973":r=n("conversation.createOrder.communeBahrain");break;default:r=n("conversation.createOrder.communeName")}break;case"district":switch(e){case"1":r=n("conversation.createOrder.county");break;case"60":case"63":r=n("conversation.createOrder.city");break;case"965":r=n("conversation.createOrder.districtKuwait");break;case"973":r=n("conversation.createOrder.districtBahrain");break;case"968":r=n("conversation.createOrder.provinceName");break;default:r=n("conversation.createOrder.districtName")}break;default:switch(e){case"1":r=n("conversation.createOrder.state");break;case"965":case"968":case"973":r=n("conversation.createOrder.provinceBahrain");break;case"974":r=n("conversation.createOrder.municipality");break;default:r=n("conversation.createOrder.provinceName")}}return r})),Object(Z.a)(Object(G.a)(o),"renderSelectCountry",(function(e){var t=o.state,n=t.countries,r=t.countryId,a=t.provinceId,c=t.provinces,s=o.props.t;return Object(i.jsxs)("div",{className:"row-customer-info",children:[n.length>1&&Object(i.jsx)("div",{className:"item-customer-info customer-country input-customer-marign-right",children:Object(i.jsx)(se.a,{allowClear:!0,className:"select-customer background-default select-focus",showSearch:!0,dropdownClassName:"customize-select-dropdown",placeholder:s("conversation.createOrder.countryName"),value:r?r.toString():void 0,onChange:o.onChangeCountry,style:{width:"100%"},children:n.map((function(e){return Object(i.jsx)(se.a.Option,{value:e,children:Object(Ue.o)(e)},e)}))})}),!e&&Object(i.jsx)("div",{className:"item-customer-info customer-province ".concat(n.length<=1?"customer-full-width":"input-customer-marign-left"),children:Object(i.jsx)(Je.a,{allowClear:!0,className:"select-customer background-default select-focus",showSearch:!0,refFunc:o.selectProvince,value:a||void 0,dataSource:c,placeholder:o.getPlaceholderAddress(o.getCountryId(r),"province"),onChange:o.onChangeProvince,getAddrWhenSearchNone:function(){return o.getProvincesWhenSearchNone(r||n[0])},style:{width:"100%"}})}),e&&o.renderSelectCommune(e)]})})),Object(Z.a)(Object(G.a)(o),"checkCountryCode",(function(e){var t=o.state,n=t.countries,r=t.countryId;return n&&1==n.length&&n[0]==e||r&&"".concat(r)==e})),Object(Z.a)(Object(G.a)(o),"renderSelectCommune",(function(e){o.props.t;var t=o.state,n=t.districtId,r=t.communeId,a=t.communes,c=t.countries,s=t.tab,d=t.countryId,u=o.checkCountryCode("66"),l=o.checkCountryCode("60"),p=o.checkCountryCode("966"),m=o.checkCountryCode("62"),h=o.checkCountryCode("82"),v=r||void 0;return v=v&&u&&!v.includes("66_R")?void 0:v,Object(i.jsx)("div",{className:"item-customer-info customer-commune input-customer-marign-left ".concat(c.length<=1?"customer-full-width":""),style:e?{}:{width:"".concat(m||u?"calc((100% - 110px)/2)":"50%")},children:Object(i.jsx)(Je.a,{allowClear:!0,className:"select-customer background-default select-focus",showSearch:!0,refFunc:o.selectCommune,value:v,dataSource:a,placeholder:l||e||p||h?"Postal code":o.getPlaceholderAddress(o.getCountryId(d),"commune"),onChange:o.onChangeCommune,getAddrWhenSearchNone:function(){return o.getCommunesWhenSearchNone(1==s?n:r)},isPostcode:l||e||p||h,handlePostcode:function(e){return o.handlePostcode(e)},style:{width:"100%"}})})})),Object(Z.a)(Object(G.a)(o),"renderSelectPostcode",(function(){var e=o.state,t=e.postcode,n=e.postcodes,r=e.communeId,a=o.checkCountryCode("1"),c=o.checkCountryCode("66"),s=t||void 0;return s=s||(c&&r&&!r.includes("66_R")?r:void 0),Object(i.jsx)("div",{className:"item-customer-info ".concat(a?"customer-post-code-usa":"customer-post-code"),children:Object(i.jsx)(Je.a,{allowClear:!0,showSearch:!0,className:"select-customer background-default select-focus",refFunc:o.selectPostcode,value:s,dataSource:n,placeholder:"Postal code",onChange:function(e){return o.handlePostcode(e,!0)},isPostcode:!0,handlePostcode:function(e){return o.handlePostcode(e,!0)},style:{width:"100%"}})})})),Object(Z.a)(Object(G.a)(o),"renderSelectDistrictCommune",(function(e){var t=o.state,n=t.districtId,r=t.districts,a=t.provinceId,c=t.tab,s=t.countryId,d=(o.props.t,o.checkCountryCode("62")),u=o.checkCountryCode("1"),l=o.checkCountryCode("66"),p=["965","968","974"].includes(o.getCountryId(s));return Object(i.jsxs)("div",{className:"row-customer-info",children:["1"!=s&&Object(i.jsx)("div",{className:"item-customer-info customer-district ".concat(p&&!d?"customer-full-width":"input-customer-marign-right"),style:{width:"".concat(d||l?"calc((100% - 110px)/2)":"50%")},children:Object(i.jsx)(Je.a,{allowClear:!0,className:"select-customer background-default select-focus",style:{width:"100%"},showSearch:!0,refFunc:o.selectDistrict,value:n||void 0,dataSource:r,placeholder:o.getPlaceholderAddress(o.getCountryId(s),"district"),onChange:o.onChangeDistrict,getAddrWhenSearchNone:function(){return o.getDistrictsWhenSearchNone(1==c?a:n)}})}),!e&&!p&&o.renderSelectCommune(e),(d||u||l)&&o.renderSelectPostcode()]})})),Object(Z.a)(Object(G.a)(o),"handleCallback",(function(e){return function(t){o.setState(Object(Z.a)({},"searchResult".concat(e),t))}})),Object(Z.a)(Object(G.a)(o),"handleChangeSaveReturnFree",(function(e){var t=o.props.pageId;localStorage["is_return_free_".concat(t)]&&localStorage.removeItem("is_return_free_".concat(t)),localStorage.setItem("is_return_free_".concat(t),e.target.checked),o.setState({returnFree:e.target.checked})})),Object(Z.a)(Object(G.a)(o),"handleChangeSaveIsFreeShipping",(function(e){var t=o.props.pageId;localStorage.setItem("is_free_shipping_".concat(t),e.target.checked),o.setState({isFreeShip:e.target.checked})})),Object(Z.a)(Object(G.a)(o),"handleChangeSaveTax",(function(e,t){var n=o.props.pageId;localStorage["is_calculation_tax_".concat(n)]&&localStorage.removeItem("is_calculation_tax_".concat(n)),localStorage.setItem("is_calculation_tax_".concat(n),e.target.checked),o.setState({isCalculationTax:e.target.checked}),e.target.checked?o.setState({tax:t}):o.setState({tax:0})})),Object(Z.a)(Object(G.a)(o),"handleChangeBankTransfer",(function(e,t){var n=o.state,r=n.payments,a=n.transferMoney;e.target.checked?o.setState({transferMoney:t>=0?a+t:0}):(o.setState({transferMoney:0,chargedByCard:0}),be()(r).map((function(e){return o.onOrderPriceValueChange("payments",jt(jt({},r),{},Object(Z.a)({},e,0)))})))})),Object(Z.a)(Object(G.a)(o),"handleSelectProcessor",(function(e,t){switch(t){case"seller":return o.setState({assigningSellerId:e,openAssigningSeller:!1});case"care":return o.setState({assigningCareId:e,openAssigningCare:!1});default:return o.setState({marketerId:e,openMarketer:!1})}})),Object(Z.a)(Object(G.a)(o),"changeVisibleAssigner",(function(e,t){"seller"==e?t?o.setState({openAssigningSeller:!1}):o.setState({openAssigningSeller:!0}):"care"==e?t?o.setState({openAssigningCare:!1}):o.setState({openAssigningCare:!0}):t?o.setState({openMarketer:!1}):o.setState({openMarketer:!0})})),Object(Z.a)(Object(G.a)(o),"renderSelectAssinger",(function(e,t,n,r){var a=o.state,c=a.openAssigningSeller,d=a.openAssigningCare,u=a.openMarketer,l=o.props,p=l.currentShops,m=l.t,h=l.accessToken,v=l.shopId,f=(l.auth,p.find((function(e){return e.id==v})),function(e){return"seller"==e?c:"care"==e?d:u});return Object(i.jsxs)("div",{className:"list-select-assigner flex-between ".concat("marketer"==r?"last-list-select-assigner":""),onClick:function(e){return e.stopPropagation()},children:[Object(i.jsxs)("div",{className:"text-color-default title-assigner",children:[function(e){return m("seller"==e?"conversation.createOrder.seller":"care"==e?"conversation.createOrder.customerCare":"conversation.createOrder.marketer")}(r),":"]}),t&&n||f(r)?Object(i.jsx)(i.Fragment,{children:t&&n&&!f(r)?Object(i.jsxs)("div",{className:"customize-assigner",onClick:function(){return o.changeVisibleAssigner(r)},children:[Object(i.jsxs)("div",{className:"user-info",children:[n.user.fb_id?Object(i.jsx)(lt.a,{style:{borderRadius:11},width:21,height:21,url:"".concat(Object(Ue.Mb)(),"/v1/users/avatar/").concat(t,"?access_token=").concat(h)}):Object(i.jsx)(s.a,{style:{backgroundColor:"#87d068"},size:21,icon:"user"}),n.user&&Object(i.jsx)("div",{style:{marginLeft:5},className:"font-weight-500 user-name text-ellipsis",children:Object(i.jsx)("span",{children:n.user.name})})]}),Object(i.jsx)("div",{className:"change-processor",children:Object(i.jsx)(N.a,{type:"close-circle",theme:"filled",onClick:function(e){e.stopPropagation(),o.handleSelectProcessor(null,r)}})})]}):Object(i.jsx)(se.a,{showSearch:!0,allowClear:!0,autoFocus:!0,onBlur:function(){return o.changeVisibleAssigner(r,!0)},showAction:["focus","click"],placeholder:m("conversation.createOrder.selectEmployee"),onChange:function(e){return o.handleSelectProcessor(e,r)},dropdownMatchSelectWidth:!1,size:"small",filterOption:function(e,t){return Object(Ue.fb)(e,t.props.label)},getPopupContainer:function(e){return e.parentNode},value:t,className:"select-assigner select-focus",dropdownClassName:"dropdown-select-assigner",children:e})}):Object(i.jsx)("a",{style:{marginLeft:5},className:"no-assigner font-weight-500",onClick:function(){return o.changeVisibleAssigner(r)},children:m("conversation.createOrder.noAssigner")})]})})),Object(Z.a)(Object(G.a)(o),"renderFormatedUsers",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,n=o.props,r=n.currentShops,a=n.shopId,c=n.accessToken,d=n.t,u=o.state.warehouseId,l=r.find((function(e){return e.id==a}));if(l){var p=(l.shop_employee||[]).filter((function(e){return null==e.api_key})),m=[{user_id:"auto",user:{name:d("conversation.createOrder.auto")}}],h=l.auto_assign_order&&!e&&t&&"seller"==t?m.concat(p):p,v=l.warehouses_permissions;if(t&&"marketer"!=t&&v&&v[u]){var f=[];h.map((function(e){var t=(v[u]||[]).find((function(t){return t.employee_id==e.user_id}));(!t||Object(Ue.Ld)(t.role).xem_don_hang)&&f.push(e)})),h=f}return h.map((function(e){return Object(i.jsx)(Pt,{value:e.user_id,label:e.user&&e.user.name,children:Object(i.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(i.jsx)("div",{children:e.user&&e.user.fb_id?Object(i.jsx)(lt.a,{style:{borderRadius:11},width:20,height:20,url:"".concat(Object(Ue.Mb)(),"/v1/users/avatar/").concat(e.user_id,"?access_token=").concat(c)}):Object(i.jsx)(s.a,{style:{backgroundColor:"#87d068"},size:20,icon:"user"})}),Object(i.jsx)("div",{style:{marginLeft:8},className:"text-color-default",children:e.user&&e.user.name})]})},e.user_id)}))}})),Object(Z.a)(Object(G.a)(o),"renderAssignEmployee",(function(e){var t=o.state,n=t.assigningSellerId,r=t.assigningCareId,a=t.marketerId,c=t.recentOrderId,s=o.props,d=s.currentShops,u=s.shopId,l=s.t,p=d.find((function(e){return e.id==u}));if(p){var m=(p.shop_employee||[]).filter((function(e){return null==e.api_key})),h=[{user_id:"auto",user:{name:l("conversation.createOrder.auto")}}],v=p.auto_assign_order?h.concat(m):m,f=v.find((function(e){return e.user_id==n})),_=v.find((function(e){return e.user_id==r})),b=v.find((function(e){return e.user_id==a})),g=e.can_assign_order_to_another||!c,O=e.can_assign_marketers||!c;return Object(i.jsxs)("div",{children:[g&&o.renderSelectAssinger(o.renderFormatedUsers(!1,"seller"),n,f,"seller"),g&&o.renderSelectAssinger(o.renderFormatedUsers(!1,"care"),r,_,"care"),O&&o.renderSelectAssinger(o.renderFormatedUsers(!1,"marketer"),a,b,"marketer")]})}})),Object(Z.a)(Object(G.a)(o),"renderPopoverAssign",(function(){var e=o.props.t,t=o.state.recentOrderId,n=o.getCurrentShop();if(n){var r=n.user_shop&&Object(Ue.bd)(n.user_shop.role);return(!t||(null===r||void 0===r?void 0:r.can_assign_order_to_another)||(null===r||void 0===r?void 0:r.can_assign_marketers))&&Object(i.jsx)("div",{onClick:function(e){return e.stopPropagation()},children:Object(i.jsx)(h.a,{placement:"topRight",title:e("conversation.createOrder.assigningEmployee"),content:o.renderAssignEmployee(r),trigger:"click",overlayClassName:"popover-assign",children:Object(i.jsxs)("a",{className:"font-weight-500 header-text-settings",children:[Object(i.jsx)("span",{className:"label",children:e("conversation.createOrder.assigning")}),Object(i.jsx)("img",{src:Object(Ue.Nb)("users.svg")})]})})})}})),Object(Z.a)(Object(G.a)(o),"renderChangeInsertedAt",(function(e){var t=o.props,n=t.t,r=t.timeZone,c=e.change_order_creation_time,s=o.state,d=s.changeInsertedAt,u=s.insertedAt;return Object(i.jsxs)("div",{className:"flex-between item-other-info",children:[Object(i.jsx)("div",{className:"text-color-default text-nowrap",children:n("conversation.createOrder.createdAt")}),Object(i.jsx)("div",{children:d&&0!=c?Object(i.jsx)(a.a,{className:"ant-calendar-picker-custom",dropdownClassName:"dropdown-ant-calendar-picker-custom",format:"DD/MM/YYYY HH:mm",value:u?Qe()("".concat(Object(Ue.Z)(r||7,u,!1,"DD/MM/YYYY HH:mm")),"DD/MM/YYYY HH:mm"):Qe()(),style:{minWidth:150},getCalendarContainer:function(e){return e.parentNode},onChange:o.onChangeOrderInsertedAt,onOpenChange:function(e){return o.setState({changeInsertedAt:e})},onOk:function(){return o.setState({changeInsertedAt:!1})},open:d,autoFocus:!0,showTime:{format:"HH:mm"},size:"small",okText:n("conversation.createOrder.setDate")}):Object(i.jsx)("span",{className:0!=c?"text-other-info":"",onClick:function(){return o.setState({changeInsertedAt:!0})},children:Object(Ue.Z)(r||7,u||Qe()(),!1,"DD/MM/YYYY HH:mm")})})]})})),Object(Z.a)(Object(G.a)(o),"onChangeOrderInsertedAt",(function(e){if(e){var t=e.startOf("minute").toDate().toISOString();o.setState({insertedAt:t})}else o.setState({insertedAt:null});setTimeout((function(){o.findPromotionAdvanceCanbeActive()}),200)})),Object(Z.a)(Object(G.a)(o),"renderExtraFooter",(function(){var e=o.props.t;return Object(i.jsxs)("div",{children:[Object(i.jsx)("span",{style:{color:"rgb(16, 142, 233)",cursor:"pointer",marginRight:10},onClick:function(){return o.setState({addDate:1},(function(){o.onChangeEstimateDate()}))},children:e("textOnly.statistics.toDays")}),Object(i.jsx)("span",{style:{color:"rgb(16, 142, 233)",cursor:"pointer",marginRight:10},onClick:function(){return o.setState({addDate:2},(function(){o.onChangeEstimateDate()}))},children:e("conversation.createOrder.tomorrow")}),Object(i.jsx)("span",{style:{color:"rgb(16, 142, 233",cursor:"pointer",marginRight:10},onClick:function(){return o.setState({addDate:3},(function(){o.onChangeEstimateDate()}))},children:e("conversation.createOrder.theNext2Days")}),Object(i.jsx)("span",{style:{color:"rgb(16, 142, 233",cursor:"pointer",marginRight:10},onClick:function(){return o.setState({addDate:4},(function(){o.onChangeEstimateDate()}))},children:e("conversation.createOrder.theNext3Days")}),Object(i.jsx)("span",{style:{color:"rgb(16, 142, 233",cursor:"pointer"},onClick:function(){return o.setState({addDate:8},(function(){o.onChangeEstimateDate()}))},children:e("conversation.createOrder.theNext7Days")})]})})),Object(Z.a)(Object(G.a)(o),"renderEstimateDeliveryDate",(function(){var e=o.props,t=e.t,n=e.auth,r=o.state,c=r.estimateDeliveryDate,s=r.changeEstimateDeliveryDate;return Object(i.jsxs)("div",{className:"flex-between item-other-info",children:[Object(i.jsx)("div",{className:"text-color-default text-nowrap",children:t("conversation.createOrder.estimateDeliveryDate")}),s?Object(i.jsx)(a.a,{className:"ant-calendar-picker-custom",dropdownClassName:"dropdown-ant-calendar-picker-custom",value:c?Qe()("".concat(Object(Ue.Z)(n.timezone,c,!1,"DD/MM/YYYY HH:mm")),"DD/MM/YYYY HH:mm"):null,defaultPickerValue:c?Qe()("".concat(Object(Ue.Z)(n.timezone,c,!1,"DD/MM/YYYY HH:mm")),"DD/MM/YYYY HH:mm"):Qe()(),format:"DD/MM/YYYY HH:mm",onChange:o.onChangeEstimateDate,disabledDate:function(e){return e&&e.valueOf()<Qe()().add("-1","day")},showToday:!1,renderExtraFooter:function(){return o.renderExtraFooter()},size:"small",onOpenChange:function(e){return o.setState({changeEstimateDeliveryDate:e})},open:s,getCalendarContainer:function(e){return e.parentNode},style:{minWidth:150},autoFocus:!0,allowClear:!0,showTime:{format:"HH:mm"}}):Object(i.jsx)("span",{className:"text-other-info",onClick:function(){return o.setState({changeEstimateDeliveryDate:!0})},children:c?Object(Ue.Z)(n.timezone,c,!1,"DD/MM/YYYY HH:mm"):t("conversation.createOrder.notAvailable")})]})})),Object(Z.a)(Object(G.a)(o),"onChangeEstimateDate",(function(e){0!=o.state.addDate?o.setState({estimateDeliveryDate:Qe()().add(o.state.addDate-1,"days").startOf("minute").toDate().toISOString(),addDate:0}):e?o.setState({estimateDeliveryDate:e.startOf("minute").toDate().toISOString()}):o.setState({estimateDeliveryDate:null})})),Object(Z.a)(Object(G.a)(o),"totalPayments",(function(){var e=o.state.payments;return e&&"object"==typeof e?fe()(o.state.payments,(function(e,t){return e+t}),0):0})),Object(Z.a)(Object(G.a)(o),"paymentParams",(function(){var e=o.state.payments||{},t=e.charged_by_momo,n=e.charged_by_qrpay,r=e.charged_by_fundiin,a=e.charged_by_kredivo,i=e.charged_by_vnpay,c=Object(Q.a)(e,["charged_by_momo","charged_by_qrpay","charged_by_fundiin","charged_by_kredivo","charged_by_vnpay"]),s={};return s.charged_by_momo=t||0,s.charged_by_qrpay=n||0,s.charged_by_fundiin=r||0,s.charged_by_kredivo=a||0,s.charged_by_vnpay=i||0,s.bank_payments=c||null,s})),Object(Z.a)(Object(G.a)(o),"handleSetTag",(function(e,t){o.setState({tags:e},(function(){t&&o.editStatus(t,null,null,o.state.tags)}))})),Object(Z.a)(Object(G.a)(o),"handleCheckBoxAutoSaveQuickProduct",(function(e){o.setState({isSaveQuickProduct:e}),localStorage.setItem("isSaveQuickProduct",e)})),Object(Z.a)(Object(G.a)(o),"renderShortcutAddProduct",(function(){var e,t=o.props.auth,n=null!==t&&void 0!==t&&null!==(e=t.settings)&&void 0!==e&&e.isMac?"Ctrl":"Alt";return Object(i.jsx)(E.a,{color:"geekblue",className:"tag-shortcut__hint shortcut-quickly-product",children:Object(i.jsx)("span",{className:"keyboard-button",children:"".concat(n,"+A")},"".concat(n,"+A"))})})),Object(Z.a)(Object(G.a)(o),"showOrderDuplicated",(function(e){var t=o.props.shopId,n=Object(Ue.Mb)(!0).replace("/api","");return window.open("".concat(n,"/shop/").concat(t,"/order?order_id=").concat(o.state[e]))})),Object(Z.a)(Object(G.a)(o),"renderMoreInfoCustomerBtn",(function(){var e;return Object(i.jsx)("div",{className:"flex-center",children:Object(i.jsxs)("a",{className:"header-text-settings font-weight-500",children:["facebook"==(null===(e=o.props.pages)||void 0===e?void 0:e.currentPlatform)&&"INBOX"==o.props.conversations.selectedType&&Object(i.jsx)(f.a,{className:"label customer-btn",type:"primary",ghost:!0,disabled:o.state.isSendingAdress,onClick:function(){return o.sendCustomerAddressRequest()},children:o.props.t("order.address")}),Object(i.jsx)(f.a,{className:"label customer-btn",type:"primary",ghost:!0,onClick:function(e){e.stopPropagation(),o.setState({moreInfoCustomer:!0,tab:1})},children:o.props.t("conversation.moreInfo")})]})})})),Object(Z.a)(Object(G.a)(o),"renderProductSearch",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=o.props,r=n.pageWarehouses,a=n.accessToken,c=n.shopId,s=n.pageId,d=n.t,u=o.state,l=u.warehouseId,p=u.currency,m=u.comboBy,h=u.activatedComboProducts,v=u.activatedPromotionAdvance,_=u.activatedPromotionProducts,b=u.editProductKey,g=o.getCurrentShop(),O=(null===h||void 0===h?void 0:h.length)>0||(null===v||void 0===v?void 0:v.length)>0||(null===_||void 0===_?void 0:_.length)>0,j=(null===e||void 0===e?void 0:e.actualVariationInfo)||null,y=t?"ActualVariation":"";return Object(i.jsxs)("div",{className:"div-search ".concat(O?"div-search-custom":""),style:{marginTop:10},children:[Object(i.jsx)("div",{className:"select-search",children:Object(i.jsx)("div",{children:Object(i.jsx)(Ze.a,{disabled:!!j,showCombo:!t,t:d,comboBy:t?"variation":m,currency:p||g.currency||"VND",searchResult:o.state["searchResult".concat(y)]||[],accessToken:a,shopId:c,pageId:s,warehouseId:l,callback:o.handleCallback(y),pushVariations:function(e){var t=Te()(o.state["searchResult".concat(y)])||[];t=t.concat(e),o.setState(Object(Z.a)({},"searchResult".concat(y),t))},onSelect:t?function(t){return o.handleSelectActualItem(e,t)}:function(e){return o.handleSelectItem(e,1)},onDeSelect:function(e){return!t&&o.handleDeSelectItem(e)||{}},onSelectCombo:o.handleSelectCombo,pageWarehouses:r,currentShop:g,cart:o.state.cart,clearSearchResult:function(){return o.setState(Object(Z.a)({},"searchResult".concat(y),[]))},isBlocked:!0,refFunc:o.createOrderSearch,dropdownClassCustom:t&&"dropdown-search-actual-variation-".concat(b),isActualVariation:t})})}),!t&&Object(i.jsx)(f.a,{className:"btn-add-fast-product btn-focus",type:"primary",icon:"plus",onClick:o.onAddProductToCart})]})})),Object(Z.a)(Object(G.a)(o),"recordAlert",(function(){var e=o.state,t=e.duplicatedPhoneDate,n=e.duplicatedCustomerDate,r=e.retunedPhoneDate;return[{key:"duplicatedCustomer",displayId:e.duplicateDisplayId,date:n,visible:"visibleCustomer",icon:"solution",label:"customerHasOrderCreateOn",show:"duplicateOrderId"},{key:"duplicatedPhone",displayId:e.duplicateDisplayIdPhone,date:t,visible:"visiblePhone",icon:"phone",label:"phoneNumberHasOrderCreateOn",show:"duplicateOrderIdPhone"},{key:"returnedPhone",displayId:e.returnedDisplayIdPhone,date:r,visible:"visibleReturnedPhone",icon:"phone",label:"phoneNumberHasOrderReturned",show:"duplicateOrderIdPhone"}]})),Object(Z.a)(Object(G.a)(o),"renderAlert",(function(e){if(o.state[e]){var t=o.props,n=t.t,r=t.timeZone,a=o.state,c=a.customId,s=a.displayId,d=o.recordAlert().find((function(t){return t.key==e}));if(d.displayId!=(c||s))return Object(i.jsx)(p.a,{message:Object(i.jsx)("div",{className:"message-alert text-color-default",children:d.date?Object(i.jsxs)("span",{children:[n("conversation.createOrder.".concat(d.label)),"\xa0",Object(i.jsxs)("a",{onClick:function(){return o.showOrderDuplicated(d.show)},className:"font-weight-500",style:{color:"#2D65C3"},children:["#",d.displayId]}),"\xa0","".concat(n("conversation.createOrder.duplicateCreateOn")," ").concat(Object(Ue.Y)(d.date,r,!1,"HH:mm DD/MM/YYYY"))]}):n("conversation.createOrder.".concat("duplicatedCustomer"!=d.key?"phoneNumberHasOrderCreate":"customerHasOrderCreate"))}),type:"warning",closable:!0,banner:!0,showIcon:!0,afterClose:function(){return o.setState(Object(Z.a)({},d.visible,!1))},icon:Object(i.jsx)(N.a,{type:"warning",theme:"filled",className:"icon-warning icon"}),className:"item-alert flex-align-items border-radius-default"})}})),Object(Z.a)(Object(G.a)(o),"handleOpenOtherCustomerInfo",(function(){o.setState({isBriefCustomerInfo:!o.state.isBriefCustomerInfo})})),Object(Z.a)(Object(G.a)(o),"renderCustomerInfmation",(function(){var e=o.props,t=e.t,n=e.accessToken,r=e.pageId,a=e.currentPage,c=e.timeZone,s=o.state,d=s.selectedCustomer,u=s.tab,l=s.customerName,m=s.orderCustomerName,h=s.orderByPhone,v=s.currency,f=s.recentOrderId,_=s.statusOrder,b=s.isRewardPoint,g=s.isBriefCustomerInfo,O=o.checkCountryCode("65"),j=o.getCurrentShop(),y=null===j||void 0===j?void 0:j.seeding_phonenumbers.includes(Object(Ue.Yc)(o.state.selectedPhone)),P=1==u?l:m,C=1==u,x=null!=h?null!=h.purchased_amount?h.purchased_amount:0:null,S=null==h?null:null==h.last_order_at?"":Object(Ue.zd)(h.last_order_at,c),A=t("conversation.createOrder.notAvailable");return S&&(A=Object(Ue.Gc)(S)),Object(i.jsxs)("div",{className:"profile-customer box-order",children:[Object(i.jsxs)("div",{className:"box-header box-order-header",children:[Object(i.jsxs)("div",{className:"flex-align-items",children:[Object(i.jsx)("img",{className:"img-user-list",src:Object(Ue.Nb)("user_list.svg")}),Object(i.jsx)("span",{className:"font-weight-500 text-color-default",children:t("textOnly.statistics.customer")})]}),o.renderMoreInfoCustomerBtn()]}),!(o.state.hiddenBoxOrder||{})["customer-info"]&&Object(i.jsxs)("div",{className:"box-order-content",children:[Object(i.jsxs)("div",{className:"card-customer-basic-info card-content card-content-first",children:[o.renderInputCusNamePhoneNumber(),o.renderSelectAddess(),o.renderSelectCountry(O),!O&&o.renderSelectDistrictCommune(O)]}),Object(i.jsxs)("div",{className:"card-alert card-content",children:[y&&C&&Object(i.jsx)(p.a,{message:Object(i.jsx)("div",{className:"message-alert text-color-default",children:t("conversation.createOrder.seedingPhoneNumber")}),type:"warning",showIcon:!0,icon:Object(i.jsx)(N.a,{type:"warning",theme:"filled",className:"icon-warning icon"}),className:"item-alert flex-align-items border-radius-default"}),o.renderAlert("duplicatedCustomer"),o.renderAlert("duplicatedPhone"),o.renderAlert("returnedPhone")]}),Object(i.jsxs)("div",{className:"card-content card-other-customer-info border-radius-default",children:[Object(i.jsxs)("div",{className:"card-customer-details-header flex-between",onClick:function(){return o.handleOpenOtherCustomerInfo()},children:[Object(i.jsxs)("div",{className:"item-avatar-customer flex-align-items",children:[Object(i.jsx)(lt.a,{style:{borderRadius:11,marginRight:8},width:20,height:20,name:P,id:d.fb_id,url:Object(Ue.nd)(d,r,null===a||void 0===a?void 0:a.platform,n)}),g?Object(i.jsxs)("div",{className:"ul-brief-information flex-align-items",children:[Object(i.jsxs)("div",{className:"li-brief-info text-ellipsis",children:[Object(i.jsx)("img",{className:"img",src:Object(Ue.Nb)("Checks.svg")}),Object(i.jsx)("span",{className:"font-weight-500 text-color-default",children:d.succeed_order_count||0})]}),Object(i.jsxs)("div",{className:"li-brief-info text-ellipsis",children:[Object(i.jsx)(N.a,{type:"gift",className:"img"}),Object(i.jsx)("span",{className:"font-weight-500 text-color-default",children:parseInt(d.reward_point||0)})]}),Object(i.jsxs)("div",{className:"li-brief-info last-item text-ellipsis",children:[Object(i.jsx)("img",{className:"img",src:Object(Ue.Nb)("money.svg")}),Object(i.jsx)("span",{className:"font-weight-500 text-color-default",children:Object(Ue.X)(x,j?j.currency:v,!0)})]})]}):Object(i.jsx)("span",{className:"name-customer",children:P})]}),Object(i.jsx)("div",{children:Object(i.jsx)(N.a,{type:g?"up":"down",className:"icon icon-down"})})]}),!g&&Object(i.jsxs)("div",{className:"card-customer-details-content",children:[Object(i.jsxs)("div",{className:"item-other-customer flex-between text-color-default",children:[Object(i.jsxs)("span",{className:"flex-align-items text-title",children:[Object(i.jsx)("img",{className:"img",src:Object(Ue.Nb)("money.svg")}),Object(i.jsx)("span",{className:"text-color-default",children:t("conversation.createOrder.totalSpending")})]}),Object(i.jsx)("span",{className:"font-weight-500 text-info",children:Object(Ue.X)(x,j?j.currency:v,!0)})]}),Object(i.jsxs)("div",{className:"item-other-customer flex-between text-color-default",children:[Object(i.jsxs)("span",{className:"flex-align-items text-title",children:[Object(i.jsx)("img",{className:"img",src:Object(Ue.Nb)("Checks.svg")}),Object(i.jsx)("span",{className:"text-color-default",children:t("conversation.createOrder.orderSuccess")})]}),Object(i.jsx)("span",{className:"font-weight-500 text-info",children:t("conversation.createOrder.numberOrder",{data:d.succeed_order_count||0})})]}),Object(i.jsxs)("div",{className:"item-other-customer flex-between text-color-default",children:[Object(i.jsxs)("span",{className:"flex-align-items text-title",children:[Object(i.jsx)(N.a,{type:"gift",className:"img"}),Object(i.jsx)("span",{className:"text-color-default",children:t("conversation.createOrder.prepaidByPoint")})]}),Object(i.jsx)("span",{className:"font-weight-500 text-info",children:t("conversation.createOrder.bonusPoints",{data:parseInt(d.reward_point||0)})})]}),Object(i.jsxs)("div",{className:"item-other-customer flex-between last-item text-color-default",children:[Object(i.jsxs)("span",{className:"flex-align-items text-title",children:[Object(i.jsx)("img",{className:"img",src:Object(Ue.Nb)("ClockCounterClockwise.svg")}),Object(i.jsxs)("span",{className:"text-color-default",children:[t("conversation.createOrder.recentCreationTime")," "]})]}),Object(i.jsx)("span",{className:"font-weight-500 text-info",children:A})]})]}),(!f||Object(Ue.v)(_,2,-1))&&!g&&Object(i.jsx)("div",{className:"card-other-customer-info-footer",children:Object(i.jsx)(I.a,{className:"check-reward-point",checked:null==b||b,onChange:function(e){return o.setState({isRewardPoint:e.target.checked})},children:t("conversation.createOrder.rewardPointForOrder")})})]})]})]})})),Object(Z.a)(Object(G.a)(o),"handleFirstBuyer",(function(){var e=o.state.recentOrderId,t=o.props.recentOrders;return e?1==(null===t||void 0===t?void 0:t.length):!(null!==t&&void 0!==t&&t.length)})),Object(Z.a)(Object(G.a)(o),"getReferralCode",(function(){var e,t=o.getCurrentShop();if(!t)return!1;var n=o.state,r=n.customerReferralCode,a=n.statusOrder,i=null===(e=t.referral_code_discount)||void 0===e?void 0:e.active,c=o.handleFirstBuyer();return Object(Ue.v)(a,2,-1)&&i&&(c||r)})),Object(Z.a)(Object(G.a)(o),"renderOrderProducts",(function(){var e=o.props,t=e.t,n=e.shopId,r=e.currentShops,a=o.state,c=a.tab,s=a.cart,d=a.totalWeight,u=a.statusOrder,l=a.isSaveQuickProduct,p=a.visibleModalBonusItems,m=a.selectedPromotionAdvance,v=a.selectBonusItem,f=a.promotionAdvanceCanbeActive,_=a.promotionProductsCanBeActive,b=a.comboProductsCanBeActive,g=a.hasPromotionByCouponId,O=a.disabledComboProduct,j=a.disabledComboVariation,y=a.disabledComboCategory,P=r.find((function(e){return e.id==n}));if(P){var C=1==c,x=s.find((function(e){return e.isBonusProduct})),S=s.find((function(e){return e.oneTime&&!e.id})),A=s.reduce((function(e,t){return t.productName?e+t.weight*t.quantity:e}),0);(A=Math.round(A))!==d&&o.handleCalculateTotalWeight(A);var w=(null===f||void 0===f?void 0:f.length)>0||(null===_||void 0===_?void 0:_.length)>0||(null===b||void 0===b?void 0:b.length)>0||g||!O||!j||!y||o.getReferralCode(),k=s.length>0||S;return Object(i.jsxs)("div",{className:"custom-order-products box-order",children:[o.renderHeaderOrderProducts(),!(o.state.hiddenBoxOrder||{})["order-products"]&&Object(i.jsxs)("div",{className:"content-order-products ".concat(k?"show-border-bottom":""),children:[o.renderTableProductTitle(),w&&Object(i.jsx)("div",{className:"popover-add-voucher",children:Object(i.jsx)(h.a,{content:o.renderComboAndPromotion(),title:Object(i.jsx)("span",{className:"text-color-default",children:t("conversation.createOrder.comboAndPromotion")}),placement:"left",overlayClassName:"combo-and-promotion-custom",children:Object(i.jsxs)("a",{className:"voucher",children:[Object(i.jsx)(N.a,{type:"gift",className:"icon-voucher"}),Object(i.jsx)("span",{className:"font-weight-500",children:t("conversation.createOrder.addVoucher")})]})})}),x&&Object(i.jsx)("div",{className:"bonus-items",children:o.renderTableProduct(!0)}),o.renderActivedComboAndPromotion(),(C||Object(Ue.v)(u,2,-1))&&o.renderProductSearch()]}),!(o.state.hiddenBoxOrder||{})["order-products"]&&k&&Object(i.jsxs)("div",{className:"footer-order-products",children:[s.length>0&&Object(i.jsxs)("div",{className:"flex-between text-color-default total-weight",children:[Object(i.jsx)("span",{children:t("conversation.createOrder.totalWeight")}),Object(i.jsx)("span",{className:"font-weight-500",children:P.config_weight_product?"".concat(d/1e3," kg"):"".concat(d," g")})]}),S&&Object(i.jsx)(I.a,{checked:l,onChange:function(e){return o.handleCheckBoxAutoSaveQuickProduct(e.target.checked)},className:"check-box-auto-save-quick-product",children:t("conversation.createOrder.autoSaveQuickProduct")})]}),p&&Object(i.jsx)(pt.a,{visibleModalBonusItems:p,selectedPromotionAdvance:m,onCancel:function(){return o.setState({visibleModalBonusItems:!1})},handleSelectBonusItems:function(e){return o.handleSelectBonusItems(e)},selectBonusItem:v})]})}})),Object(Z.a)(Object(G.a)(o),"renderOrderPayment",(function(){var e,t,n,r=o.props,a=r.t,c=r.shopId,s=r.currentShops,d=o.state,u=d.tab,l=(d.cash,d.cart),p=d.currency,m=d.isFreeShip,v=d.shippingFee,f=d.isCalculationTax,_=d.discountAmount,b=d.paymentMethods,g=s.find((function(e){return e.id==c}));if(g){var O=1==u,j=_+C+x+I,y=o.calcDiscountByCustomerLevel(j),P=l.reduce((function(e,t){return t.productName?t.oneTime?e+(t.oneTimePrice-o.calcDiscountByDiscountEachProduct(t)):e+(t.retailPrice*t.quantity+(t.additionPrice||0)-o.calcDiscountByDiscountEachProduct(t)):e}),0),C=o.calcDiscountByComboProducts(),x=o.calcDiscountByPromotionProduct()+o.calcDiscountByPromotionProduct2()+o.calcDiscountByPromotionAdvance(),I=o.calcDiscountByReferralCode(),S=_+C+x+y+I,A=f&&g&&g.invoice_tax>0?g.invoice_tax*(P-S)/100:0,w=o.calcFinalPrice(),k=g&&(!(null!==(e=g.service_charge_currency)&&void 0!==e&&e.length)||(g.service_charge_currency||[]).includes(p)),B=1e5*Math.ceil(w*((o.state.isEditOrder?o.state.codServiceCharge:k?null===g||void 0===g?void 0:g.cod_service_charge:0)||0)/1e7);B=B>0&&B<5e5?k?5e5:0:B;var T=o.checkDisabledOrderDiscount(),q=P+A-S+B<0?0:P+A-S+B,E=o.calcLeveraPoint(q),M="warning",W="#D4B106",R=a("conversation.createOrder.processing"),F=o.state.paymentHistory||{};return F.ipn_reply&&F.ipn_reply&&("vnpay"==F.type&&"00"!=F.result_code||["momo","techcombank"].includes(F.type)&&"0"!=F.result_code||"kredivo"==F.type&&["deny","cancel","expire"].includes(F.result_code)||"fundiin"==F.type&&["6"].includes(F.result_code))&&(M="close-circle",W="#EB5757",R=a("failedText")),F.ipn_reply&&(F.payment_success||["0","00","3","settlement"].includes(F.result_code))&&(M="check-circle",W="#008000",R=a("successText")),"warning"==M&&"fundiin"==F.type&&(R=F.tags&&F.tags[0]),Object(i.jsxs)("div",{className:"box-order box-order-payment",id:o.idOrderItems,children:[Object(i.jsxs)("div",{className:"box-header header-order-payment flex-between",children:[Object(i.jsxs)("div",{className:"flex-align-items",children:[Object(i.jsx)("img",{src:Object(Ue.Nb)("wallet.svg"),className:"img img-wallet"}),Object(i.jsx)("span",{className:"text-color-defalt font-weight-500",children:a("conversation.transferConfirm.payment")})]}),Object(i.jsxs)("div",{onClick:function(e){return e.stopPropagation()},children:[Object(i.jsxs)("a",{className:"font-weight-500 header-text-settings",onClick:function(){O&&o.setState({paymentMethods:o.getPaymentMethods(null,b)}),o.modalVisiblePaymentInfo()},children:[Object(i.jsx)("span",{className:"label",children:a("conversation.createOrder.morePaymentMethods")}),Object(i.jsx)(N.a,{type:"right"})]}),o.state.modalVisible&&Object(i.jsx)(ie.a,{style:{left:"35%"},width:"calc(100vw - 72%)",title:a("conversation.createOrder.paymentInfo"),visible:o.state.modalVisible,onCancel:function(){return o.setState({modalVisible:!1})},footer:null,className:"modal-payment-info",children:o.renderPaymentInfo(O?w:w-E,O?0:E,S)})]})]}),!(o.state.hiddenBoxOrder||{})["order-payment"]&&Object(i.jsxs)("div",{className:"content-order-payment",children:[Object(i.jsxs)("div",{className:"flex-between row-content-payment",children:[Object(i.jsx)("span",{className:"text-color-default",children:a("conversation.createOrder.orderTotalPrice")}),Object(i.jsx)("span",{className:"font-weight-500 text-color-default",children:Object(Ue.X)(P,p,!0)})]}),Object(i.jsxs)("div",{className:"flex-between row-content-payment",children:[Object(i.jsx)("span",{className:"text-color-default",children:a("conversation.createOrder.shippingFee")}),Object(i.jsx)(D.a,{title:o.renderTitleFreeShip(),children:Object(i.jsx)(ut.a,{id:"shippingFee",currency:p,disabled:!(O||null===(t=g.settings)||void 0===t||!t.block_edit_shipping_fee)&&(null===(n=g.settings)||void 0===n?void 0:n.block_edit_shipping_fee),isMoney:!0,value:m?0:v,callBack:function(e){return o.onOrderPriceValueChange("shipping",e)},suffix:Object(Ue.yb)(p),className:"text-color-default",boxClassName:"box-input-number-wrapper-custom background-default"})})]}),Object(i.jsxs)("div",{className:"flex-between row-content-payment",children:[Object(i.jsx)("span",{className:"text-color-default",children:a("conversation.createOrder.discountAmount")}),Object(i.jsx)(h.a,{trigger:"click",placement:"left",content:o.renderPopoverDiscountAmount(P),children:Object(i.jsx)("div",{children:Object(i.jsx)(ut.a,{id:"discountAmount",currency:p,isMoney:!0,value:_,callBack:function(e){return o.onOrderPriceValueChange("discount",e,P)},suffix:Object(Ue.yb)(p),disabled:T,className:"text-color-default",boxClassName:"box-input-number-wrapper-custom background-default"})})})]}),Object(i.jsxs)("div",{className:"order-payment-footer",children:[o.state.paymentHistory&&Object(i.jsxs)("div",{className:"order-payment-history flex-between font-weight-500",style:{color:W},children:[Object(i.jsxs)("div",{children:[Object(i.jsx)("span",{children:"".concat(Object(Ue.Xc)(F.type)," - ").concat(R)}),Object(i.jsx)(N.a,{type:M,style:{color:W},className:"icon-payment"})]}),"check-circle"==M&&Object(i.jsx)("div",{children:Object(Ue.X)(F.amount,p,!0)}),"close-circle"==M&&Object(i.jsxs)("div",{children:[a("conversation.createOrder.tryAgain")," ",Object(i.jsx)(N.a,{type:"arrow-up",style:{color:W}})]})]}),Object(i.jsxs)("div",{className:"note-other-info",children:[o.renderQuickNote("noteOrder"),o.renderQuickNote("notePrintOrder")]})]})]})]})}})),Object(Z.a)(Object(G.a)(o),"renderOtherInfo",(function(){var e=o.props,t=e.t,n=e.shopId,r=e.currentShops,a=o.state,c=a.orderTags,s=a.orderTagGroups,d=a.tags,u=a.type,l=a.statusOrder,p=r.find((function(e){return e.id==n}));if(p){var m=Object(Ue.a)();return Object(i.jsxs)("div",{className:"box-order box-other-info",children:[Object(i.jsxs)("div",{className:"box-header header-other-info flex-between",children:[Object(i.jsxs)("div",{className:"flex-align-items",children:[Object(i.jsx)("img",{src:Object(Ue.Nb)("listDashes.svg"),className:"img"}),Object(i.jsx)("span",{className:"text-color-defalt font-weight-500",children:t("conversation.createOrder.otherInformationOrder")})]}),o.renderPopoverAssign()]}),!(o.state.hiddenBoxOrder||{})["other-info"]&&Object(i.jsxs)("div",{className:"content-other-info",children:[o.renderChangeInsertedAt(p),o.renderEstimateDeliveryDate(1),Object(i.jsxs)("div",{className:"flex-between item-other-info",children:[Object(i.jsx)("span",{className:"text-color-default text-nowrap title-order-source",children:t("conversation.createOrder.orderSource")}),o.renderOrderSources(p)]}),Object(i.jsxs)("div",{className:"list-order-tags",children:[d.map((function(e){var t=m[e];return t||(t=c.find((function(t){return t.id==e})))&&(t={text:t.name,color:"#00707f",allowRemove:!1,processing:!0}),t?(t=jt(jt({},t),{},{allowRemove:!1,classNameDot:"custom-ant-badge-status-dot"}),Object(i.jsx)(E.a,{closable:!0,onClose:function(){return o.handleRemoveTag(e)},className:"order-tag background-default",children:Object(i.jsx)(ot.a,jt({},t))},e)):null})),Object(i.jsx)("div",{style:{display:"inline-flex"},children:Object(i.jsx)(gt.a,{tags:d,shopId:n,status:l,shopType:u,handleAddTag:o.handleAddTag,orderTagGroups:s,orderTags:c,type:"order_detail",placement:"topLeft"})})]})]})]})}})),Object(Z.a)(Object(G.a)(o),"renderViewOrder",(function(){return Object(i.jsxs)("div",{className:"view-order",children:[o.renderCustomerInfmation(),o.renderOrderProducts(),o.renderOrderPayment(),o.renderOtherInfo()]})})),Object(Z.a)(Object(G.a)(o),"calcFinalPrice",(function(){var e=o.state,t=e.cart,n=e.isFreeShip,r=e.returnFree,a=e.shippingFee,i=e.surcharge,c=e.discountAmount,s=e.isCalculationTax,d=e.transferMoney,u=e.chargedByCard,l=e.cash,p=e.prepaidMoney,m=e.payment_from_customers_exchange_order,h=e.referralAmountDiscount,v=o.getCurrentShop(),f=o.calcDiscountByComboProducts(),_=o.calcDiscountByPromotionProduct()+o.calcDiscountByPromotionProduct2()+o.calcDiscountByPromotionAdvance(),b=o.calcDiscountByReferralCode(),g=c+f+_+b,O=o.calcDiscountByCustomerLevel(g),j=t.reduce((function(e,t){return t.productName?t.oneTime?e+(t.oneTimePrice-o.calcDiscountByDiscountEachProduct(t)):e+(t.retailPrice*t.quantity+(t.additionPrice||0)-o.calcDiscountByDiscountEachProduct(t)):e}),0),y=c+f+_+O+b;return j+(n||r?0:a)+i+(s&&v&&v.invoice_tax>0?v.invoice_tax*(j-y)/100:0)-y-(d+u+o.totalPayments()+l+p+m+(h||0))})),Object(Z.a)(Object(G.a)(o),"renderFooter",(function(){var e,t=o.props,n=t.t,r=t.shopId,a=t.currentShops,c=t.auth,s=t.recentOrders,d=o.state,u=d.tab,l=d.statusOrder,p=d.currency,m=d.savingOrder,v=(d.cart,d.discountAmount),_=d.transferMoney,b=d.chargedByCard,g=d.cash,O=d.recentOrderId;o.cacheDbAddress||(o.cacheDbAddress=Object(ft.a)());var j=a.find((function(e){return e.id==r})),y=v+o.calcDiscountByComboProducts()+(o.calcDiscountByPromotionProduct()+o.calcDiscountByPromotionProduct2()+o.calcDiscountByPromotionAdvance())+o.calcDiscountByReferralCode(),P=o.calcDiscountByCustomerLevel(y),C=o.calcFinalPrice(),x=g+_+b+o.totalPayments(),S=1==u,A=!(!o.state.orderIdViewing||!s)&&(-1!=s.findIndex((function(e){return e.id==o.state.orderIdViewing}))&&s.find((function(e){return e.id==o.state.orderIdViewing})).viewing);A=!!o.isLegalToUseRecentOrder()&&A;var w=Object(Ue.K)(c.fbId,!!j&&j.show_employee_viewing_orders,A,!0),k=j&&(!(null!==(e=j.service_charge_currency)&&void 0!==e&&e.length)||(j.service_charge_currency||[]).includes(p)),D=1e5*Math.ceil(C*((o.state.isEditOrder?o.state.codServiceCharge:k?null===j||void 0===j?void 0:j.cod_service_charge:0)||0)/1e7);D=D>0&&D<5e5?k?5e5:0:D;var B=ue()((null===j||void 0===j?void 0:j.country_code)||[],["62","66","65"]).length>0;return Object(i.jsxs)("div",{className:"box-footer",children:[Object(i.jsxs)("div",{className:"flex-between footer-total-price",children:[B?Object(i.jsx)(I.a,{checked:C<=0&&x>0,onChange:function(e){return o.handleChangeBankTransfer(e,C)},className:"check-bank-transfer",children:Object(i.jsx)("span",{className:"text-color-default",children:n("conversation.createOrder.bankTransfer")})}):Object(i.jsx)("span",{className:"text-color-default",children:n("conversation.createOrder.finalPrice")}),Object(i.jsx)(h.a,{trigger:"click",placement:"topRight",rootClose:!0,content:o.renderTotalDiscount(P),overlayClassName:"popover-box-order-custom",children:Object(i.jsx)("span",{className:"text-color-default text-final-price",style:{color:"".concat(C>0?"green":"red")},children:Object(Ue.X)(C+D,p,!0)})})]}),Object(i.jsxs)("div",{className:"flex-align-items",children:[S&&Object(i.jsx)(f.a,{className:"btn-clear-order btn-footer-order btn-focus-custom font-weight-500",onClick:o.clearOrderInfo,children:n("conversation.createOrder.clearOrder")}),Object(i.jsx)(f.a,{className:"btn-save-order btn-footer-order font-weight-500 btn-focus",disabled:m||6==l||!S&&w,onClick:function(){return S?o.onOrderSubmit("create"):o.checkedSyncPartner()},style:{width:S?"50%":"100%"},children:m?Object(i.jsx)("div",{className:"spinner-inverse",style:{position:"relative"}}):n(O?"conversation.createOrder.save":"createOrder")})]}),o.state.visibleConfirmSync&&Object(i.jsxs)(ie.a,{title:n("conversation.createOrder.remind"),bodyStyle:{padding:20},visible:o.state.visibleConfirmSync,onCancel:function(){return o.setState({visibleConfirmSync:!1})},onOk:function(){return o.onOrderSubmit("edit")},closable:!1,children:[Object(i.jsx)(N.a,{style:{color:"#ffa940",marginRight:5},type:"exclamation-circle"}),n("conversation.createOrder.syncOrder")]})]})}));var c=e.currentShops.find((function(t){return t.id==e.shopId}));e.fbId;return o.state={savingOrder:!1,changeStatusConfirm:!1,changeStatusCancel:!1,tab:0,displayId:null,customId:null,isEmptyCart:!1,editingOrderId:null,noteOrder:It(""),notePrintOrder:It(""),noteImages:[],orderCustomerName:"",countries:[],countryId:"",provinceId:"",provinceName:"",provinces:[],districtId:"",districtName:"",districts:[],communeId:"",communeName:"",communes:[],postcode:"",postcodes:[],warehouseId:null,shippingFee:0,discountAmount:0,orderDiscountPercent:0,transferMoney:0,chargedByCard:0,cash:0,payment_from_customers_exchange_order:0,prepaid:0,prepaidPoint:0,prepaidMoney:0,surcharge:0,selectedPhone:"",selectedEmail:"",selectedAddress:"",services:[],serviceName:"",serviceNameVi:"",isReceiverPay:!1,isAllowTryOut:!1,isAllowCheckingGood:!1,isUsingCod:!0,codCost:0,shippingCost:0,totalWeight:0,totalPrice:0,isSnappyIntergration:!1,cart:[],bookingTotalChildren:0,bookingTotalAdults:0,activatedComboProducts:[],comboProductsCanBeActive:[],promotionProductsCanBeActive:[],activatedPromotionProducts:[],showAlert:!1,dataSweetAlert:{},businessId:"",orderTags:[],orderTagGroups:[],tags:[],tagOpenKeys:[],tablePlan:[],tableModalVisible:!1,tableIds:[],fbLink:null,partner:{},statusOrder:0,disabled:!1,searchResult:[],cartFast:[],orderByPhone:null,isLoadingCheckedPhone:!1,duplicatedPhone:!1,duplicatedCustomer:!1,visiblePhone:!1,visibleReturnedPhone:!1,visibleCustomer:!1,modalVisible:!1,seconds:"00",minutes:c&&c.show_employee_viewing_orders?c.show_employee_viewing_orders.time_range:1,orderIdViewing:null,comboBy:"variation",partnerId:void 0,cod:0,totalFee:0,disabledComboVariation:!0,disabledComboProduct:!0,disabledComboCategory:!0,levelCustomer:null,isAddBonusProduct:!1,isUseWholeSale:!1,isChangeFreeShip:!1,searchNote:"",quickNoteFor:1,selectedPostId:"",isEditOrder:!1,suggestions:[],addressSource:null,isCustomerLevel:!1,comboIdSelected:null,saveWarehouses:!localStorage["is_save_warehouses_".concat(e.pageId)]||"true"==localStorage.getItem("is_save_warehouses_".concat(e.pageId)),disableShipOrder:!1,oldCart:[],oldWarehouse:"",changeInfoPartner:!1,visibleConfirmSync:!1,returnFree:!!localStorage["is_return_free_".concat(e.pageId)]&&"true"==localStorage.getItem("is_return_free_".concat(e.pageId)),duplicatedCustomerDate:null,duplicatedPhoneDate:null,duplicateDisplayId:null,duplicateDisplayIdPhone:null,customPartnerFee:0,isCalculationTax:!1,assigningSellerId:null,assigningCareId:null,marketerId:null,insertedAt:null,changeInsertedAt:!1,isFreeShip:!!localStorage["is_free_shipping_".concat(e.pageId)]&&"true"==localStorage.getItem("is_free_shipping_".concat(e.pageId)),customerLevels:[],getCustomerLevel:!0,maxPrepaidByPoint:0,selectedCustomer:!!(e.conversations&&e.conversations.selectedCustomers&&e.conversations.selectedCustomers.length>0)&&e.conversations.selectedCustomers[0],openAssigningSeller:!1,openAssigningCare:!1,openMarketer:!1,promotion_advances:[],promotionAdvanceCanbeActive:[],activatedPromotionAdvance:[],fetchWarehousesPermissions:!0,userWarehousesPermissions:[],visibleModalBonusItems:!1,selectedPromotionAdvance:null,onActiveCombos:null,onActivePromotions:null,payments:{},isChangeTags:!1,isChangeShippingFee:!1,orderSources:null,account:null,couponValue:"",hasPromotionByCouponId:c&&c.has_promotion_by_coupon_id,estimateDeliveryDate:null,addDate:0,changeEstimateDeliveryDate:!1,warehouses_permissions:{},categories:[],isFetchCategories:!0,isSaveQuickProduct:!1,noDiscountWholesale:!1,leveraPoint:0,transferProofs:[],activeKeyPayment:"1",createProof:!1,fileList:[],proofImages:[],paymentMethods:[],listPromotionDeactive:[],moreInfoCustomer:!1,duplicateOrderId:null,duplicateOrderIdPhone:null,isBriefCustomerInfo:!0,editProductKey:null,isSendingAdress:!1,referralAmountDiscount:0,showReferralAmount:!1,maxReferralAmount:0},o.dataAddressSource=Le()(400,o.dataAddressSource.bind(Object(G.a)(o))),o.status=0,o.handleGetCost=Le()(500,o.handleGetCost.bind(Object(G.a)(o))),o.handleCalculateTotalWeight=Le()(300,o.handleCalculateTotalWeight.bind(Object(G.a)(o))),o.onPhoneSelected=Le()(200,o.onPhoneSelected),o.onCustomerDuplicated=Le()(200,o.onCustomerDuplicated),o.genLevelCustomer=Le()(200,o.genLevelCustomer),o.handleChangeCouponId=Le()(400,o.handleChangeCouponId),o.updateImageQuickProduct=Le()(200,o.updateImageQuickProduct),o.handleChangeReferralCode=Le()(400,o.handleChangeReferralCode),o.secondsRemaining,o.intervalHandle,o.startCountDown=o.startCountDown.bind(Object(G.a)(o)),o.tick=o.tick.bind(Object(G.a)(o)),o.selectProvince=Ee.a.createRef(),o.selectDistrict=Ee.a.createRef(),o.selectCommune=Ee.a.createRef(),o.selectPostcode=Ee.a.createRef(),o.inputProductSearch=Ee.a.createRef(),o.createOrderSearch=Ee.a.createRef(),o.focusMention=Ee.a.createRef(),o.isSelectItem=!1,o.cacheDbAddress=Object(ft.a)(),o.measureInput=[],o.idOrderItems="scroll-to-bottom-".concat(Object(Ue.ib)()),o}return Object(Y.a)(r,[{key:"tick",value:function(){var e=Math.floor(this.secondsRemaining/60),t=this.secondsRemaining-60*e;this.setState({minutes:e,seconds:t}),t<10&&this.setState({seconds:"0"+this.state.seconds}),e<10&&this.setState({value:"0"+e}),0===e&0===t&&(clearInterval(this.intervalHandle),this.state.orderIdViewing&&this.onChangeEmployeeViewingOrder(this.state.orderIdViewing,!1)),this.secondsRemaining--}},{key:"startCountDown",value:function(){this.intervalHandle=setInterval(this.tick,1e3);var e=this.state.minutes;this.secondsRemaining=60*e}},{key:"handleGetInfoShop",value:function(){var e=Object(H.a)(L.a.mark((function e(t){var n,r,o,a,i,c,s=this;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props,r=n.currentShops,o=n.accessToken,a=n.dispatch,i=n.auth,t){e.next=3;break}return e.abrupt("return");case 3:(c=r.find((function(e){return e.id==t})))&&(2!=c.type||c.tablePlan||a(Object(Ye.k)(o,c.id)),this.setState({type:c.type,limitViewOrder:c.limit_view_order,userShopRole:c.user_shop&&c.user_shop.role,isSnappyIntergration:c.is_snappy_intergration&&!!c.business,businessId:c.is_snappy_intergration&&c.business&&c.business.id,reservationDateTime:2==c.type?Qe()():void 0,orderTags:c.order_tags||[],orderTagGroups:c.order_tag_groups||[],currency:c.currency,isSendToSnappy:c.is_snappy_intergration&&!!c.business&&c.auto_send_order_to_snappy,dontSyncWithSnappy:!(c.is_snappy_intergration&&c.business&&c.auto_send_order_to_snappy),useCustomGeoFilter:c.use_custom_geo_filter,countries:c.country_code,cancelOrderCondition:c.condition_enter_note_order,rewardPointSetting:c.reward_point_settings,customPartners:c.custom_partners,savePartnerId:c.save_partner_id,promotion:c.promotion,promotion_advances:c.promotion_advances,warehouses_permissions:c.warehouses_permissions,assigningSellerId:c.auto_assign_creator?i.userId:c.auto_assign_order?"auto":void 0},(function(){return s.getInfoCountry()})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"showEmailOrder",value:function(){if(!this.props.shopId)return!1;var e=this.getCurrentShop();return!!e&&e.show_email_order}},{key:"componentDidMount",value:function(){var e=this.props,t=e.shopId,n=e.auth,r=this.state,o=r.assigningSellerId,a=r.cart;this.handleGetInfoShop.call(this,t),this.fetchUserWarehousesPermissions(),this.fetchCategories(),this.removeOrderShortcuts(),this.orderShortcuts(),this.findComboCanBeActive(!0,this.state.activatedComboProducts),this.findPromotionProductsCanBeActive(!0);var i=this.getCurrentShop();i&&i.auto_assign_creator&&!o?this.setState({assigningSellerId:n.userId}):i&&i.auto_assign_order&&!o&&this.setState({assigningSellerId:"auto"});var c=JSON.parse(localStorage.getItem("isSaveQuickProduct")),s=a.find((function(e){return e.oneTime&&!e.id}));null!=c&&s&&this.setState({isSaveQuickProduct:c}),window&&(window.setOrderNoteImages=this.setOrderNoteImages.bind(this)),window&&(window.createDropTransferProof=this.createDropTransferProof.bind(this))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this,n=e.pageWarehouses,r=e.cacheDb,o=e.conversations;!e.selectedRecord||this.props.selectedRecord&&this.props.selectedRecord.id==e.selectedRecord.id||this.setState({tab:1});var a=e.currentShops.find((function(t){return t.id==e.shopId}));if(n&&1==n.length&&!this.state.warehouseId){var i=n[0].id;this.setState({warehouseId:i})}if(this.props.conversationId!=e.conversationId){var c=document.getElementById("shippingAddress");c&&(c.value="");var s=document.getElementById("customerPhone");s&&(s.value=""),this.newSelectableAddress=null,this.newSelectablePhone=null,this.props.shopId!==e.shopId&&null!==e.shopId&&this.handleGetInfoShop.call(this,e.shopId),this.setState({provinceId:"",districtId:"",communeId:"",selectedPhone:"",selectedAddress:"",selectedEmail:"",addressSource:null,postcode:""}),this.setState(jt(jt({},kt),{},{selectedCustomer:null,customerName:""})),0!=this.state.tab&&this.handleChangeTab(0,!1),this.cacheDbKey="".concat(e.shopId,"_").concat(e.conversations.selectedId),r&&e.conversations.selectedId&&r.all(this.cacheDbKey).then((function(e){if(Array.isArray(e)){var n=e.reduce((function(e,n){var r=n.field_name,o=n.value;if(-1==wt.indexOf(r.replace("order.","")))return e;switch("order.cart"!=r||o||(o=[]),r){case"order.province":e=Object.assign(e,{provinceId:o.value,provinceName:o.label}),t.loadDistricts(o.value);break;case"order.district":e=Object.assign(e,{districtId:o.value,districtName:o.label}),t.loadCommunes(o.value);break;case"order.commune":e=Object.assign(e,{communeId:o.value,communeName:o.label});break;case"order.postcode":e=Object.assign(e,{postcode:o.value});break;default:var a=r.replace("order.","");"noteOrder"!==a&&"notePrintOrder"!==a||(o=It(o)),e[a]=o}return e}),{}),r=n.customerName;if(!n.customerName){var a=1==o.selectedCustomers.length?o.selectedCustomers:o.selectedCustomers.filter((function(e){return e.fb_id!=t.props.pageId})),i=a.length>0&&a[0];i&&(n.customerName=i.name)}try{var c=n.customerName,s=1==o.selectedCustomers.length?o.selectedCustomers:o.selectedCustomers.filter((function(e){return e.fb_id!=t.props.pageId})),d=s.length>0&&s[0];n.customerName||t.props.pageId.includes("_")||ht.a.report("Error missing customer name","empty_customer_name",{version:2,before:r,after:c,customer:JSON.stringify(d)})}catch(u){}t.setState(n)}})).catch((function(n){var r=!0;if("transactionTimeout"===n&&e.conversations.selectedId!==t.props.conversations.selectedId&&(r=!1),r){var a=1==o.selectedCustomers.length?o.selectedCustomers:o.selectedCustomers.filter((function(e){return e.fb_id!=t.props.pageId})),i=a.length>0&&a[0];i&&t.setState({customerName:i.name})}}))}a&&!De()(a.tablePlan,this.state.tablePlan)&&this.setState({tablePlan:a.tablePlan||[]})}},{key:"loadProvinces",value:function(e){var t=this,n=function(e){1==e.length&&(t.setState({provinceId:e[0].id}),t.loadDistricts(t.state.provinceId));var n=e.map((function(e){return{value:e.id,label:e.name,en:e.name_en}}));t.setState({provinces:n})},r=function(e){var r=t.props,o=r.dispatch,a=r.accessToken,i=r.t,c="".concat(Object(Ue.Mb)(!0),"/v1/geo/provinces?country_code=").concat(e,"&access_token=").concat(a);Object(Ue.lc)(c).then((function(e){e.success?(t.cacheDbAddress?t.cacheDbAddress.setItemCache("provinces",e.data):t.setState({cacheDbAddress:Object(ft.a)()}),n(e.data)):o(Object(Ge.a)(Object(Ue.P)(i(147))))})).catch((function(e){console.log(e),o(Object(Ge.a)(Object(Ue.P)(i(147))))}))};this.cacheDbAddress&&e?this.cacheDbAddress.getListItem("provinces",e).then((function(t){null!==t&&void 0!==t&&t.length?n(t):r(e)})).catch((function(){return r(e)})):r(e)}},{key:"loadDistricts",value:function(e){var t=this,n="1"!=this.getCountryId(this.state.countryId)?"districts":"communes",r=function(e){var r=e.map((function(e){return{value:e.id,label:e.name,en:e.name_en,postcode:e.postcode}}));t.setState(Object(Z.a)({},n,r))},o=function(e){var o=t.props,a=o.dispatch,i=o.accessToken,c=o.t,s="".concat(Object(Ue.Mb)(!0),"/v1/geo/").concat(n,"?province_id=").concat(e,"&access_token=").concat(i);return Object(Ue.lc)(s).then((function(e){e.success?(t.cacheDbAddress&&t.cacheDbAddress.setItemCache("districts",e.data),r(e.data)):a(Object(Ge.a)(Object(Ue.P)(c(148))))})).catch((function(e){console.log(e),a(Object(Ge.a)(Object(Ue.P)(c(148))))}))};this.cacheDbAddress&&e?this.cacheDbAddress.getListItem("districts",e).then((function(t){null!==t&&void 0!==t&&t.length?r(t):o(e)})):o(e)}},{key:"loadCommunes",value:function(e){var t=this,n=function(e){var n=e.map((function(e){return{value:e.id,label:e.name,en:e.name_en,postcode:e.postcode}}));t.setState({communes:n})},r=function(e){var r=t.props,o=r.dispatch,a=r.accessToken,i=r.t,c="".concat(Object(Ue.Mb)(!0),"/v1/geo/communes?district_id=").concat(e,"&access_token=").concat(a);return Object(Ue.lc)(c).then((function(e){e.success?(t.cacheDbAddress&&t.cacheDbAddress.setItemCache("communes",e.data),n(e.data)):o(Object(Ge.a)(Object(Ue.P)(i(149))))})).catch((function(e){o(Object(Ge.a)(Object(Ue.P)(i(149))))}))};this.cacheDbAddress&&e?this.cacheDbAddress.getListItem("communes",e).then((function(t){null!==t&&void 0!==t&&t.length?n(t):r(e)})):r(e)}},{key:"shouldComponentUpdate",value:function(e,t){t.noteOrder,t.notePrintOrder;var n=Object(Q.a)(t,["noteOrder","notePrintOrder"]),r=this.state,o=(r.noteOrder,r.notePrintOrder,Object(Q.a)(r,["noteOrder","notePrintOrder"])),a=!De()(e,this.props),i=!De()(n,this.state);if(i){var c=this.checkDiff(n,o);(1==c.length&&c.includes("isAddBonusProduct")||0==c.length&&this.isSelectItem)&&(i=!1)}return a||i}},{key:"onChangeEmployeeViewingOrder",value:function(e,t){var n=this.props,r=n.auth,o=r.fbId,a=r.fbName,i=r.channel,c=r.userId,s=n.shopId,d=this.getCurrentShop();if(d){var u=d.show_employee_viewing_orders;if(u){var l=u.active,p=u.time_range,m=u.only_one_employee_viewing;l&&i&&(i.push("viewing_order_change",{shop_id:s,order_id:e,user:{fb_id:o,name:a,active:t,id:c}}),t&&p&&m&&this.startCountDown())}}}},{key:"handleGetService",value:function(e,t,n){var r=this;if(e&&t){var o=this.props,a=o.dispatch,i=o.t,c=o.shopId,s="".concat(Object(Ue.Mb)(!0),"/v1/snappy/trackings/get_services?warehouse_id=").concat(e,"&receiver_district_id=").concat(t,"&shop_id=").concat(c);Object(Ue.lc)(s).then((function(e){!0===e.success&&(r.setState({services:e.services,serviceName:e.services&&e.services[0]&&e.services[0].name,serviceNameVi:e.services&&e.services[0]&&e.services[0].name_vi}),n(r.state.totalPrice))})).catch((function(e){console.log(e),a(Object(Ge.a)(Object(Ue.P)(i(176))))}))}}},{key:"onProductSelected",value:function(e,t){var n=this.props,r=(n.conversationId,n.cacheDb),o=this.state.cart,a=o.find((function(t){return t.index==e}));t?a&&(a.variationId=t.variationId,a.productName=t.productName,a.retailPrice=t.retailPrice,a.remain=t.remainQuantity,a.oneTime=t.oneTime,a.weight=0,a.comboProducts=t.comboProducts,a.comboVariations=t.comboVariations,a.categoryIds=t.categoryIds,a.id=null,a.weight=t.weight,!this.state.editingOrderId&&r.put({conv_id:this.cacheDbKey,field_name:"order.cart",value:o}),this.setState({cart:o}),t.comboProducts&&t.comboProducts.length>0&&this.findComboCanBeActive(null,this.state.activatedComboProducts)):a&&(e==o.length-1?(o.splice(e,1),this.setState({cart:o})):(a.variationId="",a.productName="",a.retailPrice=0,a.remain=0,a.oneTime=!0,a.oneTimePrice=0,a.weight=0,a.id=null,a.lastImportedPrice=null,!this.state.editingOrderId&&r.put({conv_id:this.cacheDbKey,field_name:"order.cart",value:o}),this.setState({cart:o})),this.findComboCanBeActive(null,this.state.activatedComboProducts))}},{key:"getRecipientLocation",value:function(){var e=this.state,t=e.provinces,n=e.provinceId,r=e.districts,o=e.districtId;if(n){var a=t.find((function(e){return e.value==n}));if(o){var i=r.find((function(e){return e.value==o}));return"".concat(null===i||void 0===i?void 0:i.label,", ").concat(null===a||void 0===a?void 0:a.label)}return null===a||void 0===a?void 0:a.label}return null}},{key:"handleGetCost",value:function(e){var t=this,n=e||0,r=this.state,o=r.warehouseId,a=r.serviceName,i=r.isReceiverPay,c=r.districtId,s=r.totalWeight,d=this.props.pageWarehouses;if(o&&c&&a&&-1!==n){this.setState({totalPrice:n});var u=d.find((function(e){return e.id==o}));if(u&&(!u||u.district_id)){var l="".concat(Object(Ue.Mb)(!0),"/v1/snappy/trackings/cal_shipping_cost"),p=this.props,m=p.dispatch,h=p.t,v=p.shopId,f={business_id:this.state.businessId||0,service_name:a,is_receiver_pay:i,total_weight:s,receiver_district_id:c,shop_id:v,cod:n,sender_district_id:u.district_id};Object(Ue.nc)(l,f).then((function(e){return!0===e.success?t.setState({codCost:e.cod_cost,shippingCost:e.shipping_cost}):a?t.setState({codCost:0,shippingCost:0}):void m(Object(Ge.a)(Object(Ue.P)(h(178))))})).catch((function(e){console.log(e),m(Object(Ge.a)(Object(Ue.P)(h(178))))}))}}}},{key:"handleCalculateTotalWeight",value:function(e){this.setState({totalWeight:e})}},{key:"getCountryId",value:function(e){var t=this.props,n=t.currentShops,r=t.shopId,o=this.state.provinceId,a=n.find((function(e){return e.id==r}));if(e)return"".concat(e);if(o){var i=o.indexOf("_");return-1==i?"84":o.slice(0,i)}return 1==(a.country_code||[]).length?a.country_code[0]:void 0}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.conversations,o=n.pageId,a=n.userId,c=n.t,s=this.state,d=s.changeStatusConfirm,u=s.changeStatusCancel,l=s.tab,p=s.displayId,m=s.customId,h=s.type,v=s.reservationDateTime,f=s.orderTags,_=s.orderTagGroups,b=s.tablePlan,g=s.tableModalVisible,O=s.tableIds,j=s.statusOrder,y=s.currency,P=s.customerLevels,C=s.selectedCustomer,x=s.isChangeTags,I=s.moreInfoCustomer;this.cacheDbAddress||(this.cacheDbAddress=Object(ft.a)());var S=C,A=I||3==h;return Object(i.jsxs)("div",{style:{height:"100%",backgroundColor:"#fbfbfb"},children:[g&&Object(i.jsx)(ie.a,{width:"70%",visible:g,onCancel:function(){return t.setState({tableModalVisible:!1})},closable:!1,footer:null,children:Object(i.jsx)(at.a,{t:this.props.t,orderDisplayId:p,currentTableIds:O,onTableClick:this.onTableClick,tablePlan:b,reservationDateTime:v,onChangeDatePicker:this.onChangeDatePicker})}),Object(i.jsxs)("div",{style:S?{}:{display:"none"},children:[Object(i.jsx)("div",{style:{borderBottom:"1px solid #ddd",height:45},children:Object(i.jsxs)("div",{style:{fontSize:15,color:"#888",textAlign:"center"},children:[Object(i.jsx)("div",{className:"tab-label-item ".concat(0==l?"active":""," ").concat("isComCake"),onClick:function(){return t.handleChangeTab(0,!0)},children:c("conversation.customerInfo.info")}),2==l?Object(i.jsxs)("div",{className:"tab-label-item ".concat(2==l?"active":""),id:"".concat(Ue.Mc),children:["#",m||p]}):Object(i.jsx)("div",{className:"tab-label-item ".concat(1==l?"active":""),onClick:function(){return t.handleChangeTab(1,!0)},id:"".concat(Ue.Lc),children:3==h?this.props.selectedRecord?this.props.crmTitle||(null===(e=this.props.selectedRecord)||void 0===e?void 0:e.Name):c("new"):c("conversation.customerInfo.createOrder")})]})}),Object(i.jsx)(rt.a,{show:this.state.showAlert,title:c("notification.confirm"),text:c("notification.noProductInWarehouse"),cancelButtonText:c("notification.cancel"),confirmButtonText:c("notification.ok"),showCancelButton:!0,onConfirm:function(){t.onProductSelected(t.state.dataSweetAlert.index,t.state.dataSweetAlert.selected),t.setState({showAlert:!1})},onCancel:function(){return t.setState({showAlert:!1})},onEscapeKey:function(){return t.setState({showAlert:!1})}}),Object(i.jsxs)(Fe.a,{index:l,containerStyle:{height:"calc(100vh - ".concat([1,2].includes(l)&&!A?180:100,"px)"),position:"relative"},children:[Object(i.jsx)("div",{className:"swipeable-view-content swipeable-info-view",children:Object(i.jsx)($e.a,{accessToken:this.props.accessToken,shopType:h,currency:y,userId:a,shopId:this.props.shopId,editOrder:this.editOrder,editStatus:this.editStatus,statusOrder:j,changeStatusConfirm:d,changeStatusCancel:u,editingOrderId:this.state.editingOrderId,orderListChange:this.state.orderListChange,limitViewOrder:this.state.limitViewOrder,userShopRole:this.state.userShopRole,cancelOrderCondition:this.state.cancelOrderCondition,noteOrder:this.state.noteOrder.getPlainText(),pageId:o,selectedFrom:r.selectedFrom,selectedInsertedAt:r.selectedInsertedAt,tags:r.selectedTags,tab:l,t:c,shopCustomer:this.props.shopCustomer,selectedPhone:this.state.selectedPhone,orderCustomerName:this.state.orderCustomerName,customerNamePageCustomer:this.state.customerName,addressSource:this.state.addressSource,customerLevels:P,setTags:function(e,n){return t.handleSetTag(e,n)},isChangeTags:x,orderTagGroups:_,orderTags:f,isParentHasCustomer:!!S})}),Object(i.jsx)("div",{className:"swipeable-view-order swipeable-view-content ".concat(A?"swipeable-view-content-crm":""),children:S&&1==l?A?Object(i.jsx)(it.a,jt(jt({},this.props),{},{conv_id:this.cacheDbKey,selectedPhone:this.state.selectedPhone,orderCustomerName:this.state.orderCustomerName,customerNamePageCustomer:this.state.customerName,callback:function(e){return t.setState(e)},orderId:m||p})):1==h?this.renderViewOrder():Object(i.jsx)("div",{className:"no-data-placeholder",style:{paddingTop:40},children:Object(i.jsx)("span",{children:"".concat(c("textOnly.noShopInfo"),". ").concat(c("textOnly.pleaseRefresh"))})}):null}),Object(i.jsx)("div",{className:"swipeable-view-order swipeable-view-content ".concat(A?"swipeable-view-content-crm":""),children:S?2==l&&1==h&&this.renderViewOrder():null})]}),[1,2].includes(l)&&!A&&h&&this.renderFooter()]}),S?null:Object(i.jsx)("div",{className:"no-data-placeholder",style:{paddingTop:40},children:c("textOnly.noCustomerInfo")})]})}}]),r}(Ee.a.Component),Bt=Object(dt.b)(["conversations"],["selectedCustomers","selectedId","selectedFrom","selectedType","selectedInsertedAt","selectedTags","quickOrderMsgId"],{isDeepEqual:!0}),Tt=Object(dt.b)(["messages"],["data","post","birthday","recentOrders","canInbox","notes","recentPhoneNumbers","isBanned","bannedCount","fetching","reportedCount","commentCount","lastCommentedAt","gender","customers","reportsByPhone","matchedWaFbCustomers","convPhoneNumbers"],{isDeepEqual:!0});n.a=Object(He.b)((function(e){return{auth:e.auth,currentShops:e.pages.currentShops,recentOrders:e.messages.recentOrders,recentOrdersRequest:e.messages.recentOrdersRequest,tables:e.crm.tables,selectedRecord:e.crm.selectedRecord,crmTitle:e.crm.title,messages:Tt(e),pages:e.pages,conversations:Bt(e),shopCustomer:e.conversations.selectedCustomers[0],selectedQuickOrderMsgId:e.conversations.quickOrderMsgId}}))(Dt)}}]);